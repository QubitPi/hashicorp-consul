<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>Upgrading Specific Versions | Consul | HashiCorp Developer</title><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta property="og:locale" content="en_US"/><meta property="og:type" content="website"/><meta property="article:publisher" content="https://www.facebook.com/HashiCorp/"/><meta name="twitter:site" content="@HashiCorp"/><meta name="twitter:card" content="summary_large_image"/><meta name="theme-color" content="#000"/><meta name="description" property="og:description" content="Specific versions of Consul may have additional information about the upgrade process beyond the standard flow."/><meta name="twitter:description" content="Specific versions of Consul may have additional information about the upgrade process beyond the standard flow."/><meta property="og:site_name" content="Upgrading Specific Versions | Consul | HashiCorp Developer"/><meta property="og:title" content="Upgrading Specific Versions | Consul | HashiCorp Developer"/><meta property="og:image" content="https://developer.hashicorp.com/og-image/consul.jpg"/><link rel="canonical" href="https://developer.hashicorp.com/consul/docs/upgrading/upgrade-specific"/><link rel="icon" href="/favicon.ico" sizes="any"/><link rel="icon" href="/icon.svg" type="image/svg+xml"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="google-site-verification" content="zRQZqfAsOX-ypXfU0mzAIzb5rUvj5fA4Zw2jWJRN-JI"/><meta name="zd-site-verification" content="xnvnvv1i0wl4tf0pzaymb" data-product="hcp"/><meta name="zd-site-verification" content="36fp2i1pj67d8cjtzf4fi9" data-product="terraform"/><meta name="zd-site-verification" content="nbe87kfyp1sck7b13vj1i" data-product="packer"/><meta name="zd-site-verification" content="wvsmmqa1cfb9am9zlwfj" data-product="consul"/><meta name="zd-site-verification" content="cw22oopfwr68ujj0n5pn9i" data-product="boundary"/><meta name="zd-site-verification" content="lkslvganwfgfqfwpdeicgh" data-product="vault"/><meta name="zd-site-verification" content="jl2wp2hoej9rz6c8rmqdns" data-product="nomad"/><meta name="zd-site-verification" content="2eb0cu6xceo73t0038m0tb" data-product="waypoint"/><meta name="zd-site-verification" content="n52xisxdf3higs2q9kuogd" data-product="vagrant"/><meta name="twitter:image" content="https://developer.hashicorp.com/og-image/consul.jpg"/><link rel="prefetch" href="https://www.datadoghq-browser-agent.com/datadog-rum-v4.js"/><script type="application/ld+json">[{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Developer","item":"https://developer.hashicorp.com/"},{"@type":"ListItem","position":2,"name":"Consul","item":"https://developer.hashicorp.com/consul"},{"@type":"ListItem","position":3,"name":"Documentation","item":"https://developer.hashicorp.com/consul/docs"},{"@type":"ListItem","position":4,"name":"Upgrade","item":"https://developer.hashicorp.com/consul/docs/upgrading"},{"@type":"ListItem","position":5,"name":"Specific Version Details","item":"https://developer.hashicorp.com/consul/docs/upgrading/upgrade-specific"}]}]</script><meta name="next-head-count" content="31"/><link data-next-font="" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/62f3294bfc989add.css" as="style"/><link rel="stylesheet" href="/_next/static/css/62f3294bfc989add.css" data-n-g=""/><link rel="preload" href="/_next/static/css/dcb6e784b5764eb2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/dcb6e784b5764eb2.css" data-n-p=""/><link rel="preload" href="/_next/static/css/18ed324149c36ad6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/18ed324149c36ad6.css" data-n-p=""/><link rel="preload" href="/_next/static/css/fc1808d4a21f9a59.css" as="style"/><link rel="stylesheet" href="/_next/static/css/fc1808d4a21f9a59.css" data-n-p=""/><link rel="preload" href="/_next/static/css/91dca0714ee7c672.css" as="style"/><link rel="stylesheet" href="/_next/static/css/91dca0714ee7c672.css" data-n-p=""/><link rel="preload" href="/_next/static/css/5fa2b4dd18e20c37.css" as="style"/><link rel="stylesheet" href="/_next/static/css/5fa2b4dd18e20c37.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-f861fd4ab584f5dc.js" defer=""></script><script src="/_next/static/chunks/framework-56eb74ff06128874.js" defer=""></script><script src="/_next/static/chunks/main-0785f91db64576b8.js" defer=""></script><script src="/_next/static/chunks/pages/_app-49535d849d7ff472.js" defer=""></script><script src="/_next/static/chunks/832-1733acefac904547.js" defer=""></script><script src="/_next/static/chunks/1122-3f2be94f653ef8d7.js" defer=""></script><script src="/_next/static/chunks/5973-f4f8c1167cd72fd3.js" defer=""></script><script src="/_next/static/chunks/1306-699e21fe04afb846.js" defer=""></script><script src="/_next/static/chunks/5888-731e387770363bca.js" defer=""></script><script src="/_next/static/chunks/6010-8790d8642bb38cba.js" defer=""></script><script src="/_next/static/chunks/7963-cdf3ff11e5b4f7ec.js" defer=""></script><script src="/_next/static/chunks/9325-e0903af1b37d2118.js" defer=""></script><script src="/_next/static/chunks/2291-52f1771184c676af.js" defer=""></script><script src="/_next/static/chunks/1825-58a66b9e99dc9bcd.js" defer=""></script><script src="/_next/static/chunks/7775-e851d12df43ee2d5.js" defer=""></script><script src="/_next/static/chunks/6075-8fa8c2611ee20dbb.js" defer=""></script><script src="/_next/static/chunks/7709-8138af14dcab3e76.js" defer=""></script><script src="/_next/static/chunks/pages/consul/docs/%5B...page%5D-8d1a4f03ffbee897.js" defer=""></script><script src="/_next/static/C_aCbyHEz7wf5PZ-lSB3G/_buildManifest.js" defer=""></script><script src="/_next/static/C_aCbyHEz7wf5PZ-lSB3G/_ssgManifest.js" defer=""></script></head><body><script>!function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src="https://artemis.hashicorp.com/script/"+t;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(n,a);analytics._loadOptions=e};analytics._cdn="https://artemis.hashicorp.com";analytics.SNIPPET_VERSION="4.1.0";}}();</script><div id="__next"><div class="style_root__dZhZu style_vagrant__u39kD style_isShown__D4mb6"><a href="https://www.hashicorp.com/blog/hashicorp-joins-ibm" class="style_linkElem__hCESK"><span class="style_textContainer__6CuI7 g-grid-container"><span class="style_tag__jbHGz g-type-body-small-x-strong">News<!-- --> </span><span class="style_text__rwS0u g-type-body-small">HashiCorp to join IBM to accelerate multi-cloud automation.<span class="style_linkText__E8GJf g-type-body-small-x-strong"> <!-- -->Read the blog â†’</span></span></span></a><button class="style_closeButton__57J9w"><div><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><path stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 5 5 15M5 5l10 10"/></svg></div><span style="position:absolute;border:0;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;word-wrap:normal">Dismiss alert</span></button></div><script type="text/javascript">
(function checkDismissAlertBanner() {
  try {
    if (document.cookie.includes('banner_hashicorp-to-join-ibm-to-accelerate-multi-cloud-automation.=1')) {
      const element = document.querySelector('.style_root__dZhZu')
      element.classList.remove('style_isShown__D4mb6')
    }
  } catch (_) {
    // do nothing
  }
})()
</script><script>!function(){try{var d=document.documentElement,n='data-theme',s='setAttribute';var e=localStorage.getItem('theme');if('system'===e||(!e&&true)){var t='(prefers-color-scheme: dark)',m=window.matchMedia(t);if(m.media!==t||m.matches){d.style.colorScheme = 'dark';d[s](n,'dark')}else{d.style.colorScheme = 'light';d[s](n,'light')}}else if(e){d[s](n,e|| '')}if(e==='light'||e==='dark')d.style.colorScheme=e}catch(e){}}()</script><div class="core-dev-dot-layout_root__MT1PZ"><div class="base-layout_root___qiZs" data-layout="base-new"><div class="base-layout_header__XhkxS"><header class="navigation-header_root__oE_HT"><div class="navigation-header_leftSide__V0xlc"><div class="product-page-content_productsDropdown__haUyw"><div class="dropdown-menu_root__Hwy5S"><div class="dropdown-menu_activatorWrapper__LxPRt"><button aria-controls="navigation-header-menu-react-aria-1" aria-expanded="false" aria-label="Main menu" class="dropdown-menu_activator__xXb00 g-focus-ring-from-box-shadow-dark product-page-content_productsDropdownButton__bnKKs" data-heap-track="navigation-header-dropdown-menu-activator"><span class="dropdown-menu_activatorLeadingIcon__YQQlH"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-hidden="true" class="product-page-content_productsDropdownIcon__gXtly"><g fill="currentColor"><path d="M10.336 1.5L2 6.268v11.456l3.131 1.793V8.061l5.205-2.979V1.5z"></path><path d="M13.664 1.5v9.123h-3.328V7.219L7.203 9.012V20.7l3.133 1.796V13.4h3.328v3.381l3.131-1.793V3.293L13.664 1.5z"></path><path d="M22 17.732L13.664 22.5v-3.582l5.203-2.98V4.484L22 6.276v11.456z"></path></g></svg></span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="dropdown-menu_activatorTrailingIcon__r_cCd"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></button></div><div class="dropdown-menu_dropdownContainer__AZWxN product-page-content_productsDropdownPane__bcdWz" id="navigation-header-menu-react-aria-1" style="display:none"><ul class="dropdown-menu_itemGroup__GEq4r"><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M7.846 2.574a.25.25 0 01.308 0l5.25 4.12a.25.25 0 01.096.196v7.36a.75.75 0 001.5 0V6.89a1.75 1.75 0 00-.67-1.377L9.08 1.394a1.75 1.75 0 00-2.16 0l-5.25 4.12A1.75 1.75 0 001 6.89v7.36a.75.75 0 001.5 0V6.89a.25.25 0 01.096-.196l5.25-4.12z"></path><path d="M6.5 14.25V10.5h3v3.75a.75.75 0 001.5 0v-4C11 9.56 10.44 9 9.75 9h-3.5C5.56 9 5 9.56 5 10.25v4a.75.75 0 001.5 0z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">HashiCorp Developer</span></div></div></a></li></ul><hr class="dropdown-menu_itemGroupDivider__X38aR"/><ul class="dropdown-menu_itemGroup__GEq4r"><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/hcp"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M6.835.6L1 3.96v8.074l2.192 1.264V5.224l3.643-2.1V.6z"></path><path d="M9.165.6v6.43h-2.33v-2.4L4.642 5.894v8.237l2.193 1.266v-6.41h2.33v2.383l2.192-1.264V1.864L9.165.6z"></path><path d="M15 12.04L9.165 15.4v-2.525l3.642-2.1V2.703L15 3.966v8.073z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">HashiCorp Cloud Platform</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/terraform"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-terraform-brand)"><path d="M1 0v5.05l4.349 2.527V2.526L1 0zM10.175 5.344l-4.35-2.525v5.05l4.35 2.527V5.344zM10.651 10.396V5.344L15 2.819v5.05l-4.349 2.527zM10.174 16l-4.349-2.526v-5.05l4.349 2.525V16z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Terraform</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/packer"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-packer-brand)"><path d="M5.163 0l5.762 3.247c1.138.646 2.074 2.085 2.075 3.2v4.963c0 1.123-.933 1.502-2.074.858L9.083 11.23V4.469l-3.92-2.216V0z"></path><path d="M8.3 4.953L3 1.956v11.047L8.3 16V4.953z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Packer</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/consul"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Consul</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/vault"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="var(--token-color-vault-brand)" d="M0 0l7.971 15.516L16 0H0zm6.732 6.16h-1.27V4.89h1.27v1.27zm0-1.906h-1.27V2.985h1.27v1.269zm1.904 3.81h-1.27v-1.27h1.27v1.27zm0-1.905h-1.27V4.89h1.27v1.27zm0-1.905h-1.27V2.985h1.27v1.269zm1.894 1.905H9.26V4.89h1.27v1.27zM9.26 4.254V2.985h1.27v1.269H9.26z"></path></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Vault</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/boundary"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-boundary-brand)"><path d="M4.81 15v-1.085h2.25v-.67H5.968v-1.093h5.149L8.726 8l2.392-4.154H5.84v5.76H3V1h9.775l1.631 2.832L12.006 8l2.448 4.252L12.872 15H4.81z"></path><path d="M5.248 12.152h-1.09v1.092h1.09v-1.092zM3 13.907h1.09v1.092H3v-1.092z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Boundary</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/nomad"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="var(--token-color-nomad-brand)" d="M8 0L1 4v8l7 4 7-4V4L8 0zm3.119 8.797L9.254 9.863 7.001 8.65v2.549l-2.118 1.33v-5.33l1.68-1.018 2.332 1.216V4.794l2.23-1.322-.006 5.325z"></path></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Nomad</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/waypoint"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-waypoint-brand)"><path d="M4 5.312h1.334L10 13.4l3.334-5.777L10.666 3H8l2.666 4.623L10 8.778 6.667 3H0l6 10.4 1.333-2.31L4 5.311zM14.002 6.463L16 3h-3.996l1.998 3.463z"></path></g></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Waypoint</span></div></div></a></li><li><a class="dropdown-menu_itemLink__92M_R g-focus-ring-from-box-shadow" data-heap-track="navigation-header-dropdown-menu-link" aria-describedby="" href="/vagrant"><div class="dropdown-menu_itemLinkContent__PATCl"><div class="dropdown-menu_leftAlignedItemLinkContent__d9pe_"><span class="dropdown-menu_leftAlignedItemLinkContentIcon__Im2L5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="#1868F2" d="M13.08.75L9.924 2.58v1.123L8 8.245 6.076 3.703V2.58L2.92.75 1 1.864v1.293l4.276 10.514L8 15.25l2.724-1.579L15 3.157V1.864L13.08.75z"></path><path fill="#0850C5" d="M15 1.865l-3.157 1.829v1.124L9.28 10.57 8 11.312v3.939l2.724-1.579L15 3.158V1.865zM6.076 3.703V2.58l-1.92 1.113v1.125l2.564 5.751L8 9.827V8.245L6.076 3.703z"></path></svg></span><span class="text_root__r0DFB hds-typography-body-100 hds-font-weight-regular dropdown-menu_itemText__Ba9wg">Vagrant</span></div></div></a></li></ul></div></div></div><div class="product-page-content_productLinkAndNav__YTzcr"><a aria-label="Consul home" class="product-icon-text-link_root__bNTSz g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-product-logo-link" aria-describedby="" href="/consul"><div class="product-icon-text-lockup_root__358wV"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="product-icon-text-lockup_icon__Zp_5o"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg><span class="product-icon-text-lockup_text__nHTL7 hds-typography-body-200">Consul</span></div></a><nav class="nav-bar-list-container_nav__C_i0_"><ul class="nav-bar-list-container_ul___04HI"><li><a aria-label="Consul Install" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" aria-describedby="" href="/consul/install"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Install</span></a></li><li><a aria-label="Consul Tutorials" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" aria-describedby="" href="/consul/tutorials"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Tutorials</span></a></li><li><a aria-label="Consul Documentation" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" aria-describedby="" href="/consul/docs"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Documentation</span></a></li><li><a aria-label="Consul API" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" aria-describedby="" href="/consul/api-docs"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">API</span></a></li><li><a aria-label="Consul CLI" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" aria-describedby="" href="/consul/commands"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">CLI</span></a></li><li><a aria-label="Consul Try Cloud" class="primary-nav-link_root__RXZIC g-focus-ring-from-box-shadow-dark" data-heap-track="navigation-header-primary-nav-link" aria-describedby="opens-in-new-tab-label-react-aria-18" target="_blank" href="https://portal.cloud.hashicorp.com/sign-up"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium primary-nav-link_linkText__58O0C">Try Cloud</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-18">(opens in new tab)</span></li></ul></nav></div></div><div class="navigation-header_rightSide___Vvh_"><button aria-label="Search" class="command-bar-activator_root__qgVMy g-focus-ring-from-box-shadow-dark"><span class="command-bar-activator_left__ATQTg"><span class="command-bar-activator_leadingIcon__jECP5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M7.25 2a5.25 5.25 0 103.144 9.455l2.326 2.325a.75.75 0 101.06-1.06l-2.325-2.326A5.25 5.25 0 007.25 2zM3.5 7.25a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0z" clip-rule="evenodd"></path></svg></span><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular command-bar-activator_text__pTZN_">Search</span></span><span class="command-bar-activator_right__XejfJ"><span class="g-screen-reader-only">Command or control key</span><span aria-hidden="true" class="badge_root___Z7Nt badge_small__GI0Zk badge_filled-neutral-dark-mode__VC3Ba command-bar-activator_keyBadge__xnKpi"><div class="cmd-ctrl-icon_root___TToz"><svg xmlns="http://www.w3.org/2000/svg" width="41" height="11" fill="none" viewBox="0 0 41 11"><path fill="#fff" fill-rule="evenodd" d="M4.125 2.063V3h2.25v-.937a2.062 2.062 0 1 1 2.063 2.062H7.5v2.25h.938a2.062 2.062 0 1 1-2.063 2.063V7.5h-2.25v.938a2.062 2.062 0 1 1-2.062-2.063H3v-2.25h-.937a2.062 2.062 0 1 1 2.062-2.062m-2.062-.938a.937.937 0 1 0 0 1.875H3v-.937a.937.937 0 0 0-.937-.938M7.5 7.5v.938a.937.937 0 1 0 .938-.938zM6.375 6.375v-2.25h-2.25v2.25zM2.063 7.5H3v.938a.937.937 0 1 1-.937-.938M7.5 3h.938a.937.937 0 1 0-.938-.937z" clip-rule="evenodd"/><path fill="#fff" d="M15.09 10.5 18.085 0h-1.097L14 10.5zM26.387 5.308c-.183-1.445-1.263-2.534-3.05-2.534C21.264 2.774 20 4.247 20 6.61c0 2.41 1.27 3.89 3.344 3.89 1.76 0 2.86-1.034 3.043-2.5H25.02c-.184.808-.792 1.247-1.682 1.247-1.172 0-1.898-.994-1.898-2.637 0-1.61.72-2.583 1.898-2.583.942 0 1.518.555 1.681 1.281zM28.6 1.041v1.897h-1.133v1.178H28.6v4.281c0 1.432.622 2.007 2.186 2.007.275 0 .537-.034.766-.075V9.158c-.196.02-.32.034-.537.034-.7 0-1.008-.35-1.008-1.15V4.115h1.545V2.938h-1.545V1.041zM33.207 10.356h1.407V5.911c0-1.048.752-1.767 1.819-1.767.249 0 .667.048.785.082V2.842a3.372 3.372 0 0 0-.628-.054c-.93 0-1.721.527-1.924 1.26h-.105v-1.13h-1.354zM38.638 10.356h1.407V0h-1.407z"/></svg></div></span><span class="g-screen-reader-only">K key</span><span aria-hidden="true" class="badge_root___Z7Nt badge_small__GI0Zk badge_filled-neutral-dark-mode__VC3Ba command-bar-activator_keyBadge__xnKpi"><div class="k-icon_root__a_5pR"><svg xmlns="http://www.w3.org/2000/svg" width="8" height="10" fill="none" viewBox="0 0 8 10"><path fill="#fff" d="M1.512 9.84v-3l.986-1.147L5.445 9.84h1.704L3.46 4.745 6.857.84H5.244L1.61 5.094h-.098V.84H.15v9z"/></svg></div></span></span></button><div class="navigation-header_authenticationControls__EP1LY"><div class="disclosure_root__rcBaW dropdown-disclosure_root__pzZlN dropdown-disclosure_list-position--right__WP_Kj"><button aria-controls="disclosure-react-aria-19-content" aria-expanded="false" aria-label="User menu" class="disclosure_activator__pORI0 activator_root__pOfAQ dropdown-disclosure_activator__nGgNo navigation-header_userDropdownDisclosureActivator__RayIV g-focus-ring-from-box-shadow-dark activator_hasIcon__5HO6W g-focus-ring-from-box-shadow"><span class="activator_childrenWrapper__kaK0w"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-hidden="true"><g fill="currentColor"><path fill-rule="evenodd" d="M12 3a5 5 0 100 10 5 5 0 000-10zM8.5 8a3.5 3.5 0 117 0 3.5 3.5 0 01-7 0z" clip-rule="evenodd"></path><path d="M7.75 14.5A4.75 4.75 0 003 19.25v1a.75.75 0 001.5 0v-1A3.25 3.25 0 017.75 16h8.5a3.25 3.25 0 013.25 3.25v1a.75.75 0 001.5 0v-1a4.75 4.75 0 00-4.75-4.75h-8.5z"></path></g></svg></span><span class="activator_chevronWrapper__4_AVG"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></span></button><div class="disclosure_contentContainer__QQ4kt dropdown-disclosure_content__ZZRPG undefined" id="disclosure-react-aria-19-content"><ul class="dropdown-disclosure_list__urBXU"><li class="list-item_root__ZdUej"><button class="list-item_button__nXy5K g-focus-ring-from-box-shadow"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">Sign in</span></button></li><li class="list-item_root__ZdUej"><a class="list-item_link__l6lDd g-focus-ring-from-box-shadow" aria-describedby="" href="/sign-up"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-medium">Sign up</span></a></li><li class="list-item_root__ZdUej"><hr class="list-item_separator__cBVLs"/></li><li class="list-item_root__ZdUej user-dropdown-switcher_listItem__Q_GIj hds-font-weight-medium"><label class="theme-switcher_label__7Boh2 hds-typography-body-200" for="react-aria-21">Theme</label></li></ul></div></div></div><button aria-label="Open navigation menu" class="navigation-header_mobileMenuButton__74S4w"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-hidden="true"><g fill="currentColor"><path d="M2 5.75A.75.75 0 012.75 5h18.5a.75.75 0 010 1.5H2.75A.75.75 0 012 5.75zM2 11.75a.75.75 0 01.75-.75h18.5a.75.75 0 010 1.5H2.75a.75.75 0 01-.75-.75zM2.75 17a.75.75 0 000 1.5h18.5a.75.75 0 000-1.5H2.75z"></path></g></svg></button></div></header></div><div class="base-layout_contentArea__BMvQn"><div class="sidebar-sidecar-layout_root__h5rD8 sidebar-sidecar-layout_mainWidth-narrow__FhCbs"><div class="mobile-menu-container_root__fPUFu sidebar-sidecar-layout_sidebarContainer__4fcF8"><div class="sidebar-sidecar-layout_sidebarContentWrapper__ftn5q"><div class="sidebar_sidebar___fTlC"><div class="sidebar_backToLinkWrapper__F6iLs"><div class="sidebar-back-to-link_root__z_Hj1"><a class="standalone-link_standaloneLink__ahuej g-focus-ring-from-box-shadow standalone-link_primary__ESNCA" data-heap-track="standalone-link sidebar-back-to-link" aria-describedby="" href="/consul"><div class="standalone-link_standaloneLinkContents__4I2XN standalone-link_medium__J2yVM"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M10.795 3.235a.75.75 0 01-.03 1.06L6.842 8l3.923 3.705a.75.75 0 01-1.03 1.09l-4.5-4.25a.75.75 0 010-1.09l4.5-4.25a.75.75 0 011.06.03z" clip-rule="evenodd"></path></svg><span class="standalone-link_text__7GEyG">Consul Home</span></div></a></div></div><div class="sidebar_filterInputWrapper__0_l_Y"><div class="filter-input_filterInputContainer__thZt3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="filter-input_filterIcon__UET0p filter-input_sharedIconColorAndPositioning__hXPit"><g fill="currentColor"><path d="M1 3.75A.75.75 0 011.75 3h12.5a.75.75 0 010 1.5H1.75A.75.75 0 011 3.75zM3.5 7.75A.75.75 0 014.25 7h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM6.75 11a.75.75 0 000 1.5h2.5a.75.75 0 000-1.5h-2.5z"></path></g></svg><input class="filter-input_filterInput__hga4N g-focus-ring-from-box-shadow" placeholder="Filter sidebar" autoComplete="off" autoCorrect="off" autoCapitalize="none" spellcheck="false" value=""/></div></div><nav aria-labelledby="sidebar-label" class="sidebar_nav__IworY" id="sidebar-nav"><div class="g-screen-reader-only"><h2 class="sidebar-headings_root__tGfxC" id="sidebar-label">Documentation</h2></div><ul class="sidebar_navList__4Rg4g"><li><a class="sidebar-nav-highlight-item_root___pPhp g-focus-ring-from-box-shadow sidebar-nav-highlight-item_theme-consul__NA90N" aria-describedby="" href="/consul/docs"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="sidebar-nav-highlight-item_icon__G8JxG"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg><span class="sidebar-nav-highlight-item_text__VORFJ hds-typography-body-200">Documentation</span></a></li><li id="sidebar-nav-item-0"><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/consul/docs/intro"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">What is Consul?</span></a></li><li id="sidebar-nav-item-1"><button aria-controls="sidebar-nav-item-1-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-1-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Why Choose Consul?</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-7"><button aria-controls="sidebar-nav-item-7-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-7-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Core Concepts</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-10"><button aria-controls="sidebar-nav-item-10-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-10-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Get Started</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-22"><button aria-controls="sidebar-nav-item-22-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-22-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Architecture</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-36"><hr class="sidebar-horizontal-rule_root__UY7oh"/></li><li id="sidebar-nav-item-37"><button aria-controls="sidebar-nav-item-37-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-37-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Release Notes</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-75"><button aria-controls="sidebar-nav-item-75-list" aria-expanded="true" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-75-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Upgrade</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button><ul id="sidebar-nav-item-75-list"><li id="sidebar-nav-item-76"><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/consul/docs/upgrading"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Overview</span></a></li><li id="sidebar-nav-item-77"><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/consul/docs/upgrading/compatibility"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Compatibility Promise</span></a></li><li id="sidebar-nav-item-78"><a aria-current="page" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Specific Version Details</span></a></li><li id="sidebar-nav-item-79"><button aria-controls="sidebar-nav-item-79-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-79-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Upgrade Instructions</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li></ul></li><li id="sidebar-nav-item-86"><hr class="sidebar-horizontal-rule_root__UY7oh"/></li><li id="sidebar-nav-item-87"><button aria-controls="sidebar-nav-item-87-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-87-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Services</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-104"><button aria-controls="sidebar-nav-item-104-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-104-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Service Mesh</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-244"><button aria-controls="sidebar-nav-item-244-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-244-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Dynamic App Configuration</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-250"><button aria-controls="sidebar-nav-item-250-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-250-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Security</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-283"><button aria-controls="sidebar-nav-item-283-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-283-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Agent</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-305"><button aria-controls="sidebar-nav-item-305-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-305-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Integrations</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-311"><button aria-controls="sidebar-nav-item-311-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-311-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Troubleshoot</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-315"><hr class="sidebar-horizontal-rule_root__UY7oh"/></li><li id="sidebar-nav-item-316"><button aria-controls="sidebar-nav-item-316-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-316-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Kubernetes</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-414"><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/consul/docs/nomad"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Nomad</span></a></li><li id="sidebar-nav-item-415"><button aria-controls="sidebar-nav-item-415-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-415-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">AWS ECS</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-431"><button aria-controls="sidebar-nav-item-431-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-431-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">AWS Lambda</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-439"><hr class="sidebar-horizontal-rule_root__UY7oh"/></li><li id="sidebar-nav-item-440"><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/hcp/docs/consul"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">HCP Consul</span></a></li><li id="sidebar-nav-item-441"><button aria-controls="sidebar-nav-item-441-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-441-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Consul Enterprise</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li><li id="sidebar-nav-item-464"><hr class="sidebar-horizontal-rule_root__UY7oh"/></li><li id="sidebar-nav-item-465"><button aria-controls="sidebar-nav-item-465-list" class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" id="sidebar-nav-item-465-button" data-heap-track="sidebar-nav-submenu-button"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Network Infrastructure Automation</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" fill-rule="evenodd" d="M3.235 5.205a.75.75 0 011.06.03L8 9.158l3.705-3.923a.75.75 0 011.09 1.03l-4.25 4.5a.75.75 0 01-1.09 0l-4.25-4.5a.75.75 0 01.03-1.06z" clip-rule="evenodd"></path></svg></div></button></li></ul><hr class="sidebar-horizontal-rule_root__UY7oh"/><ul class="sidebar_navList__4Rg4g"><li><h3 class="sidebar-headings_root__tGfxC">Resources</h3></li><li><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/tutorials/library?product=consul"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Tutorial Library</span></a></li><li><a class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" aria-describedby="" href="/certifications/networking-automation"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Certifications</span></a></li><li><a aria-label="Community Forum. Opens in a new tab." class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" rel="noreferrer noopener" aria-describedby="opens-in-new-tab-label-react-aria-32" target="_blank" href="https://discuss.hashicorp.com/c/consul/29"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Community Forum</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></div></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-32">(opens in new tab)</span></li><li><a aria-label="Support. Opens in a new tab." class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" rel="noreferrer noopener" aria-describedby="opens-in-new-tab-label-react-aria-33" target="_blank" href="https://www.hashicorp.com/customer-success"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">Support</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></div></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-33">(opens in new tab)</span></li><li><a aria-label="GitHub. Opens in a new tab." class="sidebar-nav-menu-item_sidebarNavMenuItem__PiyI8 g-focus-ring-from-box-shadow" data-heap-track="sidebar-nav-link-item" rel="noreferrer noopener" aria-describedby="opens-in-new-tab-label-react-aria-34" target="_blank" href="https://github.com/hashicorp/consul"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular sidebar-nav-menu-item_navMenuItemLabel__tJHwX">GitHub</span><div class="sidebar-nav-menu-item_rightIconsContainer__hynke"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></div></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-34">(opens in new tab)</span></li></ul></nav></div></div></div><div class="sidebar-sidecar-layout_contentWrapper__Z5BK4"><div class="sidebar-sidecar-layout_paddedAreaWrapper___S_Ff"><div class="sidebar-sidecar-layout_breadcrumbContainer__3uz7P"><div class="sidebar-sidecar-layout_breadcrumbMaxWidth__coOcu"><nav aria-label="Breadcrumb" class="breadcrumb-bar_root__wd_C5"><ol class="breadcrumb-bar_listRoot__8eupO"><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" aria-describedby="" href="/">Developer</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" aria-describedby="" href="/consul">Consul</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" aria-describedby="" href="/consul/docs">Documentation</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><a class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" data-heap-track="breadcrumb-bar-item" aria-describedby="" href="/consul/docs/upgrading">Upgrade</a></li><li class="text_root__r0DFB hds-typography-body-100 hds-font-weight-medium breadcrumb-bar_listItem__2sevd"><span class="breadcrumb-bar_breadcrumbText__JvOrd g-focus-ring-from-box-shadow" aria-current="page" data-heap-track="breadcrumb-bar-item">Specific Version Details</span></li></ol></nav></div></div><div class="sidebar-sidecar-layout_mainAndSidecar__UDm3Z"><main id="main" class="sidebar-sidecar-layout_main__0SN51"><div class="docs-page-heading_root__QuBg_ docs-view_docsPageHeading___xkrK"><div class="docs-page-heading_pageHeadingWrapper__LEMQ7"><h1 class="hds-typography-display-600 hds-font-weight-bold docs-plain-page-heading_root__HzRuX g-offset-scroll-margin-top" id="upgrading-specific-versions">Upgrading Specific Versions</h1></div></div><div class="dev-dot-content_root__UJDct hds-typography-body-300"><div class="docs-view_mdxContent___uMnx"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading">upgrading page</a> covers the details of doing a
standard upgrade. However, specific versions of Consul may have more details
provided for their upgrades as a result of new features or changed behavior.
This page is used to document those details separately from the standard
upgrade flow.</p><h2 id="consul-v1-19-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul v1 19 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-v1-19-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul v1.19.x</h2><h3 id="metrics-removal" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="metrics removal permalink" href="/consul/docs/upgrading/upgrade-specific#metrics-removal"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Metrics removal</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In previous versions, Consul emitted redundant state store usage metrics that contained two instances of <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul</code> in the metric name. As an example, config entry usage counts were emitted as both:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a id="consul-state-config_entries" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="consul state config_entries permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-state-config_entries"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.state.config_entries</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="consul-consul-state-config_entries" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="consul consul state config_entries permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-consul-state-config_entries"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.consul.state.config_entries</code></a></li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">As of Consul v1.19, Consul does not emit the redundant metric with the double <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.consul</code> in its name. Any monitoring alerts and dashboards that you may have utilizing these metrics may require edits to update to the simplified metric name.</p><h3 id="legacy-api-gateway-removal" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="legacy api gateway removal permalink" href="/consul/docs/upgrading/upgrade-specific#legacy-api-gateway-removal"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Legacy API Gateway Removal</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The Consul Kubernetes Helm chart stanza
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/v1.16.x/k8s/helm#apigateway-1"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">.apiGateway</code></a>
is removed in Consul v1.19.0. If using that stanza, migrate to the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/k8s/helm#v-connectinject-apigateway"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">connectInject.apiGateway</code></a>
stanza before upgrading to Consul v1.19 or later.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">.apiGateway</code> stanza is associated with the legacy API gateway that was
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/release-notes/consul/v1_16_x#what-s-deprecated">deprecated in Consul v1.16.0</a>.
The Kubernetes-only legacy API gateway is superseded by the modern, multi-runtime
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/api-gateway">API gateway</a>.
On Kubernetes, the modern API gateway is associated with the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">connectInject.apiGateway</code> stanza.</p><h2 id="consul-1-17-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 17 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-17-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.17.x</h2><h3 id="known-issues" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="known issues permalink" href="/consul/docs/upgrading/upgrade-specific#known-issues"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Known issues</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul versions 1.17.2 and 1.16.5 perform excessively strict TLS SAN verification on terminating gateways, which prevents connections outside of the mesh to upstream services. Terminating gateway users are advised to avoid deploying these Consul versions. A fix will be present in a future release of Consul 1.17.3 and 1.16.6 [<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/issues/20360">GH-20360</a>].</p><h4 id="audit-log-naming-changes-enterprise" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="audit log naming changes enterprise permalink" href="/consul/docs/upgrading/upgrade-specific#audit-log-naming-changes-enterprise"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Audit Log naming changes (Enterprise)</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Prior to Consul 1.17.0, audit logs contained timestamps on both the original log file names as well as rotated log file names.
After Consul 1.17.0, only timestamps will be included in rotated log file names.</p><h4 id="service-defaults-upstream-config-enterprise" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="service defaults upstream config enterprise permalink" href="/consul/docs/upgrading/upgrade-specific#service-defaults-upstream-config-enterprise"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Service-defaults upstream config (Enterprise)</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Prior to Consul v1.17.0, <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/k8s/annotations-and-labels#consul-hashicorp-com-connect-service-upstreams">Kubernetes annotations for upstream services</a>
that did not explicitly specify a namespace or partition incorrectly used service-defaults configurations, such as <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-defaults#set-the-default-protocol">default protocol</a>, from the default partition and namespace instead of the local partition and namespace.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This bug is fixed starting in Consul v1.17.0. Now service-defaults configurations from the local partition and namespace are fetched when not specified in annotations.
If you are using non-default partitions and namespaces with Consul-k8s, we recommend explicitly defining these fields for all upstreams in addition to ensuring that accurate
service-defaults are configured in each partition and namespace before upgrading. Doing so ensures that no unexpected protocol changes occur during the upgrade.</p><h4 id="acl-tokens-with-templated-policies" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="acl tokens with templated policies permalink" href="/consul/docs/upgrading/upgrade-specific#acl-tokens-with-templated-policies"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>ACL tokens with templated policies</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/security/acl#templated-policies">ACL templated policies</a> were added to 1.17.0 to simplify obtaining the right permissions for ACL tokens. When performing a <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/datacenter-operations/upgrade-federated-environment#server-rolling-upgrade">rolling upgrade</a> and a version of Consul prior to 1.17.x is presented with a token created Consul v1.17.x or newer that contains templated policies, the templated policies field is not recognized. As a result, the token might not have the expected permissions on the older version of Consul.</p><h2 id="consul-1-16-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 16 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-16-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.16.x</h2><h3 id="known-issues-1" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="known issues permalink" href="/consul/docs/upgrading/upgrade-specific#known-issues-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Known issues</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul versions 1.17.2 and 1.16.5 perform excessively strict TLS SAN verification on terminating gateways, which prevents connections outside of the mesh to upstream services. Terminating gateway users are advised to avoid deploying these Consul versions. A fix will be present in a future release of Consul 1.17.3 and 1.16.6 [<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/issues/20360">GH-20360</a>].</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Service mesh in Consul versions 1.16.0 and 1.16.1 may have issues when a snapshot restore is performed and the servers are hosting xDS streams.
When this bug triggers, it causes Envoy to incorrectly populate upstream endpoints. To prevent this issue, service mesh users who run agent-less workloads should upgrade Consul to v1.16.2 or later.</p><h4 id="vault-enterprise-as-ca" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="vault enterprise as ca permalink" href="/consul/docs/upgrading/upgrade-specific#vault-enterprise-as-ca"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><a id="vault-enterprise-as-ca-1-16" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-h __compat" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a>Vault Enterprise as CA</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Using Vault as CA with Consul version 1.16.2 will fail to initialize the CA if <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#namespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">namespace</code></a> is set
but <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#intermediatepkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">intermediate_pki_namespace</code></a> or <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#rootpkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">root_pki_namespace</code></a>
are empty. This is a bug which will be fixed in a future version.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To work around this issue, users must explicitly set <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#intermediatepkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">intermediate_pki_namespace</code></a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#rootpkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">root_pki_namespace</code></a> to the same value as <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#namespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">namespace</code></a>.
Set your configuration by calling <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/ca#set-config">set-config</a> then use <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/ca#get-config">get-config</a> to check.</p><h4 id="api-health-endpoints-return-different-status-code" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="api health endpoints return different status code permalink" href="/consul/docs/upgrading/upgrade-specific#api-health-endpoints-return-different-status-code"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>API health endpoints return different status code</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul versions 1.16.0+ now return an error 403 &quot;Permission denied&quot; status
whenever the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/v1/health/connect/</code> and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/v1/health/ingress/</code> endpoints are
queried with insufficient ACL <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">service:read</code> privileges.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In Consul versions older than 1.16.0, the service health API did not return an explicit error when given a token with invalid permissions. Instead, it returned an empty list with a success status code.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Before upgrading, ensure that all of your applications can handle this new API behavior properly. An update is not required unless you have a custom application that is querying one of these API endpoints directly.</p><h4 id="remove-deprecated-service-defaults-peer-upstream-override-behavior" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="remove deprecated service defaults peer upstream override behavior permalink" href="/consul/docs/upgrading/upgrade-specific#remove-deprecated-service-defaults-peer-upstream-override-behavior"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Remove deprecated service-defaults peer upstream override behavior</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When configuring a service defaults configuration entry, the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-defaults#upstreamconfig-overrides"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">UpstreamConfig.Overrides</code> configuration</a>
does not apply to peer upstreams unless the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-defaults#upstreamconfig-overrides-peer"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Peer</code></a> field is explicitly provided.
This change removes the backward-compatibility behavior introduced in Consul 1.15.x. Refer to the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#service-defaults-overrides-for-upstream-peered-services">upgrade instructions for 1.15.x</a> for more information.</p><h2 id="consul-1-15-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 15 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-15-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.15.x</h2><h3 id="service-mesh-compatibility" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="service mesh compatibility permalink" href="/consul/docs/upgrading/upgrade-specific#service-mesh-compatibility"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><a id="service-mesh-compatibility-1-15" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-h __compat" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a>Service mesh compatibility</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Upgrade to <strong>Consul version 1.15.2 or later</strong>.
If using <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#vault-enterprise-as-ca-1-15">Vault Enterprise as CA</a>, <strong>avoid Consul version 1.15.6</strong>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul versions 1.15.0 - 1.15.1 contain a race condition that can cause
some service instances to lose their ability to communicate in the mesh after
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/consul#leafcertttl">72 hours (LeafCertTTL)</a>
due to a problem with leaf certificate rotation.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This bug is fixed in Consul versions 1.15.2 and newer.</p><h4 id="vault-enterprise-as-ca-1" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="vault enterprise as ca permalink" href="/consul/docs/upgrading/upgrade-specific#vault-enterprise-as-ca-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><a id="vault-enterprise-as-ca-1-15" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-h __compat" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a>Vault Enterprise as CA</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Using Vault as CA with Consul version 1.15.6 will fail to initialize the CA if <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#namespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">namespace</code></a> is set
but <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#intermediatepkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">intermediate_pki_namespace</code></a> or <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#rootpkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">root_pki_namespace</code></a>
are empty. This is a bug which will be fixed in a future version.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To work around this issue, users must explicitly set <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#intermediatepkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">intermediate_pki_namespace</code></a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#rootpkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">root_pki_namespace</code></a> to the same value as <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#namespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">namespace</code></a>.
Set your configuration by calling <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/ca#set-config">set-config</a> then use <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/ca#get-config">get-config</a> to check.</p><h4 id="removing-configuration-options" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="removing configuration options permalink" href="/consul/docs/upgrading/upgrade-specific#removing-configuration-options"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Removing configuration options</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">connect.enable_serverless_plugin</code> configuration option was removed. Lambda integration is now enabled by default.</p><h4 id="deprecating-authentication-via-token-query-parameter" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="deprecating authentication via token query parameter permalink" href="/consul/docs/upgrading/upgrade-specific#deprecating-authentication-via-token-query-parameter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Deprecating authentication via token query parameter</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Providing a Consul ACL token in API requests using the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">token</code> query parameter is deprecated and will be removed in a future Consul version.
Instead, you should provide the token through the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">X-Consul-Token</code> header or with the Bearer scheme in the authorization header as described in the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/api-structure#authentication">API authentication documentation</a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Check whether you are using a <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">token</code> query parameter by searching your Consul agent logs for the message:</p><div class="g-code-block style_root__i1k0c language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash">This request used the token query parameter <span class="token function">which</span> is deprecated and will be removed <span class="token keyword">in</span> a future Consul version</span></span>
</span></span></span></code></pre></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Deprecated authentication using the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">token</code> query parameter:</p><div class="g-code-block style_root__i1k0c language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> <span class="token punctuation">\</span></span></span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token command"><span class="token bash language-bash">    http://127.0.0.1:8500/v1/agent/members?token<span class="token operator">=</span></span></span><span class="token output">&lt;consul token&gt;</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Recommended authentication method:</p><div class="g-code-block style_root__i1k0c language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-shell-session mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token command"><span class="token shell-symbol important">$</span> <span class="token bash language-bash"><span class="token function">curl</span> <span class="token punctuation">\</span></span></span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token command"><span class="token bash language-bash">    --header <span class="token string">&quot;X-Consul-Token: &lt;consul token&gt;&quot;</span> <span class="token punctuation">\</span></span></span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token command"><span class="token bash language-bash">    http://127.0.0.1:8500/v1/agent/members</span></span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h4 id="lambda-configuration" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="lambda configuration permalink" href="/consul/docs/upgrading/upgrade-specific#lambda-configuration"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Lambda Configuration</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Instead of configuring Lambda functions in the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Meta</code> field of <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">service-defaults</code> configuration entries, configure them with the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">EnvoyExtensions</code> field.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Before Consul v1.15:</p><div class="g-code-block style_root__i1k0c style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_root___hL1f"><div class="style_leftSide__uPoap"><div class="style_filename__lKNyi g-type-code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none"><path fill="#000" fill-rule="evenodd" d="M6 2.08a2.75 2.75 0 0 0-2.75 2.75v16A2.75 2.75 0 0 0 6 23.58h12a2.75 2.75 0 0 0 2.75-2.75v-11a.748.748 0 0 0-.22-.53l-7-7a.751.751 0 0 0-.53-.22m-.75 1.5H6c-.69 0-1.25.56-1.25 1.25v16c0 .691.56 1.25 1.25 1.25h12c.69 0 1.25-.559 1.25-1.25V10.58H13a.75.75 0 0 1-.75-.75V3.58Zm5.94 5.5-4.44-4.439v4.44h4.44Z" clip-rule="evenodd"></path></svg>lambda-service-defaults.hcl</div></div><div class="style_rightSide__tzFHY"><div class="style_copyBtnContainer__1HWoT"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl"><code class="code-lines_code__luWmT language-hcl"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">Kind</span> <span class="token punctuation">=</span> <span class="token string">&quot;service-defaults&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;SERVICE_NAME&gt;&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">Protocol</span>  <span class="token punctuation">=</span> <span class="token string">&quot;http&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">Meta</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">  <span class="token property">&quot;serverless.consul.hashicorp.com/v1alpha1/lambda/enabled&quot;</span> <span class="token punctuation">=</span> <span class="token string">&quot;true&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token punctuation">}</span>
</span></span></span></code></pre></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In Consul v1.15 and higher:</p><div class="g-code-block style_root__i1k0c style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_root___hL1f"><div class="style_leftSide__uPoap"><div class="style_filename__lKNyi g-type-code"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="25" viewBox="0 0 24 25" fill="none"><path fill="#000" fill-rule="evenodd" d="M6 2.08a2.75 2.75 0 0 0-2.75 2.75v16A2.75 2.75 0 0 0 6 23.58h12a2.75 2.75 0 0 0 2.75-2.75v-11a.748.748 0 0 0-.22-.53l-7-7a.751.751 0 0 0-.53-.22m-.75 1.5H6c-.69 0-1.25.56-1.25 1.25v16c0 .691.56 1.25 1.25 1.25h12c.69 0 1.25-.559 1.25-1.25V10.58H13a.75.75 0 0 1-.75-.75V3.58Zm5.94 5.5-4.44-4.439v4.44h4.44Z" clip-rule="evenodd"></path></svg>lambda-service-defaults.hcl</div></div><div class="style_rightSide__tzFHY"><div class="style_copyBtnContainer__1HWoT"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl"><code class="code-lines_code__luWmT language-hcl"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">Kind</span> <span class="token punctuation">=</span> <span class="token string">&quot;service-defaults&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;SERVICE_NAME&gt;&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">Protocol</span>  <span class="token punctuation">=</span> <span class="token string">&quot;http&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token property">EnvoyExtensions</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">  <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">    <span class="token property">&quot;Name&quot;</span>: <span class="token string">&quot;builtin/aws/lambda&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">    <span class="token property">&quot;Arguments&quot;</span>: <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">      <span class="token property">&quot;Region&quot;</span>: <span class="token string">&quot;us-east-2&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">      <span class="token property">&quot;ARN&quot;</span>: <span class="token string">&quot;&lt;INSERT ARN HERE&gt;&quot;</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">      <span class="token property">&quot;PayloadPassthrough&quot;</span>: <span class="token boolean">true</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code"><span class="token punctuation">]</span>
</span></span></span></code></pre></div></div><h4 id="service-defaults-overrides-for-upstream-peered-services" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="service defaults overrides for upstream peered services permalink" href="/consul/docs/upgrading/upgrade-specific#service-defaults-overrides-for-upstream-peered-services"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">service-defaults</code> Overrides for Upstream Peered Services</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In Consul 1.14.x, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">service-defaults</code> upstream <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-defaults#overrides"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">overrides</code></a> apply to both local and peered services as long as the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">name</code> field matches.
Consul 1.15.0 is backward compatible with 1.14 if the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-defaults#peer"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">peer</code></a> is not set in any override.
We recommend converting any upstream peer service overrides as a 1.15.x post-upgrade step.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Before Consul v1.15:</p><div class="g-code-block style_root__i1k0c style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl"><code class="code-lines_code__luWmT language-hcl"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">Kind</span> <span class="token punctuation">=</span> <span class="token string">&quot;service-defaults&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;SERVICE_NAME&gt;&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">Protocol</span>  <span class="token punctuation">=</span> <span class="token string">&quot;http&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">UpstreamConfig</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">Overrides</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">       <span class="token property">Name</span> <span class="token punctuation">=</span> foo      <span class="token comment"># Applies to local `foo` and any peered service `foo`</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In Consul v1.15 and higher:</p><div class="g-code-block style_root__i1k0c style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-hcl"><code class="code-lines_code__luWmT language-hcl"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">Kind</span> <span class="token punctuation">=</span> <span class="token string">&quot;service-defaults&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">Name</span> <span class="token punctuation">=</span> <span class="token string">&quot;&lt;SERVICE_NAME&gt;&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">Protocol</span>  <span class="token punctuation">=</span> <span class="token string">&quot;http&quot;</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token property">UpstreamConfig</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">Overrides</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">       <span class="token property">Name</span> <span class="token punctuation">=</span> foo  <span class="token comment"># Applies to local service `foo`</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>,<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">       <span class="token property">Name</span> <span class="token punctuation">=</span> foo  <span class="token comment"># Applies to `foo` imported from peered cluster `bar`</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">       <span class="token property">Peer</span> <span class="token punctuation">=</span> bar<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">]</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><h2 id="consul-1-14-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 14 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-14-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.14.x</h2><h3 id="service-mesh-compatibility-1" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="service mesh compatibility permalink" href="/consul/docs/upgrading/upgrade-specific#service-mesh-compatibility-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Service Mesh Compatibility</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Prior to Consul 1.14, cluster peering and Consul service mesh were disabled by default.
A breaking change was made in Consul 1.14 that:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/cluster-peering">Cluster Peering is enabled by default.</a>
Cluster peering and WAN federation can coexist,
so there is no need to disable cluster peering to upgrade existing WAN federated datacenters.
To disable cluster peering nonetheless, set <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#peering_enabled"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">peering.enabled</code></a> to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>.</li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect">Consul service mesh is enabled by default.</a>
To disable, set <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#connect_enabled"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">connect.enabled</code></a> to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>.</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The changes to Consul service mesh in version 1.14 are incompatible with Nomad 1.4.3 and
earlier. If you operate Consul service mesh using Nomad 1.4.3 or earlier, do not upgrade to
Consul 1.14 until <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/nomad/issues/15266">hashicorp/nomad#15266</a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/nomad/issues/15360">hashicorp/nomad#15360</a> have been fixed.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">For 1.14.0, there is a known issue with <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul connect envoy</code>. If the command is configured
to use TLS for contacting the HTTP API, it will also incorrectly enable TLS for gRPC.
Users should not upgrade to 1.14.0 if they are using plaintext gRPC connections in
conjunction with TLS-encrypted HTTP APIs.</p><h4 id="vault-enterprise-as-ca-2" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="vault enterprise as ca permalink" href="/consul/docs/upgrading/upgrade-specific#vault-enterprise-as-ca-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><a id="vault-enterprise-as-ca-1-14" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-h __compat" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a>Vault Enterprise as CA</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Using Vault as CA with Consul version 1.14.10 will fail to initialize the CA if <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#namespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">namespace</code></a> is set
but <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#intermediatepkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">intermediate_pki_namespace</code></a> or <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#rootpkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">root_pki_namespace</code></a>
are empty. This is a bug which will be fixed in a future version.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To work around this issue, users must explicitly set <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#intermediatepkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">intermediate_pki_namespace</code></a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#rootpkinamespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">root_pki_namespace</code></a> to the same value as <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#namespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">namespace</code></a>.
Set your configuration by calling <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/ca#set-config">set-config</a> then use <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/ca#get-config">get-config</a> to check.</p><h4 id="changes-to-grpc-tls-configuration" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="changes to grpc tls configuration permalink" href="/consul/docs/upgrading/upgrade-specific#changes-to-grpc-tls-configuration"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Changes to gRPC TLS configuration</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>Make configuration changes</strong> if using <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#grpc_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.grpc</code></a> in conjunction with any of the following settings that enables encryption:</p><ol class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_grpc"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.grpc</code></a></li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_defaults"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.defaults</code></a></li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#auto_encrypt"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">auto_encrypt</code></a></li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#auto_config"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">auto_config</code></a></li></ol><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Prior to Consul 1.14, it was possible to encrypt communication between Consul and Envoy over <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.grpc</code> using these settings.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.14 introduces <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#grpc_tls_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.grpc_tls</code></a>, a new configuration
for encrypting communication over gRPC. The existing <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#grpc_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.grpc</code></a> configuration <strong>no longer supports encryption</strong>. As of version 1.14,
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#grpc_tls_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.grpc_tls</code></a> is the only port that serves encrypted gRPC traffic.
The default value for the gRPC TLS port is 8503 for Consul servers. To disable the gRPC TLS port, use value -1.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If you already use gRPC encryption, change the following fields to ensure compatibility:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">Change <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.grpc</code> to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.grpc_tls</code>. Refer to the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#grpc_tls_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">grpc_tls_port</code> documentation</a> for details.</li><li class="mdx-lists_listItem__nkqhg">Change <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">addresses.grpc</code> to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">addresses.grpc_tls</code>. Refer to the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#grpc_tls"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">grpc_tls</code> documentation</a> for details.</li><li class="mdx-lists_listItem__nkqhg">Update <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul connect envoy</code> command invocations to specify gRPC CA certificates with one of the new configuration options:
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/envoy#grpc-ca-file"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-grpc-ca-file</code></a> or
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/envoy#grpc-ca-path"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-grpc-ca-path</code></a>
(or their corresponding environment variables).</li></ul><h4 id="changes-to-peering" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="changes to peering permalink" href="/consul/docs/upgrading/upgrade-specific#changes-to-peering"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Changes to peering</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/cluster-peering">Cluster peering</a> was released in Consul 1.13 as an experimental feature.
In Consul 1.14, cluster peering has been improved and is now considered stable. All experimental peering
connections created by 1.13 should be
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/cluster-peering/usage/manage-connections#delete-peering-connections">deleted</a>
prior to upgrading, as they will no longer be compatible with 1.14.</p><h2 id="consul-1-13-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 13 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-13-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.13.x</h2><h3 id="service-mesh-compatibility-2" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="service mesh compatibility permalink" href="/consul/docs/upgrading/upgrade-specific#service-mesh-compatibility-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Service Mesh Compatibility</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Before upgrading existing Consul deployments using service mesh to Consul 1.13.x,
review the following guidances relevant to your deployment:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#all-service-mesh-deployments">All service mesh deployments</a></li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#service-mesh-deployments-using-auto-encrypt-or-auto-config">Service mesh deployments using auto-encrypt or auto-config</a></li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#service-mesh-deployments-without-the-https-port-enabled-on-consul-agents">Service mesh deployments without the HTTPS port enabled on Consul agents</a></li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider">All service mesh deployments using the Vault CA provider</a></li></ul><h4 id="all-service-mesh-deployments" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="all service mesh deployments permalink" href="/consul/docs/upgrading/upgrade-specific#all-service-mesh-deployments"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>All service mesh deployments</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Upgrade to <strong>Consul version 1.13.1 or later</strong>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.13.0 contains a bug that prevents Consul server agents from restoring
saved state on startup if the state</p><ol class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">was generated before Consul 1.13 (such as during an upgrade), and</li><li class="mdx-lists_listItem__nkqhg">contained any service mesh proxy registrations.</li></ol><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This bug is fixed in Consul versions 1.13.1 and newer.</p><h4 id="service-mesh-deployments-using-auto-encrypt-or-auto-config" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="service mesh deployments using auto encrypt or auto config permalink" href="/consul/docs/upgrading/upgrade-specific#service-mesh-deployments-using-auto-encrypt-or-auto-config"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Service mesh deployments using auto-encrypt or auto-config</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Upgrade to <strong>Consul version 1.13.2 or later</strong> if using
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#auto_encrypt">auto-encrypt</a> or
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#auto_config">auto-config</a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In Consul 1.13.0 - 1.13.1, auto-encrypt and auto-config both cause Consul
to require TLS for gRPC communication with Envoy proxies.
In environments where Envoy proxies are not already configured
to use TLS for gRPC, upgrading to Consul 1.13.0 - 1.13.1 will cause
Envoy proxies to disconnect from the control plane (Consul agents).</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If upgrading to version 1.13.2 or later, you must enable
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#use_auto_cert">tls.grpc.use_auto_cert</a>
if you currently rely on Consul agents presenting the auto-encrypt or
auto-config certs as the TLS server certs on the gRPC port.
The new <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">use_auto_cert</code> flag enables TLS for gRPC based on the presence
of auto-encrypt certs.</p><h4 id="service-mesh-deployments-without-the-https-port-enabled-on-consul-agents" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="service mesh deployments without the https port enabled on consul agents permalink" href="/consul/docs/upgrading/upgrade-specific#service-mesh-deployments-without-the-https-port-enabled-on-consul-agents"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><a id="grpc-tls" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-h __compat" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a>Service mesh deployments without the HTTPS port enabled on Consul agents</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If the HTTPS port is not enabled
(<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#https_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports { https = POSITIVE_INTEGER }</code></a>)
on a pre-1.13 Consul agent,
<strong><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#modify-the-consul-agent-s-tls-configuration">modify the agent&#x27;s TLS configuration before upgrading</a></strong>
to avoid Envoy proxies disconnecting from the control plane (Consul agents).
Envoy proxies include service mesh sidecars and gateways.</p><h5 id="changes-to-grpc-and-http-interface-configuration" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h5__d2ufM"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="changes to grpc and http interface configuration permalink" href="/consul/docs/upgrading/upgrade-specific#changes-to-grpc-and-http-interface-configuration"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Changes to gRPC and HTTP interface configuration</h5><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If a Consul agent&#x27;s HTTP API is exposed externally,
enabling HTTPS (TLS encryption for HTTP) is important.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The gRPC interface is used for xDS communication between Consul and
Envoy proxies when using Consul service mesh.
A Consul agent&#x27;s gRPC traffic is often loopback-only,
which TLS encryption is not important for.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Prior to Consul 1.13, if <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#https_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports { https = POSITIVE_INTEGER }</code></a>
was configured, TLS was enabled for both HTTP <em>and</em> gRPC.
This was inconvenient for deployments that
needed TLS for HTTP, but not for gRPC.
Enabling HTTPS also required launching Envoy proxies
with the necessary TLS material for xDS communication
with its Consul agent via TLS over gRPC.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.13 addresses this inconvenience by fully decoupling the TLS configuration for HTTP and gRPC interfaces.
TLS for gRPC is no longer enabled by setting
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#https_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports { https = POSITIVE_INTEGER }</code></a>.
TLS configuration for gRPC is now determined exclusively by:</p><ol class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_grpc"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.grpc</code></a>, which overrides</li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_defaults"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.defaults</code></a>, which overrides</li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_deprecated_options">Deprecated TLS options</a> such as
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#ca_file-4"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ca_file</code></a>,
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#cert_file-4"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">cert_file</code></a>, and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#key_file-4"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">key_file</code></a>.</li></ol><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This decoupling has a side effect that requires a
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#modify-the-consul-agent-s-tls-configuration">TLS configuration change</a>
for pre-1.13 agents without the HTTPS port enabled.
Without a TLS configuration change,
Consul 1.13 agents may now expect gRPC <em>with</em> TLS,
causing communication to fail with Envoy proxies
that continue to use gRPC <em>without</em> TLS.</p><h5 id="modify-the-consul-agent-s-tls-configuration" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h5__d2ufM"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="modify the consul agent s tls configuration permalink" href="/consul/docs/upgrading/upgrade-specific#modify-the-consul-agent-s-tls-configuration"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Modify the Consul agent&#x27;s TLS configuration</h5><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_grpc"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.grpc</code></a>,
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_defaults"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.defaults</code></a>,
or the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_deprecated_options">deprecated TLS options</a>
define TLS material in their
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ca_file</code>, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ca_path</code>, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">cert_file</code>, or <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">key_file</code> fields,
TLS for gRPC will be enabled in Consul 1.13, even if
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#https_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports { https = POSITIVE_INTEGER }</code></a>
is not set.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This will cause Envoy proxies to disconnect from the control plane
after upgrading to Consul 1.13 if associated pre-1.13 Consul agents
have <strong>not</strong> set
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#https_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports { https = POSITIVE_INTEGER }</code></a>.
To avoid this problem, make the following agent configuration changes:</p><ol class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Remove TLS material from the Consul agents&#x27;
interface-generic TLS configuration options:
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_grpc"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.defaults</code></a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_deprecated_options">deprecated TLS options</a></p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Reapply TLS material to the non-gRPC interfaces that need it with the
interface-specific TLS configuration stanzas
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#tls-configuration">introduced in Consul 1.12</a>:
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_https"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.https</code></a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls_internal_rpc"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls.internal_rpc</code></a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If upgrading directly from pre-1.12 Consul,
the above configuration change cannot be made before upgrading.
Therefore, consider upgrading agents to Consul 1.12 before upgrading to 1.13.</p></li></ol><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If pre-1.13 Consul agents have set
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#https_port"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports { https = POSITIVE_INTEGER }</code></a>,
this configuration change is not required to upgrade.
That setting means the pre-1.13 Consul agent requires TLS for gRPC <em>already</em>,
and will continue to do so after upgrading to 1.13.
If your pre-1.13 service mesh is working, you have already
configured your Envoy proxies to use TLS for gRPC when bootstrapping Envoy
via <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/envoy"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul connect envoy</code></a>,
such as with flags or environment variables like
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/envoy#ca-file"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-ca-file</code></a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands#consul_cacert"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">CONSUL_CACERT</code></a>.</p><h4 id="modify-vault-policy-for-vault-ca-provider" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="modify vault policy for vault ca provider permalink" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Modify Vault policy for Vault CA provider</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If using the Vault CA provider,
modify the Vault policy used by Consul to interact with Vault
to ensure that certificates required for service mesh operation can still be generated.
The policy must include the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">update</code> capability on the intermediate PKI&#x27;s tune mount configuration endpoint
at path <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/sys/mounts/&lt;intermediate_pki_mount_name&gt;/tune</code>.
Refer to the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/ca/vault#vault-acl-policies">Vault CA provider documentation</a>
for updated example Vault policies for use with Vault-managed or Consul-managed PKI paths.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">You are using the Vault CA provider if either of the following configurations exists:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">The Consul server agent configuration option <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#connect_ca_provider"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">connect.ca_provider</code></a> is set to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">vault</code>, or</li><li class="mdx-lists_listItem__nkqhg">The Consul on Kubernetes Helm Chart <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/k8s/helm#v-global-secretsbackend-vault-connectca"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">global.secretsBackend.vault.connectCA</code></a> value is configured.</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Though this guidance is listed in the 1.13.x section, it applies to several release series.
Affected Consul versions contain a
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/pull/14516">bugfix that allows the intermediate CA&#x27;s TTL configuration to be modified</a>.
The bugfix requires the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">update</code> capability to tune that configuration.
Without the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">update</code> capability, the Consul versions listed in the <em>breaking change</em> column
cannot provide services with the certificates they need to participate in the mesh.
The Consul versions in the <em>recommended versions</em> column restore the intermediate CA&#x27;s ability
to provide certificates even without the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">update</code> capability on the tune configuration endpoint,
though the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">update</code> capability will still be needed to modify the CA&#x27;s TTL configuration.</p><div class="mdx-table_root__adKqa"><div class="mdx-table_tableWrapper__81O9J"><table><thead><tr><th>Release Series</th><th>Versions with breaking change</th><th>Recommended versions</th></tr></thead><tbody><tr><td>Consul 1.13.x</td><td>1.13.2</td><td>1.13.3 or later</td></tr><tr><td>Consul 1.12.x</td><td>1.12.5</td><td>1.12.6 or later</td></tr><tr><td>Consul 1.11.x</td><td>1.11.9 - 1.11.10</td><td>1.11.11 or later</td></tr></tbody></table></div><div class="mdx-table_tableFocusRing__qNrYf"></div><div><div class="mdx-table_leftScrim__mYsmq mdx-table_scrim__VtktE"></div><div class="mdx-table_rightScrim__Ikt63 mdx-table_scrim__VtktE"></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">As a precaution, we recommend both modifying the Vault policy
and upgrading to a recommended version as a double protection
to ensure the operation of your service mesh and to enable CA TTL modification.</p><h3 id="1-9-telemetry-compatibility" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="1 9 telemetry compatibility permalink" href="/consul/docs/upgrading/upgrade-specific#1-9-telemetry-compatibility"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>1.9 Telemetry Compatibility</h3><h4 id="removing-configuration-options-1" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="removing configuration options permalink" href="/consul/docs/upgrading/upgrade-specific#removing-configuration-options-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Removing configuration options</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-disable_compat_1.9"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">disable_compat_19</code></a> telemetry configuration option is now removed.
In prior Consul versions (1.10.x through 1.11.x), the config defaulted to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>. In 1.12.x it defaulted to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>.
If you were using this flag, you must remove it before upgrading.</p><h3 id="modify-vault-policy-for-vault-ca-provider-1" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="modify vault policy for vault ca provider permalink" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Modify Vault Policy for Vault CA Provider</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Follow the same guidance as provided in the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider">1.13 upgrade section for modifying the Vault policy if using the Vault CA provider</a>.
A breaking change was made in Consul 1.13.2 that impacts service mesh operation
if the Vault policy is not modified as described.
As a precaution, we recommend both modifying the Vault policy and upgrading
to Consul 1.13.3 or later to avoid the breaking nature of that change.</p><h3 id="nomad-incompatibility" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="nomad incompatibility permalink" href="/consul/docs/upgrading/upgrade-specific#nomad-incompatibility"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Nomad Incompatibility</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Nomad users should not upgrade to Consul v1.13.8. An API change in this Consul
release prevents Nomad from correctly detecting the Consul agent version. As a
result, allocations are not placed in clients running v1.13.8.</p><h2 id="consul-1-12-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 12 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-12-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><a id="consul-1-12-0" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-h __compat" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a>Consul 1.12.x</h2><h3 id="modify-vault-policy-for-vault-ca-provider-2" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="modify vault policy for vault ca provider permalink" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Modify Vault Policy for Vault CA Provider</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Follow the same guidance as provided in the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider">1.13 upgrade section for modifying the Vault policy if using the Vault CA provider</a>.
A breaking change was made in Consul 1.12.5 that impacts service mesh operation
if the Vault policy is not modified as described.
As a precaution, we recommend both modifying the Vault policy and upgrading
to Consul 1.12.6 or later to avoid the breaking nature of that change.</p><h3 id="1-9-telemetry-compatibility-1" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="1 9 telemetry compatibility permalink" href="/consul/docs/upgrading/upgrade-specific#1-9-telemetry-compatibility-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>1.9 Telemetry Compatibility</h3><h4 id="changing-the-default-behavior-for-option" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="changing the default behavior for option permalink" href="/consul/docs/upgrading/upgrade-specific#changing-the-default-behavior-for-option"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Changing the default behavior for option</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-disable_compat_1.9"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">disable_compat_19</code></a> telemetry configuration option now defaults
to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>. In prior Consul versions (1.10.x through 1.11.x), the config defaulted to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>. If you require 1.9 style
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.http...</code> metrics, you may enable them by setting the flag to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>. However, be advised that these metrics, as
well as the flag will be removed in upcoming Consul 1.13. We recommend changing your instrumentation to use 1.10 and later
style <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.api.http...</code> metrics and removing the configuration flag from your setup.</p><h3 id="nomad-namespace-incompatibility" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="nomad namespace incompatibility permalink" href="/consul/docs/upgrading/upgrade-specific#nomad-namespace-incompatibility"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Nomad Namespace Incompatibility</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Nomad Enterprise users should not upgrade to Consul Enterprise 1.12.0, and instead should upgrade to 1.12.1 or later.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.12.0 Enterprise introduced a change that prevents Nomad Enterprise from removing services from non-default Consul namespaces.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The Consul Enterprise codebase was updated with a fix for this issue in version 1.12.1.</p><h3 id="tls-configuration" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="tls configuration permalink" href="/consul/docs/upgrading/upgrade-specific#tls-configuration"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>TLS Configuration</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">You can now configure TLS differently for each of Consul&#x27;s exposed ports. As a
result, the following top-level configuration fields are deprecated and should
be replaced with the new <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#tls-configuration-reference"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls</code> stanza</a>:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a id="cert_file" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="cert_file permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#cert_file"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">cert_file</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="key_file" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="key_file permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#key_file"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">key_file</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="ca_file" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="ca_file permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#ca_file"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ca_file</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="ca_path" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="ca_path permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#ca_path"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ca_path</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="tls_min_version" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="tls_min_version permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#tls_min_version"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls_min_version</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="tls_cipher_suites" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="tls_cipher_suites permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#tls_cipher_suites"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls_cipher_suites</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="verify_incoming" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="verify_incoming permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#verify_incoming"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">verify_incoming</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="verify_incoming_rpc" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="verify_incoming_rpc permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#verify_incoming_rpc"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">verify_incoming_rpc</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="verify_incoming_https" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="verify_incoming_https permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#verify_incoming_https"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">verify_incoming_https</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="verify_outgoing" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="verify_outgoing permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#verify_outgoing"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">verify_outgoing</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="verify_server_hostname" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="verify_server_hostname permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#verify_server_hostname"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">verify_server_hostname</code></a></li></ul><h2 id="consul-1-11-x" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 11 x permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-11-x"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><a id="consul-1-11-0" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-h __compat" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a>Consul 1.11.x</h2><h3 id="1-10-compatibility" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="1 10 compatibility permalink" href="/consul/docs/upgrading/upgrade-specific#1-10-compatibility"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>1.10 Compatibility <span class="enterprise-alert_root__mvEIF enterprise-alert_inline__IqpbC"><span class="g-screen-reader-only">Enterprise</span><span aria-hidden="true" class="badge_root___Z7Nt badge_medium__8VGoW badge_outlined-neutral__32YXY enterprise-alert_badge___N2fV"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg><span>Enterprise</span></span></span></h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul Enterprise versions 1.10.0 through 1.10.4 contain a latent bug that
causes those client or server agents to deregister their own services or health
checks when some of the servers have been upgraded to 1.11 or later.
Before upgrading Consul Enterprise servers to 1.11 or later,
you should first upgrade all Consul client and server agents to 1.10.7 or higher
to ensure forward compatibility and prevent flapping of catalog registrations.</p><h3 id="deprecated-agent-config-options" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="deprecated agent config options permalink" href="/consul/docs/upgrading/upgrade-specific#deprecated-agent-config-options"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Deprecated Agent Config Options</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.11.0 is compiled with Go 1.17 and now the ordering of
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls_cipher_suites</code> will no longer be honored. Additionally
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls_prefer_server_cipher_suites</code> is now ignored.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">master</code> and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">agent_master</code> ACL tokens in the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl.tokens</code> config block
have been renamed to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">initial_management</code> and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">agent_recovery</code> respectively.
The old names have been deprecated and will be removed at a future date.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Due to this rename the following endpoint is also deprecated:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/agent#update-acl-tokens"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">PUT /v1/agent/token/agent_master</code></a></li></ul><h3 id="deprecated-agent-config-options-1" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="deprecated agent config options permalink" href="/consul/docs/upgrading/upgrade-specific#deprecated-agent-config-options-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Deprecated Agent Config Options <span class="enterprise-alert_root__mvEIF enterprise-alert_inline__IqpbC"><span class="g-screen-reader-only">Enterprise</span><span aria-hidden="true" class="badge_root___Z7Nt badge_medium__8VGoW badge_outlined-neutral__32YXY enterprise-alert_badge___N2fV"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg><span>Enterprise</span></span></span></h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">These config keys are now deprecated:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a id="audit-sink-name" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="audit sink name permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#audit-sink-name"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">audit.sink[].name</code></a></li><li class="mdx-lists_listItem__nkqhg"><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#dns_prefer_namespace"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">dns_config.dns_prefer_namespace</code></a></li></ul><h3 id="deprecated-cli-subcommands" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="deprecated cli subcommands permalink" href="/consul/docs/upgrading/upgrade-specific#deprecated-cli-subcommands"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Deprecated CLI Subcommands</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul acl set-agent-token master</code> subcommand has been replaced with
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul acl set-agent-token recovery</code>. The old subcommand is deprecated.</p><h3 id="legacy-acl-system-removal" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="legacy acl system removal permalink" href="/consul/docs/upgrading/upgrade-specific#legacy-acl-system-removal"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Legacy ACL System Removal</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The legacy ACL system that was deprecated in Consul 1.4.0 was removed in 1.11.0.
Before upgrading you should verify that nothing is still using the legacy ACL
system. Complete the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/security-operations/access-control-token-migration">Migrate Legacy ACL Tokens</a> tutorial to learn more.</p><h3 id="raft-storage-changes" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="raft storage changes permalink" href="/consul/docs/upgrading/upgrade-specific#raft-storage-changes"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Raft Storage Changes</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The underlying library used for persisting the Raft log to persistent storage
was <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/issues/11720">upgraded</a> from
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://pkg.go.dev/github.com/boltdb/bolt"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">boltdb</code></a> to
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://pkg.go.dev/go.etcd.io/bbolt"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">bbolt</code></a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The newer <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">bbolt</code> library is compatible with the persisted format generated by
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">boltdb</code> but the reverse is not necessarily guaranteed. Like any Consul upgrade
it is strongly recommended that you take a snapshot of your database if you
expect that you will need to downgrade.</p><h3 id="envoy-xds-protocol-upgrades" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="envoy xds protocol upgrades permalink" href="/consul/docs/upgrading/upgrade-specific#envoy-xds-protocol-upgrades"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Envoy xDS Protocol Upgrades</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">As noted in earlier upgrades, previous versions of Consul supported both v2 and v3
variants of the XDS Transport Protocol. In Consul 1.11, support for Envoy 1.16 is
removed and consequently v2 is no longer supported. What this means is that if
you have generated your Envoy bootstrap files using the Consul CLI that is newer
than 1.10, you must make sure that you upgrade Consul and Envoy per the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#stairstep-upgrade-path">Stairstep Upgrade Path</a> before upgrading to Consul 1.11.
When upgrading to Consul 1.10, you must ensure that the Envoy sidecars are
restarted and bootstrapped using a version of the Consul CLI &gt;= 1.10. This
ensures your sidecars are supported by Consul 1.11.</p><h3 id="modify-vault-policy-for-vault-ca-provider-3" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="modify vault policy for vault ca provider permalink" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Modify Vault Policy for Vault CA Provider</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Follow the same guidance as provided in the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#modify-vault-policy-for-vault-ca-provider">1.13 upgrade section for modifying the Vault policy if using the Vault CA provider</a>.
A breaking change was made in Consul 1.11.9 that impacts service mesh operation
if the Vault policy is not modified as described.
As a precaution, we recommend both modifying the Vault policy and upgrading
to Consul 1.11.11 or later to avoid the breaking nature of that change.</p><h2 id="consul-1-10-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 10 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-10-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.10.0</h2><h3 id="licensing-changes" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="licensing changes permalink" href="/consul/docs/upgrading/upgrade-specific#licensing-changes"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Licensing Changes <span class="enterprise-alert_root__mvEIF enterprise-alert_inline__IqpbC"><span class="g-screen-reader-only">Enterprise</span><span aria-hidden="true" class="badge_root___Z7Nt badge_medium__8VGoW badge_outlined-neutral__32YXY enterprise-alert_badge___N2fV"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg><span>Enterprise</span></span></span></h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">You can only upgrade to Consul Enterprise 1.10 from the following Enterprise versions:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">1.8 release series: 1.8.13+</li><li class="mdx-lists_listItem__nkqhg">1.9 release series: 1.9.7+</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Other versions of Consul Enterprise are not forward compatible with v1.10 and will
cause issues during the upgrade that could result in agents failing to start due to
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/enterprise/license/faq">changes in the way we manage licenses</a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul Enterprise 1.10 has removed temporary licensing capabilities from the binaries
found on <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://releases.hashicorp.com.">https://releases.hashicorp.com.</a> Servers will no longer load a license previously
set through the CLI or API. Instead the license must be present in the server&#x27;s configuration
or environment prior to starting. See the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/enterprise/license/overview">licensing documentation</a>
for more information about how to configure the license. Client agents previously retrieved their
license from the servers in the cluster within 30 minutes of starting and the snapshot agent
would similarly retrieve its license from the server or client agent it was configured to use. As
of Consul Enterprise 1.10 both the snapshot agent and client agent have gained the ability to
have a license loaded from a configuration file or from their environment the same way server
agents must have the license specified. Both agents can still perform automatic retrieval of their
license but with a few extra stipulations. First, license auto-retrieval now requires that ACLs
are on and that the client or snapshot agent is configured with a valid ACL token. Secondly, client
agents require that either the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#start_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">start_join</code></a> or
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">retry_join</code></a> configurations are set and that they resolve to server
agents. If those stipulations are not met, attempting to start the client or snapshot agent will
result in it immediately shutting down.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">For the step by step upgrade procedures see the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/instructions/upgrade-to-1-10-x">Upgrading to 1.10.0</a> documentation.
For answers to common licensing questions please refer to the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/enterprise/license/faq">FAQ</a></p><h3 id="envoy-xds-protocol-upgrades-1" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="envoy xds protocol upgrades permalink" href="/consul/docs/upgrading/upgrade-specific#envoy-xds-protocol-upgrades-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Envoy xDS Protocol Upgrades</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul versions 1.9 and earlier exposed an xDS server for use by
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://www.envoyproxy.io">Envoy</a> proxies using the v2 <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://www.envoyproxy.io/docs/envoy/v1.17.2/api-docs/xds_protocol#variants-of-the-xds-transport-protocol">&quot;State of the
World&quot;</a>
protocol variant.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.10.0 adds support for the v3
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://www.envoyproxy.io/docs/envoy/v1.17.2/api-docs/xds_protocol#incremental-xds">Incremental</a>
protocol variant as the preferred way of conversing with Envoy. Both protocol
variants are supported in this Consul version to facilitate upgrading Consul
and Envoy in a stairstep order to avoid downtime.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-11-0">Consul 1.11</a> the v2 State of the World protocol support will be removed.</p><div class="mdx-table_root__adKqa"><div class="mdx-table_tableWrapper__81O9J"><table><thead><tr><th>Protocol</th><th>Version</th><th>Compatible Envoy Versions</th><th>Compatible Consul Versions</th></tr></thead><tbody><tr><td>Incremental</td><td>v3</td><td>1.18.x, 1.17.x, 1.16.x, 1.15.x</td><td>1.10.x</td></tr><tr><td>State of the World</td><td>v2</td><td>1.16.x and older</td><td>1.10.x and older</td></tr></tbody></table></div><div class="mdx-table_tableFocusRing__qNrYf"></div><div><div class="mdx-table_leftScrim__mYsmq mdx-table_scrim__VtktE"></div><div class="mdx-table_rightScrim__Ikt63 mdx-table_scrim__VtktE"></div></div></div><h4 id="escape-hatches" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="escape hatches permalink" href="/consul/docs/upgrading/upgrade-specific#escape-hatches"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Escape Hatches</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Any <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/proxies/envoy#advanced-configuration">escape hatches</a> that
are defined will likely need to be switched from using xDS v2 to xDS v3
structures. Mostly this involves migrating off of deprecated (and now removed)
fields and switching untyped config to <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://www.envoyproxy.io/docs/envoy/v1.17.2/configuration/overview/extension">typed config</a>
with <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">@type</code> attributes set appropriately.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">xDS v3 syntax has been <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://www.envoyproxy.io/docs/envoy/v1.13.0/api-v3/api">supported since Envoy
1.13.0</a> so this could
be done on most earlier versions of Consul+Envoy in advance of the Consul
1.10.0 upgrade.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">As an example, here&#x27;s a Zipkin integration
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/blob/v1.9.5/test/integration/connect/envoy/case-zipkin/service_s2.hcl">before</a>
and <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/blob/71d45a34601423abdfc0a64d44c6a55cf88fa2fc/test/integration/connect/envoy/case-zipkin/service_s2.hcl">after</a></p><h4 id="stairstep-upgrade-path" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="stairstep upgrade path permalink" href="/consul/docs/upgrading/upgrade-specific#stairstep-upgrade-path"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Stairstep Upgrade Path</h4><ol class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Upgrade Envoy sidecars to the latest version of Envoy that is
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/proxies/envoy#supported-versions">supported</a> by the currently
running version of Consul as well as Consul 1.10.0.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Determine if you are using the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/proxies/envoy#advanced-configuration">escape hatch</a>
feature. If so, rewrite the escape hatch to use the xDS v3 syntax and update
the service registration to reflect the updated escape hatch configuration
by re-registering. This should purge v2 elements from any configs.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Perform a normal upgrade of both Consul servers and clients to 1.10.0. At
this point the existing Envoy instances will continue to speak the v2 State
of the World protocol to the new Consul instances without issue.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Once a Consul client is upgraded, use an updated CLI binary to re-bootstrap
and restart Envoy using <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/connect/envoy"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul connect envoy</code></a>.
This will ensure it switches over to the v3 Incremental xDS protocol.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Depending upon how you have chosen to run Envoy this is either one step
(<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul connect envoy</code>) or two steps (<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul connect envoy -bootstrap</code>
followed by running Envoy directly).</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">(Optionally) upgrade Envoy to the latest version supported in Consul 1.10.0.</p></li></ol><h3 id="transparent-proxy-on-kubernetes" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="transparent proxy on kubernetes permalink" href="/consul/docs/upgrading/upgrade-specific#transparent-proxy-on-kubernetes"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Transparent Proxy on Kubernetes</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When upgrading to Consul &gt;= 1.10.0, Consul-helm &gt;= 0.32.0, and Consul-k8s &gt;= 0.26.0, a Kubernetes Service must be added for every service registered to Consul. This Service should be added before
performing the upgrade. This will allow services to be managed by a central component, called <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">endpoints-controller</code>, which will enable features like
transparent proxy.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">After the upgrade is performed, all Pods of a service will need to be restarted. The service will be up and health
checks will continue to work without restarting the service, but a restart is required so the Pods can be re-injected with the latest
container configuration.</p><h2 id="consul-1-9-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 9 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-9-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.9.0</h2><h3 id="changes-to-raft-protocol-support" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="changes to raft protocol support permalink" href="/consul/docs/upgrading/upgrade-specific#changes-to-raft-protocol-support"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Changes to Raft Protocol Support</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.8 supported Raft protocols 2 and 3. Consul 1.9.0 now only supports
Raft protocol 3. Consul has defaulted to using Raft protocol 3 since version 1.0.0,
so this should only impact users who have been using Consul prior to 1.0.0 and
may have the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">raft_protocol</code> config setting set to 2. Users in that position
should upgrade to a previous release supporting both protocol versions and
update their configuration to use Raft protocol 3 before continuing their upgrade
to Consul 1.9.0.</p><h3 id="changes-to-configuration-defaults" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="changes to configuration defaults permalink" href="/consul/docs/upgrading/upgrade-specific#changes-to-configuration-defaults"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Changes to Configuration Defaults</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#enable_central_service_config"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enable_central_service_config</code></a>
configuration now defaults to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>.</p><h3 id="changes-to-intentions" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="changes to intentions permalink" href="/consul/docs/upgrading/upgrade-specific#changes-to-intentions"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Changes to Intentions</h3><h4 id="namespaced-intentions" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="namespaced intentions permalink" href="/consul/docs/upgrading/upgrade-specific#namespaced-intentions"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Namespaced Intentions <span class="enterprise-alert_root__mvEIF enterprise-alert_inline__IqpbC"><span class="g-screen-reader-only">Enterprise</span><span aria-hidden="true" class="badge_root___Z7Nt badge_medium__8VGoW badge_outlined-neutral__32YXY enterprise-alert_badge___N2fV"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="var(--token-color-consul-brand)"><path d="M4.737 14.193A7 7 0 008.006 15a6.98 6.98 0 004.735-1.847l-1.66-1.737a4.6 4.6 0 110-6.828l1.66-1.738a7 7 0 10-8.004 11.343zM13.32 11.402a.573.573 0 10.637-.953.573.573 0 00-.637.953z"></path><path d="M7.96 9.517a1.517 1.517 0 11-.012-3.034 1.517 1.517 0 01.013 3.034zM13.978 9.447a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 9.472a.574.574 0 110-1.148.574.574 0 010 1.148zM13.978 7.514a.574.574 0 10.637-.954.574.574 0 00-.637.954zM12.59 7.675a.574.574 0 110-1.148.574.574 0 010 1.148zM13.353 5.585a.574.574 0 10.635-.956.574.574 0 00-.635.956z"></path></g></svg><span>Enterprise</span></span></span></h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The API endpoint to <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/connect/intentions#list-intentions">list
intentions</a> now accepts the same
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ns</code> query parameter (or <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">X-Consul-Namespace</code> header) used on other API
endpoints. By default this will now only list the intentions in a specific
namespace, rather than listing all intentions across all namespaces. To achieve
the same results as Consul versions prior to 1.9.0 request the wildcard
namespace with a query parameter of <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">?ns=*</code>.</p><h4 id="migration" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="migration permalink" href="/consul/docs/upgrading/upgrade-specific#migration"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Migration</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Upgrading to Consul 1.9.0 will trigger a one-time background migration of
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/intentions">intentions</a> into an equivalent set of
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-intentions"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">service-intentions</code></a> config
entries. This process will wait until all of the Consul servers in the primary
datacenter are running Consul 1.9.0+.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">All write requests via either the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/connect/intentions">Intentions
API</a> endpoints or <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/config">Config Entry
API</a> endpoints for a <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">service-intentions</code> kind will be
blocked until the migration process is complete after the upgrade. Reads will
function normally throughout the migration, so authorization enforcement will
be unaffected.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Secondary datacenters will perform their own one-time migration operations
after the primary datacenter completes its migration and all of the Consul
servers in the secondary datacenter are running Consul 1.9.0+. It is safe to
upgrade the datacenters in any order.</p><h4 id="deprecated-fields" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="deprecated fields permalink" href="/consul/docs/upgrading/upgrade-specific#deprecated-fields"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Deprecated Fields</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">All old ID-based <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/connect/intentions">Intentions API</a> CRUD endpoints
will retain all of their prior fields <em>as long as those endpoints are
exclusively used to edit intentions</em>. Once the underlying config entry
representation is edited it will transition the intention into the newer format
where some fields are no longer present. Once this transition occurs those
intentions can no longer be used with the ID-based endpoints unless they are
re-created via the old endpoints. Fields that are being removed or changing
behavior:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a id="intention-id" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><a aria-label="intention id permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#intention-id"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Intention.ID</code></a> after migration is stored in the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-intentions#legacyid"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">LegacyID</code></a> field.
After transitioning this field is cleared.</p></li><li class="mdx-lists_listItem__nkqhg"><a id="intention-createdat" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><a aria-label="intention createdat permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#intention-createdat"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Intention.CreatedAt</code></a> after migration is stored in the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-intentions#legacycreatetime"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">LegacyCreateTime</code></a>
field. After transitioning this field is cleared.</p></li><li class="mdx-lists_listItem__nkqhg"><a id="intention-updatedat" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><a aria-label="intention updatedat permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#intention-updatedat"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Intention.UpdatedAt</code></a> after migration is stored in the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-intentions#legacyupdatetime"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">LegacyUpdateTime</code></a>
field. After transitioning this field is cleared.</p></li><li class="mdx-lists_listItem__nkqhg"><a id="intention-meta" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><a aria-label="intention meta permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#intention-meta"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Intention.Meta</code></a> after migration is stored in the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-intentions#legacymeta"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">LegacyMeta</code></a>
field. To complete the transition, this field <strong>must be cleared manually</strong>
and the metadata moved up to the enclosing config entry&#x27;s
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/config-entries/service-intentions#meta"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Meta</code></a> field. This is
not done automatically since it is potentially a lossy operation.</p></li></ul><h2 id="consul-1-8-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 8 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-8-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.8.0</h2><h4 id="removal-of-deprecated-features" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="removal of deprecated features permalink" href="/consul/docs/upgrading/upgrade-specific#removal-of-deprecated-features"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Removal of Deprecated Features</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#acl_enforce_version_8"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_enforce_version_8</code></a>
configuration has been removed (with version 8 ACL support by being on by
default).</p><h2 id="consul-1-7-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 7 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-7-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.7.0</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.7.0 contains three major changes that impact upgrades:
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#stricter-json-decoding">stricter JSON decoding</a>, <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#dns-ptr-record-output">modified DNS outputs</a>,
and <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#session-api">backward-incompatible Session API changes</a>.</p><h3 id="session-api" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="session api permalink" href="/consul/docs/upgrading/upgrade-specific#session-api"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Session API</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.7.0 introduced a backwards incompatible change to the Session API.
Queries to view or renew sessions from agents on earlier versions will be rejected.
This impacts features and products including: Vault, the Enterprise snapshot agent, and locks.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The issue occurs when clients are still running 1.6.4 or earlier but servers have been upgraded to 1.7.0 or 1.7.1.
For this reason, we recommend you upgrade directly to 1.7.2 when it is available as it will include a fix for this issue.</p><h3 id="stricter-json-decoding" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="stricter json decoding permalink" href="/consul/docs/upgrading/upgrade-specific#stricter-json-decoding"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Stricter JSON Decoding</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The HTTP API will now return 400 status codes with a textual error when unknown fields
are present in the payload of a request. Previously, Consul would simply ignore the
unknown fields. You will need to ensure that your API usage only uses supported
fields which are those documented in the example payloads in the API documentation.</p><h3 id="dns-ptr-record-output" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="dns ptr record output permalink" href="/consul/docs/upgrading/upgrade-specific#dns-ptr-record-output"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>DNS PTR Record Output</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul will now return the canonical service name in response to PTR queries. For CE users, the
change is that the datacenter will be present where it was not before. For Consul Enterprise
users, both the datacenter and the services namespace will be present. For example, where a
PTR record would previously have contained <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">web.service.consul</code>, it will now be <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">web.service.dc1.consul</code>
in CE, or <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">web.service.ns1.dc1.consul</code> for Enterprise.</p><h3 id="telemetry-semantics-of-consul-rpc-query-changed-see-consul-rpc-queries_blocking" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="telemetry semantics of consul rpc query changed see consul rpc queries_blocking permalink" href="/consul/docs/upgrading/upgrade-specific#telemetry-semantics-of-consul-rpc-query-changed-see-consul-rpc-queries_blocking"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Telemetry: semantics of <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.rpc.query</code> changed, see <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.rpc.queries_blocking</code></h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul has changed the semantics of query counts in its <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/telemetry#metrics-reference">telemetry</a>.
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.rpc.query</code> now only increments on the <em>start</em> of a query (blocking or non-blocking), whereas before it would
measure when blocking queries polled for more data. The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.rpc.queries_blocking</code> gauge has been added
to more precisely capture the view of <em>active</em> blocking queries.</p><h3 id="vault-default-http_max_conns_per_client-too-low-to-run-vault-properly" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="vault default http_max_conns_per_client too low to run vault properly permalink" href="/consul/docs/upgrading/upgrade-specific#vault-default-http_max_conns_per_client-too-low-to-run-vault-properly"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Vault: default <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">http_max_conns_per_client</code> too low to run Vault properly</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.7.0 introduced <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#http_max_conns_per_client">limiting of connections per client</a>. The default value
was 100, but Vault could use up to 128, which caused problems. If you want to use Vault with Consul 1.7.0, you should change the value to 200.
Starting with Consul 1.7.1 this is the new default.</p><h2 id="consul-1-6-3" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 6 3 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-6-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.6.3</h2><h3 id="vault-default-http_max_conns_per_client-too-low-to-run-vault-properly-1" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="vault default http_max_conns_per_client too low to run vault properly permalink" href="/consul/docs/upgrading/upgrade-specific#vault-default-http_max_conns_per_client-too-low-to-run-vault-properly-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Vault: default <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">http_max_conns_per_client</code> too low to run Vault properly</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.6.3 introduced <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#http_max_conns_per_client">limiting of connections per client</a>. The default value
was 100, but Vault could use up to 128, which caused problems. If you want to use Vault with Consul 1.6.3 through 1.7.0, you should change the value to 200.
Starting with Consul 1.7.1 this is the new default.</p><h2 id="consul-1-6-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 6 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-6-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.6.0</h2><h4 id="removal-of-deprecated-features-1" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="removal of deprecated features permalink" href="/consul/docs/upgrading/upgrade-specific#removal-of-deprecated-features-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Removal of Deprecated Features</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Managed proxies, which are deprecated since Consul v1.3.0, have now been
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/proxies">removed</a>. Before upgrading, you must
migrate any managed proxy usage to <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/proxies/deploy-sidecar-services">sidecar service
registrations</a>.</p><h2 id="consul-1-4-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 4 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-4-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.4.0</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">There are two major features in Consul 1.4.0 that may impact upgrades: a <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#acl-upgrade">new
ACL system</a> and <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#multi-datacenter-service-mesh">multi-datacenter support for
service mesh</a> in the Enterprise version.</p><h3 id="acl-upgrade" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="acl upgrade permalink" href="/consul/docs/upgrading/upgrade-specific#acl-upgrade"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>ACL Upgrade</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.4.0 includes a <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/security/access-control-setup-production">new ACL
system</a>
that is designed to have a smooth upgrade path but requires care to upgrade
components in the right order.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>Note:</strong> As with most major version upgrades, you cannot downgrade once the
upgrade to 1.4.0 is complete as it adds new state to the raft store. As always
it is <em>strongly</em> recommended that you test the upgrade first outside of
production and ensure you take backup snapshots of all datacenters before
upgrading.</p><h4 id="primary-datacenter" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="primary datacenter permalink" href="/consul/docs/upgrading/upgrade-specific#primary-datacenter"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Primary Datacenter</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The &quot;ACL datacenter&quot; in 1.3.x and earlier is now referred to as the &quot;Primary
datacenter&quot;. All configuration is backwards compatible and shouldn&#x27;t need to
change prior to upgrade although it&#x27;s strongly recommended to migrate ACL
configuration to the new syntax soon after upgrade. This includes moving to
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">primary_datacenter</code> rather than <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_datacenter</code> and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_*</code> to the new <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#acl">ACL
block</a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Datacenters can be upgraded in any order although secondaries will remain in
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#legacy-acl-mode">Legacy ACL mode</a> until the primary datacenter is fully
upgraded.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Each datacenter should follow the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading#standard-upgrades">standard rolling upgrade
procedure</a>.</p><h4 id="legacy-acl-mode" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="legacy acl mode permalink" href="/consul/docs/upgrading/upgrade-specific#legacy-acl-mode"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Legacy ACL Mode</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When a 1.4.0 server first starts, it runs in &quot;Legacy ACL mode&quot;. In this mode,
bootstrap requests and new ACL APIs will not be functional yet and will return
an error. The server advertises its ability to support 1.4.0 ACLs via gossip
and waits.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In the primary datacenter, the servers all wait in legacy ACL mode until they
see every server in the primary datacenter advertise 1.4.0 ACL support. Once
this happens, the leader will complete the transition out of &quot;legacy ACL mode&quot;
and write this into the state so future restarts don&#x27;t need to go through the
same transition.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In a secondary datacenter, the same process happens except that servers
<em>additionally</em> wait for all servers in the primary datacenter making it safe to
upgrade datacenters in any order.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">It should be noted that even if you are not upgrading, starting a brand new
1.4.0 cluster will transition through legacy ACL mode so you may be unable to
bootstrap ACLs until all the expected servers are up and healthy.</p><h4 id="legacy-token-accessor-migration" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="legacy token accessor migration permalink" href="/consul/docs/upgrading/upgrade-specific#legacy-token-accessor-migration"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Legacy Token Accessor Migration</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">As soon as all servers in the primary datacenter have been upgraded to 1.4.0,
the leader will begin the process of creating new accessor IDs for all existing
ACL tokens.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This process completes in the background and is rate limited to ensure it
doesn&#x27;t overload the leader. It completes upgrades in batches of 128 tokens and
will not upgrade more than one batch per second so on a cluster with 10,000
tokens, this may take several minutes.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">While this is happening both old and new ACLs will work correctly with the
caveat that new ACL <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/acl/tokens">Token APIs</a> may not return an
accessor ID for legacy tokens that are not yet migrated.</p><h4 id="migrating-existing-acls" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="migrating existing acls permalink" href="/consul/docs/upgrading/upgrade-specific#migrating-existing-acls"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Migrating Existing ACLs</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">New ACL policies have slightly different syntax designed to fix some
shortcomings in old ACL syntax. During and after the upgrade process, any old
ACL tokens will continue to work and grant exactly the same level of access.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">After upgrade, it is still possible to create &quot;legacy&quot; tokens using the existing
API so existing integrations that create tokens (e.g. Vault) will continue to
work. The &quot;legacy&quot; tokens generated though will not be able to take advantage of
new policy features. It&#x27;s recommended that you complete migration of all tokens
as soon as possible after upgrade, as well as updating any integrations to work
with the new ACL <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/acl/tokens">Token</a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/acl/policies">Policy</a> APIs.</p><h3 id="multi-datacenter-service-mesh" class="hds-typography-display-400 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h3__xmS_z"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h3__SkrrS" aria-label="multi datacenter service mesh permalink" href="/consul/docs/upgrading/upgrade-specific#multi-datacenter-service-mesh"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Multi-datacenter service mesh</h3><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This only applies to users upgrading from an older version of Consul Enterprise to Consul Enterprise 1.4.0 (all license types).</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In addition, this upgrade will only affect clusters where <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/connect/configuration">service mesh is enabled</a> on your servers before the migration.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Multi-datacenter service mesh uses the same primary/secondary approach as ACLs and
will use the same <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#primary-datacenter">primary_datacenter</a>. When a secondary
datacenter server restarts with 1.4.0 it will detect it is not the primary and
begin an automatic bootstrap of multi-datacenter CA federation.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Datacenters can be upgraded in either order; secondary datacenters will not
switch into multi-datacenter mode until all servers in both the secondary and
primary datacenter are detected to be running at least Consul 1.4.0. Secondary
datacenters monitor this periodically (every few minutes) and will
automatically upgrade service mesh to use a federated Certificate Authority when
they do.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In general, migrating a Consul cluster from CE to Enterprise will update the
CA to be federated automatically and without impact on service mesh traffic. When
upgrading Consul Enterprise 1.3.x to Consul Enterprise 1.4.0 upgrades the CA
upgrade is seamless, however depending on the size of the cluster, <em>new</em>
connection attempts in the secondary datacenter might fail for a short window
(typically seconds) while the update is propagated due to the 1.3.x Beta
authorization endpoint validating originating cluster in a way that was not
fully forwards compatible with migrating between cluster trust domains. That
issue is fixed in 1.4.0 as part of General Availability.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Once migrated (typically a few seconds). The service mesh will use the primary
datacenter&#x27;s Certificate Authority as the root of trust for all other
datacenters. CA migration or root key changes in the primary will now rotate
automatically and without loss of connectivity throughout all datacenters and
workloads.</p><h2 id="consul-1-3-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 3 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-3-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.3.0</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This version added support for multiple tag filters in service discovery
queries, however it introduced a subtle bug where API calls to
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/catalog/service/:name?tag=&lt;tag&gt;</code> would ignore the tag filter <em>only during the
upgrade</em>. It only occurs when clients are still running 1.2.3 or earlier but
servers have been upgraded. The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/health/service/:name?tag=&lt;tag&gt;</code> endpoint and
DNS interface were <em>not</em> affected.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">For this reason, we recommend you upgrade directly to 1.3.1 which includes only
a fix for this issue.</p><h2 id="consul-1-1-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 1 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-1-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.1.0</h2><h4 id="removal-of-deprecated-features-2" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="removal of deprecated features permalink" href="/consul/docs/upgrading/upgrade-specific#removal-of-deprecated-features-2"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Removal of Deprecated Features</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The following previously deprecated fields and config options have been removed:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a id="checkid" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="checkid permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#checkid"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">CheckID</code></a> has been removed from config file check definitions (use <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">id</code> instead).</li><li class="mdx-lists_listItem__nkqhg"><a id="script" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="script permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#script"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">script</code></a> has been removed from config file check definitions (use <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">args</code> instead).</li><li class="mdx-lists_listItem__nkqhg"><a id="enabletagoverride" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="enabletagoverride permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#enabletagoverride"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enableTagOverride</code></a> is no longer valid in service definitions (use <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enable_tag_override</code> instead).</li><li class="mdx-lists_listItem__nkqhg">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#metric-names-updated">deprecated set of metric names</a> (beginning with <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.consul.</code>) has been removed
along with the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enable_deprecated_names</code> option from the metrics configuration.</li></ul><h4 id="new-defaults-for-raft-snapshot-creation" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="new defaults for raft snapshot creation permalink" href="/consul/docs/upgrading/upgrade-specific#new-defaults-for-raft-snapshot-creation"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>New defaults for Raft Snapshot Creation</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.0.1 (and earlier versions of Consul) checked for raft snapshots every
5 seconds, and created new snapshots for every 8192 writes. These defaults cause
constant disk IO in large busy clusters. Consul 1.1.0 increases these to larger values,
and makes them tunable via the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#_raft_snapshot_interval">raft_snapshot_interval</a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#_raft_snapshot_threshold">raft_snapshot_threshold</a> parameters. We recommend
keeping the new defaults. However, operators can go back to the old defaults by changing their
config if they prefer more frequent snapshots. See the documentation for <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#_raft_snapshot_interval">raft_snapshot_interval</a>
and <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#_raft_snapshot_threshold">raft_snapshot_threshold</a> to understand the trade-offs
when tuning these.</p><h2 id="consul-1-0-7" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 0 7 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-0-7"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.0.7</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When requesting a specific service (<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/v1/health/:service</code> or
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">/v1/catalog/:service</code> endpoints), the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">X-Consul-Index</code> returned is now the
index at which that <em>specific service</em> was last modified. In version 1.0.6 and
earlier the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">X-Consul-Index</code> returned was the index at which <em>any</em> service was
last modified. See <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/issues/3890">GH-3890</a>
for more details.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">During upgrades from 1.0.6 or lower to 1.0.7 or higher, watchers are likely to
see <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">X-Consul-Index</code> for these endpoints decrease between blocking calls.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul&#x27;s watch feature and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul-template</code> should gracefully handle this case.
Other tools relying on blocking service or health queries are also likely to
work; some may require a restart. It is possible external tools could break and
either stop working or continually re-request data without blocking if they
have assumed indexes can never decrease or be reset and/or persist index
values. Please test any blocking query integrations in a controlled environment
before proceeding.</p><h2 id="consul-1-0-1" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 0 1 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-0-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.0.1</h2><h4 id="carefully-check-and-remove-stale-servers-during-rolling-upgrades" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="carefully check and remove stale servers during rolling upgrades permalink" href="/consul/docs/upgrading/upgrade-specific#carefully-check-and-remove-stale-servers-during-rolling-upgrades"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Carefully Check and Remove Stale Servers During Rolling Upgrades</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.0 (and earlier versions of Consul when running with <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#_raft_protocol">Raft protocol
3</a> had an issue where performing
rolling updates of Consul servers could result in an outage from old servers
remaining in the cluster.
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/datacenter-operations/autopilot-datacenter-operations">Autopilot</a>
would normally remove old servers when new ones come online, but it was also
waiting to promote servers to voters in pairs to maintain an odd quorum size.
The pairwise promotion feature was removed so that servers become voters as
soon as they are stable, allowing Autopilot to remove old servers in a safer
way.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When upgrading from Consul 1.0, you may need to manually
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/force-leave">force-leave</a> old servers as part of a rolling
update to Consul 1.0.1.</p><h2 id="consul-1-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 1 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-1-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 1.0</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 1.0 has several important breaking changes that are documented here.
Please be sure to read over all the details here before upgrading.</p><h4 id="raft-protocol-now-defaults-to-3" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="raft protocol now defaults to 3 permalink" href="/consul/docs/upgrading/upgrade-specific#raft-protocol-now-defaults-to-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Raft Protocol Now Defaults to 3</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_raft_protocol"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-raft-protocol</code></a> default has
been changed from 2 to 3, enabling all
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/datacenter-operations/autopilot-datacenter-operations">Autopilot</a>
features by default.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Raft protocol version 3 requires Consul running 0.8.0 or newer on all servers
in order to work, so if you are upgrading with older servers in a cluster then
you will need to set this back to 2 in order to upgrade. See <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#raft-protocol-version-compatibility">Raft Protocol
Version
Compatibility</a>
for more details. Also the format of <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">peers.json</code> used for outage recovery is
different when running with the latest Raft protocol. Review <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/datacenter-operations/recovery-outage#manual-recovery-using-peers-json">Manual Recovery
Using
peers.json</a>
for a description of the required format.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Please note that the Raft protocol is different from Consul&#x27;s internal protocol
as described on the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/upgrading/compatibility">Protocol Compatibility Promise</a>
page, and as is shown in commands like <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul members</code> and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul version</code>.
To see the version of the Raft protocol in use on each server, use the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul operator raft list-peers</code> command.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The easiest way to upgrade servers is to have each server leave the cluster,
upgrade its Consul version, and then add it back. Make sure the new server
joins successfully and that the cluster is stable before rolling the upgrade
forward to the next server. It&#x27;s also possible to stand up a new set of
servers, and then slowly stand down each of the older servers in a similar
fashion.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When using Raft protocol version 3, servers are identified by their
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_node_id"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-node-id</code></a> instead of their IP address
when Consul makes changes to its internal Raft quorum configuration. This means
that once a cluster has been upgraded with servers all running Raft protocol
version 3, it will no longer allow servers running any older Raft protocol
versions to be added. If running a single Consul server, restarting it in-place
will result in that server not being able to elect itself as a leader. To avoid
this, either set the Raft protocol back to 2, or use <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/datacenter-operations/recovery-outage#manual-recovery-using-peers-json">Manual Recovery Using
peers.json</a>
to map the server to its node ID in the Raft quorum configuration.</p><h4 id="config-files-require-an-extension" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="config files require an extension permalink" href="/consul/docs/upgrading/upgrade-specific#config-files-require-an-extension"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Config Files Require an Extension</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">As part of supporting the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/hcl#syntax">HCL</a> format
for Consul&#x27;s config files, an <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">.hcl</code> or <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">.json</code> extension is required for all
config files loaded by Consul, even when using the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_config_file"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-config-file</code></a> argument to specify a
file directly.</p><h4 id="use-snake-case-for-service-definition-parameters" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="use snake case for service definition parameters permalink" href="/consul/docs/upgrading/upgrade-specific#use-snake-case-for-service-definition-parameters"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Use Snake Case for Service Definition Parameters</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Snake case, which is a convention that uses underscores between words in a configuration key, is required for all configuration file formats. Change any camel cased parameter to snake case equivalents before upgrading.</p><h4 id="deprecated-options-have-been-removed" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="deprecated options have been removed permalink" href="/consul/docs/upgrading/upgrade-specific#deprecated-options-have-been-removed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Deprecated Options Have Been Removed</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">All of Consul&#x27;s previously deprecated command line flags and config options
have been removed, so these will need to be mapped to their equivalents before
upgrading. Here&#x27;s the complete list of removed options and their equivalents:</p><div class="mdx-table_root__adKqa"><div class="mdx-table_tableWrapper__81O9J"><table><thead><tr><th>Removed Option</th><th>Equivalent</th></tr></thead><tbody><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-dc</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_datacenter"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-datacenter</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-azure-tag-name</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-azure-tag-value</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-ec2-region</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-ec2-tag-key</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-ec2-tag-value</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-gce-credentials-file</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-gce-project-name</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-gce-tag-name</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-gce-zone-pattern</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">addresses.rpc</code></td><td>None, the RPC server for CLI commands is no longer supported.</td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">advertise_addrs</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#ports"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports</code></a> with <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#advertise_addr"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">advertise_addr</code></a> and/or <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#advertise_addr_wan"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">advertise_addr_wan</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">dogstatsd_addr</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-dogstatsd_addr"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">telemetry.dogstatsd_addr</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">dogstatsd_tags</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-dogstatsd_tags"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">telemetry.dogstatsd_tags</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">http_api_response_headers</code></td><td><a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#response_headers"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">http_config.response_headers</code></a></td></tr><tr><td><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports.rpc</code></td><td>None, the RPC server for CLI commands is no longer supported.</td></tr></tbody></table></div><div class="mdx-table_tableFocusRing__qNrYf"></div><div><div class="mdx-table_leftScrim__mYsmq mdx-table_scrim__VtktE"></div><div class="mdx-table_rightScrim__Ikt63 mdx-table_scrim__VtktE"></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">recursor</code>                                             | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#recursors"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">recursors</code></a>                                                          |
| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">retry_join_azure</code>                                     | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">retry-join</code></a>                                                                                                                       |
| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">retry_join_ec2</code>                                       | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">retry-join</code></a>                                                                                                                       |
| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">retry_join_gce</code>                                       | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#retry_join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">retry-join</code></a>                                                                                                                       |
| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">statsd_addr</code>                                          | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-statsd_address"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">telemetry.statsd_address</code></a>                            |
| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">statsite_addr</code>                                        | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-statsite_address"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">telemetry.statsite_address</code></a>                        |
| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">statsite_prefix</code>                                      | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-metrics_prefix"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">telemetry.metrics_prefix</code></a>                                                                                             |
| <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">telemetry.statsite_prefix</code>                            | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-metrics_prefix"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">telemetry.metrics_prefix</code></a>                                                                                             |
| (service definitions) <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">serviceid</code>                      | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/agent/service#id"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">id</code></a>                                                                                                                                   |
| (service definitions) <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">dockercontainerid</code>              | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/agent/check#dockercontainerid"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">docker_container_id</code></a>                                                                                                                          |
| (service definitions) <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tlsskipverify</code>                  | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/agent/check#tlsskipverify"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">tls_skip_verify</code></a>                                                                                                                              |
| (service definitions) <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">deregistercriticalserviceafter</code> | <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/agent/check#deregistercriticalserviceafter"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">deregister_critical_service_after</code></a>                                                                                                            |</p><h4 id="statsite_prefix-renamed-to-metrics_prefix" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="statsite_prefix renamed to metrics_prefix permalink" href="/consul/docs/upgrading/upgrade-specific#statsite_prefix-renamed-to-metrics_prefix"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">statsite_prefix</code> Renamed to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">metrics_prefix</code></h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Since the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">statsite_prefix</code> configuration option applied to all telemetry
providers, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">statsite_prefix</code> was renamed to
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#telemetry-metrics_prefix"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">metrics_prefix</code></a>.
Configuration files will need to be updated when upgrading to this version of
Consul.</p><h4 id="advertise_addrs-removed" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="advertise_addrs removed permalink" href="/consul/docs/upgrading/upgrade-specific#advertise_addrs-removed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">advertise_addrs</code> Removed</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This configuration option was removed since it was redundant with
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">advertise_addr</code> and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">advertise_addr_wan</code> in combination with <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">ports</code> and also
wrongly stated that you could configure both host and port.</p><h4 id="escaping-behavior-changed-for-go-discover-configs" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="escaping behavior changed for go discover configs permalink" href="/consul/docs/upgrading/upgrade-specific#escaping-behavior-changed-for-go-discover-configs"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Escaping Behavior Changed for go-discover Configs</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The format for <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#retry-join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join</code></a> and
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#retry-join-wan"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-retry-join-wan</code></a> values that use
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/go-discover">go-discover</a> cloud auto joining has
changed. Values in <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">key=val</code> sequences must no longer be URL encoded and can be
provided as literals as long as they do not contain spaces, backslashes <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">\</code> or
double quotes <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">&quot;</code>. If values contain these characters then use double quotes as
in <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">&quot;some key&quot;=&quot;some value&quot;</code>. Special characters within a double quoted string
can be escaped with a backslash <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">\</code>.</p><h4 id="http-verbs-are-enforced-in-many-http-apis" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="http verbs are enforced in many http apis permalink" href="/consul/docs/upgrading/upgrade-specific#http-verbs-are-enforced-in-many-http-apis"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>HTTP Verbs are Enforced in Many HTTP APIs</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Many endpoints in the HTTP API that previously took any HTTP verb now check for
specific HTTP verbs and enforce them. This may break clients relying on the old
behavior. Here&#x27;s the complete list of updated endpoints and required HTTP
verbs:</p><div class="mdx-table_root__adKqa"><div class="mdx-table_tableWrapper__81O9J"><table><thead><tr><th>Endpoint</th><th>Required HTTP Verb</th></tr></thead><tbody><tr><td>/v1/acl/info</td><td>GET</td></tr><tr><td>/v1/acl/list</td><td>GET</td></tr><tr><td>/v1/acl/replication</td><td>GET</td></tr><tr><td>/v1/agent/check/deregister</td><td>PUT</td></tr><tr><td>/v1/agent/check/fail</td><td>PUT</td></tr><tr><td>/v1/agent/check/pass</td><td>PUT</td></tr><tr><td>/v1/agent/check/register</td><td>PUT</td></tr><tr><td>/v1/agent/check/warn</td><td>PUT</td></tr><tr><td>/v1/agent/checks</td><td>GET</td></tr><tr><td>/v1/agent/force-leave</td><td>PUT</td></tr><tr><td>/v1/agent/join</td><td>PUT</td></tr><tr><td>/v1/agent/members</td><td>GET</td></tr><tr><td>/v1/agent/metrics</td><td>GET</td></tr><tr><td>/v1/agent/self</td><td>GET</td></tr><tr><td>/v1/agent/service/register</td><td>PUT</td></tr><tr><td>/v1/agent/service/deregister</td><td>PUT</td></tr><tr><td>/v1/agent/services</td><td>GET</td></tr><tr><td>/v1/catalog/datacenters</td><td>GET</td></tr><tr><td>/v1/catalog/deregister</td><td>PUT</td></tr><tr><td>/v1/catalog/node</td><td>GET</td></tr><tr><td>/v1/catalog/nodes</td><td>GET</td></tr><tr><td>/v1/catalog/register</td><td>PUT</td></tr><tr><td>/v1/catalog/service</td><td>GET</td></tr><tr><td>/v1/catalog/services</td><td>GET</td></tr><tr><td>/v1/coordinate/datacenters</td><td>GET</td></tr><tr><td>/v1/coordinate/nodes</td><td>GET</td></tr><tr><td>/v1/health/checks</td><td>GET</td></tr><tr><td>/v1/health/node</td><td>GET</td></tr><tr><td>/v1/health/service</td><td>GET</td></tr><tr><td>/v1/health/state</td><td>GET</td></tr><tr><td>/v1/internal/ui/node</td><td>GET</td></tr><tr><td>/v1/internal/ui/nodes</td><td>GET</td></tr><tr><td>/v1/internal/ui/services</td><td>GET</td></tr><tr><td>/v1/session/info</td><td>GET</td></tr><tr><td>/v1/session/list</td><td>GET</td></tr><tr><td>/v1/session/node</td><td>GET</td></tr><tr><td>/v1/status/leader</td><td>GET</td></tr><tr><td>/v1/status/peers</td><td>GET</td></tr><tr><td>/v1/operator/area/:uuid/members</td><td>GET</td></tr><tr><td>/v1/operator/area/:uuid/join</td><td>PUT</td></tr></tbody></table></div><div class="mdx-table_tableFocusRing__qNrYf"></div><div><div class="mdx-table_leftScrim__mYsmq mdx-table_scrim__VtktE"></div><div class="mdx-table_rightScrim__Ikt63 mdx-table_scrim__VtktE"></div></div></div><h4 id="unauthorized-kv-requests-return-403" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="unauthorized kv requests return 403 permalink" href="/consul/docs/upgrading/upgrade-specific#unauthorized-kv-requests-return-403"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Unauthorized KV Requests Return 403</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When ACLs are enabled, reading a key with an unauthorized token returns a 403.
This previously returned a 404 response.</p><h4 id="config-section-of-agent-self-endpoint-has-changed" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="config section of agent self endpoint has changed permalink" href="/consul/docs/upgrading/upgrade-specific#config-section-of-agent-self-endpoint-has-changed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Config Section of Agent Self Endpoint has Changed</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The /v1/agent/self endpoint&#x27;s <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Config</code> section has often been in flux as it was
directly returning one of Consul&#x27;s internal data structures. This configuration
structure has been moved under <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">DebugConfig</code>, and is documents as for debugging
use and subject to change, and a small set of elements of <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Config</code> have been
maintained and documented. See <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/agent#read-configuration">Read
Configuration</a> endpoint documentation for
details.</p><h4 id="deprecated-configtest-command-removed" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="deprecated configtest command removed permalink" href="/consul/docs/upgrading/upgrade-specific#deprecated-configtest-command-removed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Deprecated <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">configtest</code> Command Removed</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">configtest</code> command was deprecated and has been superseded by the
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">validate</code> command.</p><h4 id="undocumented-flags-in-validate-command-removed" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="undocumented flags in validate command removed permalink" href="/consul/docs/upgrading/upgrade-specific#undocumented-flags-in-validate-command-removed"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Undocumented Flags in <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">validate</code> Command Removed</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">validate</code> command supported the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-config-file</code> and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-config-dir</code> command
line flags but did not document them. This support has been removed since the
flags are not required.</p><h4 id="metric-names-updated" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="metric names updated permalink" href="/consul/docs/upgrading/upgrade-specific#metric-names-updated"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Metric Names Updated</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Metric names no longer start with <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.consul</code>. To help with transitioning
dashboards and other metric consumers, the field <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enable_deprecated_names</code> has
been added to the telemetry section of the config, which will enable metrics
with the old naming scheme to be sent alongside the new ones. The following
prefixes were affected:</p><div class="mdx-table_root__adKqa"><div class="mdx-table_tableWrapper__81O9J"><table><thead><tr><th>Prefix</th></tr></thead><tbody><tr><td>consul.consul.acl</td></tr><tr><td>consul.consul.autopilot</td></tr><tr><td>consul.consul.catalog</td></tr><tr><td>consul.consul.fsm</td></tr><tr><td>consul.consul.health</td></tr><tr><td>consul.consul.http</td></tr><tr><td>consul.consul.kvs</td></tr><tr><td>consul.consul.leader</td></tr><tr><td>consul.consul.prepared-query</td></tr><tr><td>consul.consul.rpc</td></tr><tr><td>consul.consul.session</td></tr><tr><td>consul.consul.session_ttl</td></tr><tr><td>consul.consul.txn</td></tr></tbody></table></div><div class="mdx-table_tableFocusRing__qNrYf"></div><div><div class="mdx-table_leftScrim__mYsmq mdx-table_scrim__VtktE"></div><div class="mdx-table_rightScrim__Ikt63 mdx-table_scrim__VtktE"></div></div></div><h4 id="checks-validated-on-agent-startup" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="checks validated on agent startup permalink" href="/consul/docs/upgrading/upgrade-specific#checks-validated-on-agent-startup"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Checks Validated On Agent Startup</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul agents now validate health check definitions in their configuration and
will fail at startup if any checks are invalid. In previous versions of Consul,
invalid health checks would get skipped.</p><h2 id="consul-0-9-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 9 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-9-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.9.0</h2><h4 id="script-checks-are-now-opt-in" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="script checks are now opt in permalink" href="/consul/docs/upgrading/upgrade-specific#script-checks-are-now-opt-in"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Script Checks Are Now Opt-In</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">A new <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_enable_script_checks"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enable_script_checks</code></a>
configuration option was added, and defaults to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code>, meaning that in order
to allow an agent to run health checks that execute scripts, this will need to
be configured and set to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>. This provides a safer out-of-the-box
configuration for Consul where operators must opt-in to allow script-based
health checks.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">If your cluster uses script health checks please be sure to set this to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>
as part of upgrading agents. If this is set to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code>, you should also enable
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/security/access-control-setup-production">ACLs</a>
to provide control over which users are allowed to register health checks that
could potentially execute scripts on the agent machines.</p><div class="alert alert-danger g-type-body"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA"><strong>Security Warning:</strong> Using <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enable_script_checks</code> without ACLs and without
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">allow_write_http_from</code> is <em>DANGEROUS</em>. Use the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">enable_local_script_checks</code> setting
introduced in v0.9.4 instead. See <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://www.hashicorp.com/blog/protecting-consul-from-rce-risk-in-specific-configurations/">this article</a>
for more information.</p></div><h4 id="web-ui-is-no-longer-released-separately" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="web ui is no longer released separately permalink" href="/consul/docs/upgrading/upgrade-specific#web-ui-is-no-longer-released-separately"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Web UI Is No Longer Released Separately</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul releases will no longer include a <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">web_ui.zip</code> file with the compiled
web assets. These have been built in to the Consul binary since the 0.7.x
series and can be enabled with the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_ui"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-ui</code></a>
configuration option. These built-in web assets have always been identical to
the contents of the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">web_ui.zip</code> file for each release. The
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_ui_dir"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-ui-dir</code></a> option is still available for
hosting customized versions of the web assets, but the vast majority of Consul
users can just use the built in web assets.</p><h2 id="consul-0-8-0" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 8 0 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-8-0"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.8.0</h2><h4 id="upgrade-current-cluster-leader-last" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="upgrade current cluster leader last permalink" href="/consul/docs/upgrading/upgrade-specific#upgrade-current-cluster-leader-last"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Upgrade Current Cluster Leader Last</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">We identified a potential issue with Consul 0.8 that requires the current
cluster leader to be upgraded last when updating multiple servers. Please see
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul/issues/2889">this issue</a> for more details.</p><h4 id="command-line-interface-rpc-deprecation" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="command line interface rpc deprecation permalink" href="/consul/docs/upgrading/upgrade-specific#command-line-interface-rpc-deprecation"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Command-Line Interface RPC Deprecation</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The RPC client interface has been removed. All CLI commands that used RPC and
the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-rpc-addr</code> flag to communicate with Consul have been converted to use the
HTTP API and the appropriate flags for it, and the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">rpc</code> field has been removed
from the port and address binding configs. You will need to remove these fields
from your config files and update any scripts that passed a custom <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-rpc-addr</code>
to the following commands:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><a id="force-leave" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="force leave permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#force-leave"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">force-leave</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="info" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="info permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#info"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">info</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="join" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="join permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#join"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">join</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="keyring" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="keyring permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#keyring"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">keyring</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="leave" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="leave permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#leave"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">leave</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="members" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="members permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#members"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">members</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="monitor" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="monitor permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#monitor"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">monitor</code></a></li><li class="mdx-lists_listItem__nkqhg"><a id="reload" aria-hidden="true" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __target-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#"></a><a aria-label="reload permalink" class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ __permalink-lic" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#reload"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">reload</code></a></li></ul><h4 id="version-8-acls-are-now-opt-out" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="version 8 acls are now opt out permalink" href="/consul/docs/upgrading/upgrade-specific#version-8-acls-are-now-opt-out"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Version 8 ACLs Are Now Opt-Out</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#acl_enforce_version_8"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_enforce_version_8</code></a>
configuration now defaults to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">true</code> to enable full version 8 ACL support by
default. If you are upgrading an existing cluster with ACLs enabled, you will
need to set this to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">false</code> during the upgrade on <strong>both Consul agents and
Consul servers</strong>. Version 8 ACLs were also changed so that
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#acl_datacenter"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_datacenter</code></a> must be set on
agents in order to enable the agent-side enforcement of ACLs. This makes for a
smoother experience in clusters where ACLs aren&#x27;t enabled at all, but where the
agents would have to wait to contact a Consul server before learning that.</p><h4 id="remote-exec-is-now-opt-in" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="remote exec is now opt in permalink" href="/consul/docs/upgrading/upgrade-specific#remote-exec-is-now-opt-in"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Remote Exec Is Now Opt-In</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The default for
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#disable_remote_exec"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">disable_remote_exec</code></a> was
changed to &quot;true&quot;, so now operators need to opt-in to having agents support
running commands remotely via <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/commands/exec"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul exec</code></a>.</p><h4 id="raft-protocol-version-compatibility" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="raft protocol version compatibility permalink" href="/consul/docs/upgrading/upgrade-specific#raft-protocol-version-compatibility"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Raft Protocol Version Compatibility</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When upgrading to Consul 0.8.0 from a version lower than 0.7.0, users will need
to set the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/cli-flags#_raft_protocol"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-raft-protocol</code></a> option
to 1 in order to maintain backwards compatibility with the old servers during
the upgrade. After the servers have been migrated to version 0.8.0,
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">-raft-protocol</code> can be moved up to 2 and the servers restarted to match the
default.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The Raft protocol must be stepped up in this way; only adjacent version numbers
are compatible (for example, version 1 cannot talk to version 3). Here is a
table of the Raft Protocol versions supported by each Consul version:</p><div class="mdx-table_root__adKqa"><div class="mdx-table_tableWrapper__81O9J"><table><thead><tr><th>Version</th><th>Supported Raft Protocols</th></tr></thead><tbody><tr><td>0.6 and earlier</td><td>0</td></tr><tr><td>0.7</td><td>1</td></tr><tr><td>0.8</td><td>1, 2, 3</td></tr></tbody></table></div><div class="mdx-table_tableFocusRing__qNrYf"></div><div><div class="mdx-table_leftScrim__mYsmq mdx-table_scrim__VtktE"></div><div class="mdx-table_rightScrim__Ikt63 mdx-table_scrim__VtktE"></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In order to enable all
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/datacenter-operations/autopilot-datacenter-operations">Autopilot</a>
features, all servers in a Consul datacenter must be running with Raft protocol
version 3 or later.</p><h2 id="consul-0-7-1" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 7 1 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-7-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.7.1</h2><h4 id="child-process-reaping" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="child process reaping permalink" href="/consul/docs/upgrading/upgrade-specific#child-process-reaping"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Child Process Reaping</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Child process reaping support has been removed, along with the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">reap</code>
configuration option. Reaping is also done via
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/Yelp/dumb-init">dumb-init</a> in the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/docker-consul">Consul Docker
image</a>, so removing it from Consul
itself simplifies the code and eases future maintenance for Consul. If you are
running Consul as PID 1 in a container you will need to arrange for a wrapper
process to reap child processes.</p><h4 id="dns-resiliency-defaults" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="dns resiliency defaults permalink" href="/consul/docs/upgrading/upgrade-specific#dns-resiliency-defaults"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>DNS Resiliency Defaults</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The default for <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#max_stale"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">max_stale</code></a> has been
increased from 5 seconds to a near-indefinite threshold (10 years) to allow DNS
queries to continue to be served in the event of a long outage with no leader.
A new telemetry counter was added at <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul.dns.stale_queries</code> to track when
agents serve DNS queries that are stale by more than 5 seconds.</p><h2 id="consul-0-7" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 7 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-7"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.7</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.7 is a very large release with many important changes. Changes
to be aware of during an upgrade are categorized below.</p><h4 id="performance-timing-defaults-and-tuning" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="performance timing defaults and tuning permalink" href="/consul/docs/upgrading/upgrade-specific#performance-timing-defaults-and-tuning"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Performance Timing Defaults and Tuning</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 0.7 now defaults the DNS configuration to allow for stale queries by
defaulting <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#allow_stale"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">allow_stale</code></a> to true for
better utilization of available servers. If you want to retain the previous
behavior, set the following configuration:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;dns_config&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">&quot;allow_stale&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul also 0.7 introduced support for tuning Raft performance using a new
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#performance">performance configuration block</a>. Also,
the default Raft timing is set to a lower-performance mode suitable for
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/install/performance#minimum">minimal Consul servers</a>.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To continue to use the high-performance settings that were the default prior to
Consul 0.7 (recommended for production servers), add the following
configuration to all Consul servers when upgrading:</p><div class="g-code-block style_root__i1k0c language-json mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-json mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-json mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token property">&quot;performance&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    <span class="token property">&quot;raft_multiplier&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  <span class="token punctuation">}</span>
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"><span class="token punctuation">}</span>
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">See the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/install/performance">Server Performance</a> guide for more details.</p><h4 id="leave-related-configuration-defaults" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="leave related configuration defaults permalink" href="/consul/docs/upgrading/upgrade-specific#leave-related-configuration-defaults"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Leave-Related Configuration Defaults</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The default behavior of <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#leave_on_terminate"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">leave_on_terminate</code></a>
and <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#skip_leave_on_interrupt"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">skip_leave_on_interrupt</code></a>
are now dependent on whether or not the agent is acting as a server or client:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">For servers, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">leave_on_terminate</code> defaults to &quot;false&quot; and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">skip_leave_on_interrupt</code>
defaults to &quot;true&quot;.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">For clients, <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">leave_on_terminate</code> defaults to &quot;true&quot; and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">skip_leave_on_interrupt</code>
defaults to &quot;false&quot;.</p></li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">These defaults are designed to be safer for servers so that you must explicitly
configure them to leave the cluster. This also results in a better experience for
clients, especially in cloud environments where they may be created and destroyed
often and users prefer not to wait for the 72 hour reap time for cleanup.</p><h4 id="dropped-support-for-protocol-version-1" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="dropped support for protocol version 1 permalink" href="/consul/docs/upgrading/upgrade-specific#dropped-support-for-protocol-version-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Dropped Support for Protocol Version 1</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.7 dropped support for protocol version 1, which means it
is no longer compatible with versions of Consul prior to 0.3. You will need
to upgrade all agents to a newer version of Consul before upgrading to Consul
0.7.</p><h4 id="prepared-query-changes" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="prepared query changes permalink" href="/consul/docs/upgrading/upgrade-specific#prepared-query-changes"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Prepared Query Changes</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.7 adds a feature which allows prepared queries to store a
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/query#near"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Near</code> parameter</a> in the query definition
itself. This feature enables using the distance sorting features of prepared
queries without explicitly providing the node to sort near in requests, but
requires the agent servicing a request to send additional information about
itself to the Consul servers when executing the prepared query. Agents prior
to 0.7 do not send this information, which means they are unable to properly
execute prepared queries configured with a <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Near</code> parameter. Similarly, any
server nodes prior to version 0.7 are unable to store the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Near</code> parameter,
making them unable to properly serve requests for prepared queries using the
feature. It is recommended that all agents be running version 0.7 prior to
using this feature.</p><h4 id="wan-address-translation-in-http-endpoints" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="wan address translation in http endpoints permalink" href="/consul/docs/upgrading/upgrade-specific#wan-address-translation-in-http-endpoints"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>WAN Address Translation in HTTP Endpoints</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.7 added support for translating WAN addresses in certain
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#translate_wan_addrs">HTTP endpoints</a>. The servers
and the agents need to be running version 0.7 or later in order to use this
feature.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">These translated addresses could break HTTP endpoint consumers that are
expecting local addresses, so a new <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/api-docs/api-structure#translated-addresses"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">X-Consul-Translate-Addresses</code></a>
header was added to allow clients to detect if translation is enabled for HTTP
responses. A &quot;lan&quot; tag was added to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">TaggedAddresses</code> for clients that need
the local address regardless of translation.</p><h4 id="outage-recovery-and-peers-json-changes" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="outage recovery and peers json changes permalink" href="/consul/docs/upgrading/upgrade-specific#outage-recovery-and-peers-json-changes"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Outage Recovery and <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">peers.json</code> Changes</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">peers.json</code> file is no longer present by default and is only used when
performing recovery. This file will be deleted after Consul starts and ingests
the file. Consul 0.7 also uses a new, automatically-created raft/peers.info file
to avoid ingesting the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">peers.json</code> file on the first start after upgrading (the
<code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">peers.json</code> file is simply deleted on the first start after upgrading).</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Please be sure to review the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/tutorials/datacenter-operations/recovery-outage">Disaster recovery for Consul clusters tutorial</a>
before upgrading for more details.</p><h2 id="consul-0-6-4" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 6 4 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-6-4"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.6.4</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 0.6.4 made some substantial changes to how ACLs work with prepared
queries. Existing queries will execute with no changes, but there are important
differences to understand about how prepared queries are managed before you
upgrade. In particular, prepared queries with no <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Name</code> defined will no longer
require any ACL to manage them, and prepared queries with a <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">Name</code> defined are
now governed by a new <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">query</code> ACL policy that will need to be configured
after the upgrade.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">See the <a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/security/acl/acl-rules#prepared-query-rules">ACL rules documentation</a> for more details
about the new behavior and how it compares to previous versions of Consul.</p><h2 id="consul-0-6" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 6 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-6"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.6</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.6 is a very large release with many enhancements and
optimizations. Changes to be aware of during an upgrade are categorized below.</p><h4 id="data-store-changes" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="data store changes permalink" href="/consul/docs/upgrading/upgrade-specific#data-store-changes"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Data Store Changes</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul changed the format used to store data on the server nodes in version 0.5
(see 0.5.1 notes below for details). Previously, Consul would automatically
detect data directories using the old LMDB format, and convert them to the newer
BoltDB format. This automatic upgrade has been removed for Consul 0.6, and
instead a safeguard has been put in place which will prevent Consul from booting
if the old directory format is detected.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">It is still possible to migrate from a 0.5.x version of Consul to 0.6+ using the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul-migrate">consul-migrate</a> CLI utility. This
is the same tool that was previously embedded into Consul. See the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="https://github.com/hashicorp/consul-migrate/releases">releases</a> page for
downloadable versions of the tool.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Also, in this release Consul switched from LMDB to a fully in-memory database for
the state store. Because LMDB is a disk-based backing store, it was able to store
more data than could fit in RAM in some cases (though this is not a recommended
configuration for Consul). If you have an extremely large data set that won&#x27;t fit
into RAM, you may encounter issues upgrading to Consul 0.6.0 and later. Consul
should be provisioned with physical memory approximately 2X the data set size to
allow for bursty allocations and subsequent garbage collection.</p><h4 id="acl-enhancements" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="acl enhancements permalink" href="/consul/docs/upgrading/upgrade-specific#acl-enhancements"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>ACL Enhancements</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul 0.6 introduces enhancements to the ACL system which may require special
handling:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">Service ACLs are enforced during service discovery (REST + DNS)</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Previously, service discovery was wide open, and any client could query
information about any service without providing a token. Consul now requires
read-level access at a minimum when ACLs are enabled to return service
information over the REST or DNS interfaces. If clients depend on an open
service discovery system, then the following should be added to all ACL tokens
which require it:</p><div class="g-code-block style_root__i1k0c mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"># Enable discovery of all services<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">service &quot;&quot; {<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    policy = &quot;read&quot;<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">}<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">When the DNS interface is queried, the agent&#x27;s
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/agent/config/config-files#acl_token"><code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_token</code></a> is used, so be sure
that token has sufficient privileges to return the DNS records you
expect to retrieve from it.</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">Event and keyring ACLs</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Similar to service discovery, the new event and keyring ACLs will block access
to these operations if the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_default_policy</code> is set to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">deny</code>. If clients depend
on open access to these, then the following should be added to all ACL tokens which
require them:</p><div class="g-code-block style_root__i1k0c mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">event &quot;&quot; {<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">  policy = &quot;write&quot;<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">}<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">keyring = &quot;write&quot;<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Unfortunately, these are new ACLs for Consul 0.6, so they must be added after the
upgrade is complete.</p><h4 id="prepared-queries" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="prepared queries permalink" href="/consul/docs/upgrading/upgrade-specific#prepared-queries"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Prepared Queries</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Prepared queries introduce a new Raft log entry type that isn&#x27;t supported on older
versions of Consul. It&#x27;s important to not use the prepared query features of Consul
until all servers in a cluster have been upgraded to version 0.6.0.</p><h4 id="single-private-ip-enforcement" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="single private ip enforcement permalink" href="/consul/docs/upgrading/upgrade-specific#single-private-ip-enforcement"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Single Private IP Enforcement</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul will refuse to start if there are multiple private IPs available, so
if this is the case you will need to configure Consul&#x27;s advertise or bind addresses
before upgrading.</p><h4 id="new-web-ui-file-layout" class="hds-typography-display-300 hds-font-weight-semibold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h4__v7716"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow" aria-label="new web ui file layout permalink" href="/consul/docs/upgrading/upgrade-specific#new-web-ui-file-layout"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>New Web UI File Layout</h4><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The release .zip file for Consul&#x27;s web UI no longer contains a <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">dist</code> sub-folder;
everything has been moved up one level. If you have any automated scripts that
expect the old layout you may need to update them.</p><h2 id="consul-0-5-1" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 5 1 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-5-1"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.5.1</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.5.1 uses a different backend store for persisting the Raft
log. Because of this change, a data migration is necessary to move the log
entries out of LMDB and into the newer backend, BoltDB.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.5.1+ makes this transition seamless and easy. As a user, there
are no special steps you need to take. When Consul starts, it checks
for presence of the legacy LMDB data files, and migrates them automatically
if any are found. You will see a log emitted when Raft data is migrated, like
this:</p><div class="g-code-block style_root__i1k0c mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">==&gt; Successfully migrated raft data in 5.839642ms<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This automatic upgrade will only exist in Consul 0.5.1+ and it will
be removed starting with Consul 0.6.0+. It will still be possible to upgrade directly
from pre-0.5.1 versions by using the consul-migrate utility, which is available on the
<a class="inline-link_root__iIql6 g-focus-ring-from-box-shadow hds-typography-body-300 hds-font-weight-regular inline-link_primary__kGJLJ" aria-describedby="" href="/consul/docs/integrate/download-tools">Consul Tools page</a>.</p><h2 id="consul-0-5" class="hds-typography-display-500 hds-font-weight-bold mdx-headings_heading__M6qPe g-offset-scroll-margin-top mdx-headings_h2__9ZcX_"><a class="mdx-heading-permalink_root__2oeix g-focus-ring-from-box-shadow mdx-heading-permalink_h2__CA9g8" aria-label="consul 0 5 permalink" href="/consul/docs/upgrading/upgrade-specific#consul-0-5"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="mdx-heading-permalink_icon__Sz01O"><g fill="currentColor"><path d="M11.141 1a3.893 3.893 0 00-2.738 1.093L7.314 3.175A.75.75 0 008.372 4.24l1.077-1.07a2.393 2.393 0 013.384 3.382l-1.881 1.88a2.393 2.393 0 01-3.608-.258.75.75 0 00-1.202.899 3.893 3.893 0 005.87.42l1.886-1.886.01-.009A3.893 3.893 0 0011.14 1z"></path><path d="M7.019 5.365a3.893 3.893 0 00-3.032 1.13L2.102 8.382l-.01.01a3.893 3.893 0 005.505 5.504l1.084-1.084a.75.75 0 00-1.06-1.06l-1.07 1.07a2.393 2.393 0 01-3.384-3.384l1.881-1.88a2.393 2.393 0 013.609.258.75.75 0 101.2-.899A3.893 3.893 0 007.02 5.365z"></path></g></svg></a>Consul 0.5</h2><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Consul version 0.5 adds two features that complicate the upgrade process:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg">ACL system includes service discovery and registration</li><li class="mdx-lists_listItem__nkqhg">Internal use of tombstones to fix behavior of blocking queries
in certain edge cases.</li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Users of the ACL system need to be aware that deploying Consul 0.5 will
cause service registration to be enforced. This means if an agent
attempts to register a service without proper privileges it will be denied.
If the <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">acl_default_policy</code> is &quot;allow&quot; then clients will continue to
work without an updated policy. If the policy is &quot;deny&quot;, then all clients
will begin to have their registration rejected causing issues.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">To avoid this situation, all the ACL policies should be updated to
add something like this:</p><div class="g-code-block style_root__i1k0c mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"># Enable all services to be registered<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">service &quot;&quot; {<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    policy = &quot;write&quot;<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">}<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">This will set the service policy to <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">write</code> level for all services.
The blank service name is the catch-all value. A more specific service
can also be specified:</p><div class="g-code-block style_root__i1k0c mdx-code-blocks_codeBlockMargin__xk4yr style_codeMargin__flyZr theme-dark_base__RNsat theme-dark_syntax__QCDzs" data-heap-track="code-block"><div class="style_linesContainer__4N_nq"><pre class="code-lines_pre__t8gY5 language-mdx-code-blocks_codeBlockMargin__xk4yr"><code class="code-lines_code__luWmT language-mdx-code-blocks_codeBlockMargin__xk4yr"><span class="code-lines_linesColumn__M9Wn1 code-lines_styledScrollbars__37_Kl"><span class="code-lines_linesScrollableContent__UNs3H"><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ"># Enable only the API service to be registered<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">service &quot;api&quot; {<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">    policy = &quot;write&quot;<!-- -->
</span><span class="code-lines_LineOfCode__6Kf_L g-type-code code-lines_padRight__5afwQ">}<!-- -->
</span></span></span></code></pre><div class="style_copyButtonContainer__yxcuf"><button class="style_button__8j_Rk" data-heap-track="code-block-clipboard-icon" type="button">Copy<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="style_svg__gtvGZ"><g fill="currentColor"><path d="M2.25 0A2.25 2.25 0 000 2.25v7.5A2.25 2.25 0 002.25 12h.25a.75.75 0 000-1.5h-.25a.75.75 0 01-.75-.75v-7.5a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v.25a.75.75 0 001.5 0v-.25A2.25 2.25 0 009.75 0h-7.5z"></path><path fill-rule="evenodd" d="M6.25 4A2.25 2.25 0 004 6.25v7.5A2.25 2.25 0 006.25 16h7.5A2.25 2.25 0 0016 13.75v-7.5A2.25 2.25 0 0013.75 4h-7.5zM5.5 6.25a.75.75 0 01.75-.75h7.5a.75.75 0 01.75.75v7.5a.75.75 0 01-.75.75h-7.5a.75.75 0 01-.75-.75v-7.5z" clip-rule="evenodd"></path></g></svg></button></div></div></div><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The ACL policy can be updated while running 0.4, and enforcement will
being with the upgrade to 0.5. The policy updates will ensure the
availability of the cluster.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">The second major change is the new internal command used for tombstones.
The details of the change are not important, however to function the leader
node will replicate a new command to its followers. Consul is designed
defensively, and when a command that is not recognized is received, the
server will panic. This is a purposeful design decision to avoid the possibility
of data loss, inconsistencies, or security issues caused by future incompatibility.</p><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">In practice, this means if a Consul 0.5 node is the leader, all of its
followers must also be running 0.5. There are a number of ways to do this
to ensure cluster availability:</p><ul class="mdx-lists_listRoot__iVDx9"><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Add new 0.5 nodes, then remove the old servers. This will add the new
nodes as followers, and once the old servers are removed, one of the
0.5 nodes will become leader.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Upgrade the followers first, then the leader last. Using <code class="mdx-inline-code_inlineCode__p_0sy mdx-inline-code_size-200__YiF_7 hds-typography-code-200">consul info</code>,
you can determine which nodes are followers. Do an in-place upgrade
on them first, and finally upgrade the leader last.</p></li><li class="mdx-lists_listItem__nkqhg"><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Upgrade them in any order, but ensure all are done within 15 minutes.
Even if the leader is upgraded to 0.5 first, as long as all of the followers
are running 0.5 within 15 minutes there will be no issues.</p></li></ul><p class="text_root__r0DFB hds-typography-body-300 hds-font-weight-regular mdx-p_p__ZTJEA">Finally, even if any of the methods above are not possible or the process
fails for some reason, it is not fatal. The older version of the server
will simply panic and stop. At that point, you can upgrade to the new version
and restart the agent. There will be no data loss and the cluster will
resume operations.</p></div></div><a href="https://github.com/hashicorp/consul/blob/main/website/../content/docs/upgrading/upgrade-specific.mdx" target="_blank" class="edit-on-github-link_editLink__AsG8Z sidebar-sidecar-layout_editOnGithubLink__SDraB" rel="noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true" class="edit-on-github-link_editLinkIcon__wMtY9"><path fill="currentColor" fill-rule="evenodd" d="M8 1C4.133 1 1 4.13 1 7.993c0 3.09 2.006 5.71 4.787 6.635.35.064.478-.152.478-.337 0-.166-.006-.606-.01-1.19-1.947.423-2.357-.937-2.357-.937-.319-.808-.778-1.023-.778-1.023-.635-.434.048-.425.048-.425.703.05 1.073.72 1.073.72.624 1.07 1.638.76 2.037.582.063-.452.244-.76.444-.935-1.554-.176-3.188-.776-3.188-3.456 0-.763.273-1.388.72-1.876-.072-.177-.312-.888.07-1.85 0 0 .586-.189 1.924.716A6.711 6.711 0 018 4.381c.595.003 1.194.08 1.753.236 1.336-.905 1.923-.717 1.923-.717.382.963.142 1.674.07 1.85.448.49.72 1.114.72 1.877 0 2.686-1.638 3.278-3.197 3.45.251.216.475.643.475 1.296 0 .934-.009 1.688-.009 1.918 0 .187.127.404.482.336A6.996 6.996 0 0015 7.993 6.997 6.997 0 008 1z" clip-rule="evenodd"></path></svg>Edit this page on GitHub</a></main><div class="sidebar-sidecar-layout_sidecarPosition__WtTq0"><div class="sidebar-sidecar-layout_sidecarTopSlot__qRAEI"></div><div class="sidecar-scroll-container_root__a8nIj"><div class="sidecar-scroll-container_scrollContainer__Dw9id"><div><nav aria-labelledby="react-aria-348"><p id="react-aria-348" class="outline-nav_navLabel__HrjQb hds-typography-body-100">On this page:</p><ol class="outline-nav_listRoot__Sm1fr"><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-0" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#upgrading-specific-versions">Upgrading Specific Versions</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-1" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-v1-19-x">Consul v1.19.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-2" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-17-x">Consul 1.17.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-3" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-16-x">Consul 1.16.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-4" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-15-x">Consul 1.15.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-5" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-14-x">Consul 1.14.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-6" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-13-x">Consul 1.13.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-7" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-12-x">Consul 1.12.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-8" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-11-x">Consul 1.11.x</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-9" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-10-0">Consul 1.10.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-10" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-9-0">Consul 1.9.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-11" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-8-0">Consul 1.8.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-12" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-7-0">Consul 1.7.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-13" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-6-3">Consul 1.6.3</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-14" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-6-0">Consul 1.6.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-15" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-4-0">Consul 1.4.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-16" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-3-0">Consul 1.3.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-17" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-1-0">Consul 1.1.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-18" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-0-7">Consul 1.0.7</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-19" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-0-1">Consul 1.0.1</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-20" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-1-0">Consul 1.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-21" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-9-0">Consul 0.9.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-22" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-8-0">Consul 0.8.0</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-23" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-7-1">Consul 0.7.1</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-24" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-7">Consul 0.7</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-25" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-6-4">Consul 0.6.4</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-26" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-6">Consul 0.6</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-27" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-5-1">Consul 0.5.1</a></li><li><a class="outline-link_root__S7fQg hds-typography-body-200 g-focus-ring-from-box-shadow" data-heap-track="toc-list-item-index-28" aria-describedby="" href="/consul/docs/upgrading/upgrade-specific#consul-0-5">Consul 0.5</a></li></ol></nav></div></div></div></div></div></div></div></div></div><div class="base-layout_footer__HGqK8 base-layout_showFooterTopBorder__4_CwH"><footer class="footer_root__qJO_k"><span class="footer_logoAndSwitcher__CJkN3"><a href="https://www.hashicorp.com/" aria-label="Go to HashiCorp home page" class="footer_logo__pe9i3 g-focus-ring-from-box-shadow"><div><svg xmlns="http://www.w3.org/2000/svg" width="254" height="53" fill="none" viewBox="0 0 254 53"><g fill="#000" clip-path="url(#a)"><g><path d="M63.01 12.22h5.32v11.43h12.19V12.22h5.36V40.2h-5.36V28.45H68.33V40.2h-5.32zM89.28 34.77c0-4.2 2.96-5.6 6.56-6.44l6.079-1.4v-.48c0-2.04-1.32-3.32-3.44-3.32s-3.36 1.16-3.76 3.08l-4.56-.52c.68-3.84 3.92-6.32 8.52-6.32 5.08 0 8.4 3.2 8.4 7.88v8.2c0 .52.16.68.52.68h1.12v4.08h-3.12c-1.96 0-2.84-.64-2.84-2.24 0-.48.08-1.04.28-1.76l-.44-.16c-1.44 3.12-3.56 4.48-6.56 4.48-4.12 0-6.76-2.28-6.76-5.76m8.12 2c2.639 0 4.519-1.92 4.519-4.96v-1.6l-4.36 1.04c-2.2.52-3.12 1.28-3.12 2.96s1.16 2.56 2.96 2.56M110.59 34.69l4.88-.96c.52 2.16 2.24 3.24 4.52 3.24 2.28 0 3.56-.92 3.56-2.48s-1.52-1.88-4.4-2.4c-3.64-.56-8.35-1.24-8.35-6.28 0-3.8 3.24-6.44 8.52-6.44 4.68 0 8.32 1.96 9.15 5.92l-4.92.8c-.44-2-2.08-3.04-4.24-3.04-2.36 0-3.48 1-3.48 2.36 0 1.56 1.56 1.88 4.44 2.4 3.6.56 8.32 1.24 8.32 6.28 0 3.96-3.2 6.6-8.6 6.6-4.88 0-8.52-2-9.4-6M136.94 40.21h-5.2V11.42h5.2v8.96c0 1.04-.2 2.04-.48 3.52l.48.16c1.24-2.96 3.12-4.68 6.6-4.68 4.44 0 6.8 2.8 6.8 7.56v13.27h-5.2V27.1c0-2.32-1.16-3.6-3.48-3.6-2.64 0-4.72 2-4.72 5.52zM161.01 35.05c0 .8.28 1.04.88 1.04h2.28v4.12h-4.72c-2.36 0-3.64-1.32-3.64-3.76V23.98h-2.88v-4.12h8.08zm-5.92-20.63c0-1.76 1.44-3.2 3.16-3.2 1.72 0 3.16 1.44 3.16 3.2 0 1.76-1.4 3.16-3.16 3.16-1.76 0-3.16-1.4-3.16-3.16M165.89 26.22c0-8.4 5.52-14.47 13.51-14.47 6.72 0 11.31 3.88 12.55 9.15l-5.28 1.28c-1-3.68-3.44-5.76-7.28-5.76-4.88 0-7.96 4.04-7.96 9.79 0 5.75 3.2 9.79 8.16 9.79 3.92 0 6.32-2.12 7.32-6.04l5 .56c-1.2 6.28-5.84 10.15-12.39 10.15-8.08 0-13.63-6.08-13.63-14.47zM194.08 30.01c0-6.2 4.36-10.63 10.39-10.63s10.39 4.44 10.39 10.63-4.36 10.67-10.39 10.67-10.39-4.48-10.39-10.67m15.59 0c0-3.84-2.04-6.4-5.2-6.4s-5.2 2.56-5.2 6.4c0 3.84 2.08 6.44 5.2 6.44s5.2-2.56 5.2-6.44M218.149 19.86h4.8v.8c0 1.08-.04 1.96-.36 3.6l.48.12c.76-2.68 2.16-4.52 5.44-4.52h1.48v5.04h-2.12c-2.92 0-4.52 1.76-4.52 5v10.31h-5.2zM232.43 19.86h5.12v.92c0 .92-.08 1.64-.36 3.28l.48.12c1.24-3.24 3.56-4.8 6.56-4.8 4.96 0 8.88 4.08 8.88 10.63 0 6.55-3.92 10.67-8.88 10.67-3 0-5.2-1.56-6.48-4.84l-.44.16c.24 1.6.32 2.36.32 3.24v9.15h-5.2V19.85zm15.51 10.15c0-3.96-2.16-6.4-5.2-6.4s-5.2 2.44-5.2 6.4c0 3.96 2.16 6.44 5.2 6.44s5.2-2.44 5.2-6.44"/></g><g><path d="M20.79.01.07 11.97v28.71l7.78 4.5V16.46l12.94-7.47z"/><path d="M29.06.01v22.87h-8.27v-8.54L13 18.84v29.3l7.79 4.5v-22.8h8.27v8.48l7.79-4.49V4.51z"/><path d="M29.06 52.65 49.78 40.7V11.99L42 7.49V36.2l-12.94 7.47z"/></g></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h254v53H0z"/></clipPath></defs></svg></div></a><span class="footer_themeSwitcher__CPJxw hds-font-weight-regular"><label class="theme-switcher_label__7Boh2 hds-typography-body-200" for="react-aria-378">Theme</label></span></span><ul class="footer_links__t81SU"><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="" href="/certifications"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Certifications</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="" href="https://status.hashicorp.com"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">System Status</span></a></li><li><button class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Cookie Manager</span></button></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="" href="https://www.hashicorp.com/terms-of-service"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Terms of Use</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="" href="https://www.hashicorp.com/security"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Security</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="" href="https://www.hashicorp.com/privacy"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Privacy</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="" href="https://www.hashicorp.com/trademark-policy"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Trademark Policy</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="" href="https://www.hashicorp.com/trade-controls"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Trade Controls</span></a></li><li><a class="footer_linkAction__bR3OW g-focus-ring-from-box-shadow" aria-describedby="opens-in-new-tab-label-react-aria-386" target="_blank" href="https://forms.gle/fnHLuNahLEhjuKvE6"><span class="text_root__r0DFB hds-typography-body-200 hds-font-weight-regular">Give Feedback</span><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 16 16" aria-hidden="true"><g fill="currentColor"><path d="M9 .75A.75.75 0 019.75 0h4.5c.206 0 .393.083.529.218l.001.002.002.001A.748.748 0 0115 .75v4.5a.75.75 0 01-1.5 0V2.56L7.28 8.78a.75.75 0 01-1.06-1.06l6.22-6.22H9.75A.75.75 0 019 .75z"></path><path d="M3.25 3.5a.75.75 0 00-.75.75v7.5c0 .414.336.75.75.75h7.5a.75.75 0 00.75-.75v-4a.75.75 0 011.5 0v4A2.25 2.25 0 0110.75 14h-7.5A2.25 2.25 0 011 11.75v-7.5A2.25 2.25 0 013.25 2h4a.75.75 0 010 1.5h-4z"></path></g></svg></a><span class="g-screen-reader-only" id="opens-in-new-tab-label-react-aria-386">(opens in new tab)</span></li></ul></footer></div></div></div><div class="style_root__owpNH"></div><div style="position:fixed;z-index:99;top:16px;left:16px;right:16px;bottom:16px;pointer-events:none;inset:24px"></div><!--$--><!--/$--></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"layoutProps":{"breadcrumbLinks":[{"title":"Developer","url":"/"},{"title":"Consul","url":"/consul"},{"title":"Documentation","url":"/consul/docs","isCurrentPage":false},{"title":"Upgrade","url":"/consul/docs/upgrading"},{"title":"Specific Version Details","url":"/consul/docs/upgrading/upgrade-specific","isCurrentPage":true}],"sidebarNavDataLevels":[{"levelButtonProps":{"levelDownButtonText":"Consul Home"},"menuItems":[{"leadingIconName":"home","title":"HashiCorp Developer","href":"/"},{"leadingIconName":"guide","title":"Tutorials","href":"/tutorials"},{"divider":true},{"heading":"Products"},{"leadingIconName":"hcp","title":"HashiCorp Cloud Platform","href":"/hcp"},{"leadingIconName":"terraform","title":"Terraform","href":"/terraform"},{"leadingIconName":"packer","title":"Packer","href":"/packer"},{"leadingIconName":"consul","title":"Consul","href":"/consul"},{"leadingIconName":"vault","title":"Vault","href":"/vault"},{"leadingIconName":"boundary","title":"Boundary","href":"/boundary"},{"leadingIconName":"nomad","title":"Nomad","href":"/nomad"},{"leadingIconName":"waypoint","title":"Waypoint","href":"/waypoint"},{"leadingIconName":"vagrant","title":"Vagrant","href":"/vagrant"}],"showFilterInput":false,"title":"Main Menu"},{"levelButtonProps":{"levelUpButtonText":"Main Menu","levelDownButtonText":"Previous"},"menuItems":[{"title":"Consul","fullPath":"/consul","theme":"consul"},{"title":"Install","fullPath":"/consul/install"},{"title":"Tutorials","fullPath":"/consul/tutorials"},{"title":"Documentation","fullPath":"/consul/docs"},{"title":"API","fullPath":"/consul/api-docs"},{"title":"CLI","fullPath":"/consul/commands"}],"showFilterInput":false,"title":"Consul","visuallyHideTitle":true},{"backToLinkProps":{"text":"Consul Home","href":"/consul"},"levelButtonProps":{"levelUpButtonText":"Consul Home"},"menuItems":[{"title":"Documentation","fullPath":"/consul/docs","theme":"consul"},{"title":"What is Consul?","path":"intro","filePath":"../content/docs/intro/index.mdx","fullPath":"/consul/docs/intro","id":"sidebar-nav-item-0"},{"title":"Why Choose Consul?","routes":[{"title":"Overview","path":"consul-vs-other","filePath":"../content/docs/consul-vs-other/index.mdx","fullPath":"/consul/docs/consul-vs-other","id":"sidebar-nav-item-2"},{"title":"Service Meshes","path":"consul-vs-other/service-mesh-compare","filePath":"../content/docs/consul-vs-other/service-mesh-compare.mdx","fullPath":"/consul/docs/consul-vs-other/service-mesh-compare","id":"sidebar-nav-item-3"},{"title":"DNS Tools","path":"consul-vs-other/dns-tools-compare","filePath":"../content/docs/consul-vs-other/dns-tools-compare.mdx","fullPath":"/consul/docs/consul-vs-other/dns-tools-compare","id":"sidebar-nav-item-4"},{"title":"Configuration Management Tools","path":"consul-vs-other/config-management-compare","filePath":"../content/docs/consul-vs-other/config-management-compare.mdx","fullPath":"/consul/docs/consul-vs-other/config-management-compare","id":"sidebar-nav-item-5"},{"title":"API Gateways","path":"consul-vs-other/api-gateway-compare","filePath":"../content/docs/consul-vs-other/api-gateway-compare.mdx","fullPath":"/consul/docs/consul-vs-other/api-gateway-compare","id":"sidebar-nav-item-6"}],"id":"sidebar-nav-item-1"},{"title":"Core Concepts","routes":[{"title":"Service Discovery","path":"concepts/service-discovery","filePath":"../content/docs/concepts/service-discovery.mdx","fullPath":"/consul/docs/concepts/service-discovery","id":"sidebar-nav-item-8"},{"title":"Service Mesh","path":"concepts/service-mesh","filePath":"../content/docs/concepts/service-mesh.mdx","fullPath":"/consul/docs/concepts/service-mesh","id":"sidebar-nav-item-9"}],"id":"sidebar-nav-item-7"},{"title":"Get Started","routes":[{"title":"Install Consul","path":"install","filePath":"../content/docs/install/index.mdx","fullPath":"/consul/docs/install","id":"sidebar-nav-item-11"},{"title":"Learn HCP Consul","href":"https://developer.hashicorp.com/consul/tutorials/get-started-hcp","id":"sidebar-nav-item-12"},{"title":"Learn Consul on Kubernetes","href":"https://developer.hashicorp.com/consul/tutorials/get-started-kubernetes","id":"sidebar-nav-item-13"},{"title":"Learn Consul on VMs","href":"https://developer.hashicorp.com/consul/tutorials/get-started-vms","id":"sidebar-nav-item-14"},{"title":"Consul Agent","href":null,"fullPath":"/consul/docs/agent","id":"sidebar-nav-item-15","path":"/docs/agent"},{"title":"Glossary","path":"install/glossary","filePath":"../content/docs/install/glossary.mdx","fullPath":"/consul/docs/install/glossary","id":"sidebar-nav-item-16"},{"title":"Required Ports","path":"install/ports","filePath":"../content/docs/install/ports.mdx","fullPath":"/consul/docs/install/ports","id":"sidebar-nav-item-17"},{"title":"Bootstrapping a Datacenter","path":"install/bootstrapping","filePath":"../content/docs/install/bootstrapping.mdx","fullPath":"/consul/docs/install/bootstrapping","id":"sidebar-nav-item-18"},{"title":"Cloud Auto-join","path":"install/cloud-auto-join","filePath":"../content/docs/install/cloud-auto-join.mdx","fullPath":"/consul/docs/install/cloud-auto-join","id":"sidebar-nav-item-19"},{"title":"Server Performance","path":"install/performance","filePath":"../content/docs/install/performance.mdx","fullPath":"/consul/docs/install/performance","id":"sidebar-nav-item-20"},{"title":"Kubernetes","href":null,"fullPath":"/consul/docs/k8s","id":"sidebar-nav-item-21","path":"/docs/k8s"}],"id":"sidebar-nav-item-10"},{"title":"Architecture","routes":[{"title":"Overview","path":"architecture","filePath":"../content/docs/architecture/index.mdx","fullPath":"/consul/docs/architecture","id":"sidebar-nav-item-23"},{"title":"v1 Catalog","path":"architecture/catalog","filePath":"../content/docs/architecture/catalog.mdx","fullPath":"/consul/docs/architecture/catalog","id":"sidebar-nav-item-24"},{"title":"v2 architecture","routes":[{"title":"Overview","path":"architecture/v2","filePath":"../content/docs/architecture/v2/index.mdx","fullPath":"/consul/docs/architecture/v2","id":"sidebar-nav-item-26"},{"title":"Catalog","path":"architecture/v2/catalog","filePath":"../content/docs/architecture/v2/catalog.mdx","fullPath":"/consul/docs/architecture/v2/catalog","id":"sidebar-nav-item-27"},{"title":"Resource groups","path":"architecture/v2/groups","filePath":"../content/docs/architecture/v2/groups.mdx","fullPath":"/consul/docs/architecture/v2/groups","id":"sidebar-nav-item-28"}],"id":"sidebar-nav-item-25"},{"title":"Improving Consul Resilience","path":"architecture/improving-consul-resilience","filePath":"../content/docs/architecture/improving-consul-resilience.mdx","fullPath":"/consul/docs/architecture/improving-consul-resilience","id":"sidebar-nav-item-29"},{"title":"Anti-Entropy","path":"architecture/anti-entropy","filePath":"../content/docs/architecture/anti-entropy.mdx","fullPath":"/consul/docs/architecture/anti-entropy","id":"sidebar-nav-item-30"},{"title":"Consensus Protocol","path":"architecture/consensus","filePath":"../content/docs/architecture/consensus.mdx","fullPath":"/consul/docs/architecture/consensus","id":"sidebar-nav-item-31"},{"title":"Gossip Protocol","path":"architecture/gossip","filePath":"../content/docs/architecture/gossip.mdx","fullPath":"/consul/docs/architecture/gossip","id":"sidebar-nav-item-32"},{"title":"Jepsen Testing","path":"architecture/jepsen","filePath":"../content/docs/architecture/jepsen.mdx","fullPath":"/consul/docs/architecture/jepsen","id":"sidebar-nav-item-33"},{"title":"Network Coordinates","path":"architecture/coordinates","filePath":"../content/docs/architecture/coordinates.mdx","fullPath":"/consul/docs/architecture/coordinates","id":"sidebar-nav-item-34"},{"title":"Consul at Scale","path":"architecture/scale","filePath":"../content/docs/architecture/scale.mdx","fullPath":"/consul/docs/architecture/scale","id":"sidebar-nav-item-35"}],"id":"sidebar-nav-item-22"},{"divider":true,"id":"sidebar-nav-item-36"},{"title":"Release Notes","routes":[{"title":"Overview","path":"release-notes","filePath":"../content/docs/release-notes/index.mdx","fullPath":"/consul/docs/release-notes","id":"sidebar-nav-item-38"},{"title":"Consul","routes":[{"title":"v1.19.x","path":"release-notes/consul/v1_19_x","filePath":"../content/docs/release-notes/consul/v1_19_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_19_x","id":"sidebar-nav-item-40"},{"title":"v1.18.x","path":"release-notes/consul/v1_18_x","filePath":"../content/docs/release-notes/consul/v1_18_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_18_x","id":"sidebar-nav-item-41"},{"title":"v1.17.x","path":"release-notes/consul/v1_17_x","filePath":"../content/docs/release-notes/consul/v1_17_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_17_x","id":"sidebar-nav-item-42"},{"title":"v1.16.x","path":"release-notes/consul/v1_16_x","filePath":"../content/docs/release-notes/consul/v1_16_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_16_x","id":"sidebar-nav-item-43"},{"title":"v1.15.x","path":"release-notes/consul/v1_15_x","filePath":"../content/docs/release-notes/consul/v1_15_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_15_x","id":"sidebar-nav-item-44"},{"title":"v1.14.x","path":"release-notes/consul/v1_14_x","filePath":"../content/docs/release-notes/consul/v1_14_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_14_x","id":"sidebar-nav-item-45"},{"title":"v1.13.x","path":"release-notes/consul/v1_13_x","filePath":"../content/docs/release-notes/consul/v1_13_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_13_x","id":"sidebar-nav-item-46"},{"title":"v1.12.x","path":"release-notes/consul/v1_12_x","filePath":"../content/docs/release-notes/consul/v1_12_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_12_x","id":"sidebar-nav-item-47"},{"title":"v1.11.x","path":"release-notes/consul/v1_11_x","filePath":"../content/docs/release-notes/consul/v1_11_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_11_x","id":"sidebar-nav-item-48"},{"title":"v1.10.x","path":"release-notes/consul/v1_10_x","filePath":"../content/docs/release-notes/consul/v1_10_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_10_x","id":"sidebar-nav-item-49"},{"title":"v1.9.x","path":"release-notes/consul/v1_9_x","filePath":"../content/docs/release-notes/consul/v1_9_x.mdx","fullPath":"/consul/docs/release-notes/consul/v1_9_x","id":"sidebar-nav-item-50"}],"id":"sidebar-nav-item-39"},{"title":"Consul K8s","routes":[{"title":"v1.4.x","path":"release-notes/consul-k8s/v1_4_x","filePath":"../content/docs/release-notes/consul-k8s/v1_4_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v1_4_x","id":"sidebar-nav-item-52"},{"title":"v1.3.x","path":"release-notes/consul-k8s/v1_3_x","filePath":"../content/docs/release-notes/consul-k8s/v1_3_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v1_3_x","id":"sidebar-nav-item-53"},{"title":"v1.2.x","path":"release-notes/consul-k8s/v1_2_x","filePath":"../content/docs/release-notes/consul-k8s/v1_2_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v1_2_x","id":"sidebar-nav-item-54"},{"title":"v1.1.x","path":"release-notes/consul-k8s/v1_1_x","filePath":"../content/docs/release-notes/consul-k8s/v1_1_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v1_1_x","id":"sidebar-nav-item-55"},{"title":"v1.0.x","path":"release-notes/consul-k8s/v1_0_x","filePath":"../content/docs/release-notes/consul-k8s/v1_0_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v1_0_x","id":"sidebar-nav-item-56"},{"title":"v0.49.x","path":"release-notes/consul-k8s/v0_49_x","filePath":"../content/docs/release-notes/consul-k8s/v0_49_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v0_49_x","id":"sidebar-nav-item-57"},{"title":"v0.48.x","path":"release-notes/consul-k8s/v0_48_x","filePath":"../content/docs/release-notes/consul-k8s/v0_48_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v0_48_x","id":"sidebar-nav-item-58"},{"title":"v0.47.x","path":"release-notes/consul-k8s/v0_47_x","filePath":"../content/docs/release-notes/consul-k8s/v0_47_x.mdx","fullPath":"/consul/docs/release-notes/consul-k8s/v0_47_x","id":"sidebar-nav-item-59"}],"id":"sidebar-nav-item-51"},{"title":"API Gateway for Kubernetes","routes":[{"title":"v0.5.x","path":"release-notes/consul-api-gateway/v0_5_x","filePath":"../content/docs/release-notes/consul-api-gateway/v0_5_x.mdx","fullPath":"/consul/docs/release-notes/consul-api-gateway/v0_5_x","id":"sidebar-nav-item-61"},{"title":"v0.4.x","path":"release-notes/consul-api-gateway/v0_4_x","filePath":"../content/docs/release-notes/consul-api-gateway/v0_4_x.mdx","fullPath":"/consul/docs/release-notes/consul-api-gateway/v0_4_x","id":"sidebar-nav-item-62"},{"title":"v0.3.x","path":"release-notes/consul-api-gateway/v0_3_x","filePath":"../content/docs/release-notes/consul-api-gateway/v0_3_x.mdx","fullPath":"/consul/docs/release-notes/consul-api-gateway/v0_3_x","id":"sidebar-nav-item-63"},{"title":"v0.2.x","path":"release-notes/consul-api-gateway/v0_2_x","filePath":"../content/docs/release-notes/consul-api-gateway/v0_2_x.mdx","fullPath":"/consul/docs/release-notes/consul-api-gateway/v0_2_x","id":"sidebar-nav-item-64"},{"title":"v0.1.x","path":"release-notes/consul-api-gateway/v0_1_x","filePath":"../content/docs/release-notes/consul-api-gateway/v0_1_x.mdx","fullPath":"/consul/docs/release-notes/consul-api-gateway/v0_1_x","id":"sidebar-nav-item-65"}],"id":"sidebar-nav-item-60"},{"title":"Consul ECS","routes":[{"title":"v0.7.x","path":"release-notes/consul-ecs/v0_7_x","filePath":"../content/docs/release-notes/consul-ecs/v0_7_x.mdx","fullPath":"/consul/docs/release-notes/consul-ecs/v0_7_x","id":"sidebar-nav-item-67"},{"title":"v0.5.x","path":"release-notes/consul-ecs/v0_5_x","filePath":"../content/docs/release-notes/consul-ecs/v0_5_x.mdx","fullPath":"/consul/docs/release-notes/consul-ecs/v0_5_x","id":"sidebar-nav-item-68"},{"title":"v0.4.x","path":"release-notes/consul-ecs/v0_4_x","filePath":"../content/docs/release-notes/consul-ecs/v0_4_x.mdx","fullPath":"/consul/docs/release-notes/consul-ecs/v0_4_x","id":"sidebar-nav-item-69"},{"title":"v0.3.x","path":"release-notes/consul-ecs/v0_3_x","filePath":"../content/docs/release-notes/consul-ecs/v0_3_x.mdx","fullPath":"/consul/docs/release-notes/consul-ecs/v0_3_x","id":"sidebar-nav-item-70"},{"title":"v0.2.x","path":"release-notes/consul-ecs/v0_2_x","filePath":"../content/docs/release-notes/consul-ecs/v0_2_x.mdx","fullPath":"/consul/docs/release-notes/consul-ecs/v0_2_x","id":"sidebar-nav-item-71"}],"id":"sidebar-nav-item-66"},{"title":"Consul Terraform Sync","routes":[{"title":"v0.6.x","path":"release-notes/consul-terraform-sync/v0_6_x","filePath":"../content/docs/release-notes/consul-terraform-sync/v0_6_x.mdx","fullPath":"/consul/docs/release-notes/consul-terraform-sync/v0_6_x","id":"sidebar-nav-item-73"},{"title":"v0.5.x","path":"release-notes/consul-terraform-sync/v0_5_x","filePath":"../content/docs/release-notes/consul-terraform-sync/v0_5_x.mdx","fullPath":"/consul/docs/release-notes/consul-terraform-sync/v0_5_x","id":"sidebar-nav-item-74"}],"id":"sidebar-nav-item-72"}],"id":"sidebar-nav-item-37"},{"title":"Upgrade","routes":[{"title":"Overview","path":"upgrading","filePath":"../content/docs/upgrading/index.mdx","fullPath":"/consul/docs/upgrading","id":"sidebar-nav-item-76"},{"title":"Compatibility Promise","path":"upgrading/compatibility","filePath":"../content/docs/upgrading/compatibility.mdx","fullPath":"/consul/docs/upgrading/compatibility","id":"sidebar-nav-item-77"},{"title":"Specific Version Details","path":"upgrading/upgrade-specific","filePath":"../content/docs/upgrading/upgrade-specific.mdx","fullPath":"/consul/docs/upgrading/upgrade-specific","id":"sidebar-nav-item-78"},{"title":"Upgrade Instructions","routes":[{"title":"Overview","path":"upgrading/instructions","filePath":"../content/docs/upgrading/instructions/index.mdx","fullPath":"/consul/docs/upgrading/instructions","id":"sidebar-nav-item-80"},{"title":"General Process","path":"upgrading/instructions/general-process","filePath":"../content/docs/upgrading/instructions/general-process.mdx","fullPath":"/consul/docs/upgrading/instructions/general-process","id":"sidebar-nav-item-81"},{"title":"Upgrading to Latest 1.2.x","path":"upgrading/instructions/upgrade-to-1-2-x","filePath":"../content/docs/upgrading/instructions/upgrade-to-1-2-x.mdx","fullPath":"/consul/docs/upgrading/instructions/upgrade-to-1-2-x","id":"sidebar-nav-item-82"},{"title":"Upgrading to Latest 1.6.x","path":"upgrading/instructions/upgrade-to-1-6-x","filePath":"../content/docs/upgrading/instructions/upgrade-to-1-6-x.mdx","fullPath":"/consul/docs/upgrading/instructions/upgrade-to-1-6-x","id":"sidebar-nav-item-83"},{"title":"Upgrading to Latest 1.8.x","path":"upgrading/instructions/upgrade-to-1-8-x","filePath":"../content/docs/upgrading/instructions/upgrade-to-1-8-x.mdx","fullPath":"/consul/docs/upgrading/instructions/upgrade-to-1-8-x","id":"sidebar-nav-item-84"},{"title":"Upgrading to Latest 1.10.x","path":"upgrading/instructions/upgrade-to-1-10-x","filePath":"../content/docs/upgrading/instructions/upgrade-to-1-10-x.mdx","fullPath":"/consul/docs/upgrading/instructions/upgrade-to-1-10-x","id":"sidebar-nav-item-85"}],"id":"sidebar-nav-item-79"}],"id":"sidebar-nav-item-75"},{"divider":true,"id":"sidebar-nav-item-86"},{"title":"Services","routes":[{"title":"Overview","path":"services/services","filePath":"../content/docs/services/services.mdx","fullPath":"/consul/docs/services/services","id":"sidebar-nav-item-88"},{"title":"Usage","routes":[{"title":"Define services","path":"services/usage/define-services","filePath":"../content/docs/services/usage/define-services.mdx","fullPath":"/consul/docs/services/usage/define-services","id":"sidebar-nav-item-90"},{"title":"Define health checks","path":"services/usage/checks","filePath":"../content/docs/services/usage/checks.mdx","fullPath":"/consul/docs/services/usage/checks","id":"sidebar-nav-item-91"},{"title":"Register services and health checks","path":"services/usage/register-services-checks","filePath":"../content/docs/services/usage/register-services-checks.mdx","fullPath":"/consul/docs/services/usage/register-services-checks","id":"sidebar-nav-item-92"}],"id":"sidebar-nav-item-89"},{"title":"Discover services with DNS","routes":[{"title":"Overview","path":"services/discovery/dns-overview","filePath":"../content/docs/services/discovery/dns-overview.mdx","fullPath":"/consul/docs/services/discovery/dns-overview","id":"sidebar-nav-item-94"},{"title":"Configure DNS behavior","path":"services/discovery/dns-configuration","filePath":"../content/docs/services/discovery/dns-configuration.mdx","fullPath":"/consul/docs/services/discovery/dns-configuration","id":"sidebar-nav-item-95"},{"title":"Perform static DNS lookups","path":"services/discovery/dns-static-lookups","filePath":"../content/docs/services/discovery/dns-static-lookups.mdx","fullPath":"/consul/docs/services/discovery/dns-static-lookups","id":"sidebar-nav-item-96"},{"title":"Cache DNS lookups","path":"services/discovery/dns-cache","filePath":"../content/docs/services/discovery/dns-cache.mdx","fullPath":"/consul/docs/services/discovery/dns-cache","id":"sidebar-nav-item-97"},{"title":"Enable dynamic DNS lookups","path":"services/discovery/dns-dynamic-lookups","filePath":"../content/docs/services/discovery/dns-dynamic-lookups.mdx","fullPath":"/consul/docs/services/discovery/dns-dynamic-lookups","id":"sidebar-nav-item-98"}],"id":"sidebar-nav-item-93"},{"title":"Configuration","routes":[{"title":"Overview","path":"services/configuration/services-configuration-overview","filePath":"../content/docs/services/configuration/services-configuration-overview.mdx","fullPath":"/consul/docs/services/configuration/services-configuration-overview","id":"sidebar-nav-item-100"},{"title":"Services","path":"services/configuration/services-configuration-reference","filePath":"../content/docs/services/configuration/services-configuration-reference.mdx","fullPath":"/consul/docs/services/configuration/services-configuration-reference","id":"sidebar-nav-item-101"},{"title":"Health checks","path":"services/configuration/checks-configuration-reference","filePath":"../content/docs/services/configuration/checks-configuration-reference.mdx","fullPath":"/consul/docs/services/configuration/checks-configuration-reference","id":"sidebar-nav-item-102"},{"title":"Service defaults","href":null,"fullPath":"/consul/docs/connect/config-entries/service-defaults","id":"sidebar-nav-item-103","path":"connect/config-entries/service-defaults"}],"id":"sidebar-nav-item-99"}],"id":"sidebar-nav-item-87"},{"title":"Service Mesh","routes":[{"title":"Overview","path":"connect","filePath":"../content/docs/connect/index.mdx","fullPath":"/consul/docs/connect","id":"sidebar-nav-item-105"},{"title":"How Service Mesh Works","path":"connect/connect-internals","filePath":"../content/docs/connect/connect-internals.mdx","fullPath":"/consul/docs/connect/connect-internals","id":"sidebar-nav-item-106"},{"title":"Configuration","path":"connect/configuration","filePath":"../content/docs/connect/configuration.mdx","fullPath":"/consul/docs/connect/configuration","id":"sidebar-nav-item-107"},{"title":"Configuration entries","routes":[{"title":"Overview","path":"connect/config-entries","filePath":"../content/docs/connect/config-entries/index.mdx","fullPath":"/consul/docs/connect/config-entries","id":"sidebar-nav-item-109"},{"title":"API gateway","path":"connect/config-entries/api-gateway","filePath":"../content/docs/connect/config-entries/api-gateway.mdx","fullPath":"/consul/docs/connect/config-entries/api-gateway","id":"sidebar-nav-item-110"},{"title":"HTTP route","path":"connect/config-entries/http-route","filePath":"../content/docs/connect/config-entries/http-route.mdx","fullPath":"/consul/docs/connect/config-entries/http-route","id":"sidebar-nav-item-111"},{"title":"TCP route","path":"connect/config-entries/tcp-route","filePath":"../content/docs/connect/config-entries/tcp-route.mdx","fullPath":"/consul/docs/connect/config-entries/tcp-route","id":"sidebar-nav-item-112"},{"title":"File system certificate","path":"connect/config-entries/file-system-certificate","filePath":"../content/docs/connect/config-entries/file-system-certificate.mdx","fullPath":"/consul/docs/connect/config-entries/file-system-certificate","id":"sidebar-nav-item-113"},{"title":"Inline certificate","path":"connect/config-entries/inline-certificate","filePath":"../content/docs/connect/config-entries/inline-certificate.mdx","fullPath":"/consul/docs/connect/config-entries/inline-certificate","id":"sidebar-nav-item-114"},{"title":"Ingress gateway","path":"connect/config-entries/ingress-gateway","filePath":"../content/docs/connect/config-entries/ingress-gateway.mdx","fullPath":"/consul/docs/connect/config-entries/ingress-gateway","id":"sidebar-nav-item-115"},{"title":"JWT Provider","path":"connect/config-entries/jwt-provider","filePath":"../content/docs/connect/config-entries/jwt-provider.mdx","fullPath":"/consul/docs/connect/config-entries/jwt-provider","id":"sidebar-nav-item-116"},{"title":"Mesh","path":"connect/config-entries/mesh","filePath":"../content/docs/connect/config-entries/mesh.mdx","fullPath":"/consul/docs/connect/config-entries/mesh","id":"sidebar-nav-item-117"},{"title":"Exported services","path":"connect/config-entries/exported-services","filePath":"../content/docs/connect/config-entries/exported-services.mdx","fullPath":"/consul/docs/connect/config-entries/exported-services","id":"sidebar-nav-item-118"},{"title":"Proxy defaults","path":"connect/config-entries/proxy-defaults","filePath":"../content/docs/connect/config-entries/proxy-defaults.mdx","fullPath":"/consul/docs/connect/config-entries/proxy-defaults","id":"sidebar-nav-item-119"},{"title":"Sameness Group","path":"connect/config-entries/sameness-group","filePath":"../content/docs/connect/config-entries/sameness-group.mdx","fullPath":"/consul/docs/connect/config-entries/sameness-group","id":"sidebar-nav-item-120"},{"title":"Service Defaults","path":"connect/config-entries/service-defaults","filePath":"../content/docs/connect/config-entries/service-defaults.mdx","fullPath":"/consul/docs/connect/config-entries/service-defaults","id":"sidebar-nav-item-121"},{"title":"Service intentions","path":"connect/config-entries/service-intentions","filePath":"../content/docs/connect/config-entries/service-intentions.mdx","fullPath":"/consul/docs/connect/config-entries/service-intentions","id":"sidebar-nav-item-122"},{"title":"Service resolver","path":"connect/config-entries/service-resolver","filePath":"../content/docs/connect/config-entries/service-resolver.mdx","fullPath":"/consul/docs/connect/config-entries/service-resolver","id":"sidebar-nav-item-123"},{"title":"Service router","path":"connect/config-entries/service-router","filePath":"../content/docs/connect/config-entries/service-router.mdx","fullPath":"/consul/docs/connect/config-entries/service-router","id":"sidebar-nav-item-124"},{"title":"Service splitter","path":"connect/config-entries/service-splitter","filePath":"../content/docs/connect/config-entries/service-splitter.mdx","fullPath":"/consul/docs/connect/config-entries/service-splitter","id":"sidebar-nav-item-125"},{"title":"Terminating gateway","path":"connect/config-entries/terminating-gateway","filePath":"../content/docs/connect/config-entries/terminating-gateway.mdx","fullPath":"/consul/docs/connect/config-entries/terminating-gateway","id":"sidebar-nav-item-126"},{"title":"Control plane request limit","path":"connect/config-entries/control-plane-request-limit","filePath":"../content/docs/connect/config-entries/control-plane-request-limit.mdx","fullPath":"/consul/docs/connect/config-entries/control-plane-request-limit","id":"sidebar-nav-item-127"}],"id":"sidebar-nav-item-108"},{"title":"Proxies","routes":[{"title":"Overview","path":"connect/proxies","filePath":"../content/docs/connect/proxies/index.mdx","fullPath":"/consul/docs/connect/proxies","id":"sidebar-nav-item-129"},{"title":"Deploy service mesh proxies","path":"connect/proxies/deploy-service-mesh-proxies","filePath":"../content/docs/connect/proxies/deploy-service-mesh-proxies.mdx","fullPath":"/consul/docs/connect/proxies/deploy-service-mesh-proxies","id":"sidebar-nav-item-130"},{"title":"Deploy sidecar services","path":"connect/proxies/deploy-sidecar-services","filePath":"../content/docs/connect/proxies/deploy-sidecar-services.mdx","fullPath":"/consul/docs/connect/proxies/deploy-sidecar-services","id":"sidebar-nav-item-131"},{"title":"Envoy Extensions","routes":[{"title":"Overview","path":"connect/proxies/envoy-extensions","filePath":"../content/docs/connect/proxies/envoy-extensions/index.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions","id":"sidebar-nav-item-133"},{"title":"Usage","routes":[{"title":"Delegate authorization to Apigee","path":"connect/proxies/envoy-extensions/usage/apigee-ext-authz","filePath":"../content/docs/connect/proxies/envoy-extensions/usage/apigee-ext-authz.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/usage/apigee-ext-authz","id":"sidebar-nav-item-135"},{"title":"Delegate authorization to external services","path":"connect/proxies/envoy-extensions/usage/ext-authz","filePath":"../content/docs/connect/proxies/envoy-extensions/usage/ext-authz.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/usage/ext-authz","id":"sidebar-nav-item-136"},{"title":"Run Lua scripts in Envoy proxies","path":"connect/proxies/envoy-extensions/usage/lua","filePath":"../content/docs/connect/proxies/envoy-extensions/usage/lua.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/usage/lua","id":"sidebar-nav-item-137"},{"title":"Invoke Lambda functions in Envoy proxies","path":"connect/proxies/envoy-extensions/usage/lambda","filePath":"../content/docs/connect/proxies/envoy-extensions/usage/lambda.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/usage/lambda","id":"sidebar-nav-item-138"},{"title":"Send access logs to OpenTelemetry collector service","path":"connect/proxies/envoy-extensions/usage/otel-access-logging","filePath":"../content/docs/connect/proxies/envoy-extensions/usage/otel-access-logging.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/usage/otel-access-logging","id":"sidebar-nav-item-139"},{"title":"Configure Envoy proxy properties","path":"connect/proxies/envoy-extensions/usage/property-override","filePath":"../content/docs/connect/proxies/envoy-extensions/usage/property-override.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/usage/property-override","id":"sidebar-nav-item-140"},{"title":"Run WebAssembly plug-ins in Envoy proxies","path":"connect/proxies/envoy-extensions/usage/wasm","filePath":"../content/docs/connect/proxies/envoy-extensions/usage/wasm.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/usage/wasm","id":"sidebar-nav-item-141"}],"id":"sidebar-nav-item-134"},{"title":"Configuration","routes":[{"title":"External authorization","path":"connect/proxies/envoy-extensions/configuration/ext-authz","filePath":"../content/docs/connect/proxies/envoy-extensions/configuration/ext-authz.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/configuration/ext-authz","id":"sidebar-nav-item-143"},{"title":"OpenTelemetry Access Logging","path":"connect/proxies/envoy-extensions/configuration/otel-access-logging","filePath":"../content/docs/connect/proxies/envoy-extensions/configuration/otel-access-logging.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/configuration/otel-access-logging","id":"sidebar-nav-item-144"},{"title":"Property override","path":"connect/proxies/envoy-extensions/configuration/property-override","filePath":"../content/docs/connect/proxies/envoy-extensions/configuration/property-override.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/configuration/property-override","id":"sidebar-nav-item-145"},{"title":"WebAssembly","path":"connect/proxies/envoy-extensions/configuration/wasm","filePath":"../content/docs/connect/proxies/envoy-extensions/configuration/wasm.mdx","fullPath":"/consul/docs/connect/proxies/envoy-extensions/configuration/wasm","id":"sidebar-nav-item-146"}],"id":"sidebar-nav-item-142"}],"id":"sidebar-nav-item-132"},{"title":"Proxy integration","path":"connect/proxies/integrate","filePath":"../content/docs/connect/proxies/integrate.mdx","fullPath":"/consul/docs/connect/proxies/integrate","id":"sidebar-nav-item-147"},{"title":"Proxy defaults configuration reference","href":null,"fullPath":"/consul/docs/connect/config-entries/proxy-defaults","id":"sidebar-nav-item-148","path":"/consul/docs/connect/config-entries/proxy-defaults"},{"title":"Envoy proxies reference","path":"connect/proxies/envoy","filePath":"../content/docs/connect/proxies/envoy.mdx","fullPath":"/consul/docs/connect/proxies/envoy","id":"sidebar-nav-item-149"},{"title":"Built-in proxy reference","path":"connect/proxies/built-in","filePath":"../content/docs/connect/proxies/built-in.mdx","fullPath":"/consul/docs/connect/proxies/built-in","id":"sidebar-nav-item-150"},{"title":"Service mesh proxy configuration reference","path":"connect/proxies/proxy-config-reference","filePath":"../content/docs/connect/proxies/proxy-config-reference.mdx","fullPath":"/consul/docs/connect/proxies/proxy-config-reference","id":"sidebar-nav-item-151"}],"id":"sidebar-nav-item-128"},{"title":"Service intentions","routes":[{"title":"Overview","path":"connect/intentions","filePath":"../content/docs/connect/intentions/index.mdx","fullPath":"/consul/docs/connect/intentions","id":"sidebar-nav-item-153"},{"title":"Create and manage service intentions","path":"connect/intentions/create-manage-intentions","filePath":"../content/docs/connect/intentions/create-manage-intentions.mdx","fullPath":"/consul/docs/connect/intentions/create-manage-intentions","id":"sidebar-nav-item-154"},{"title":"JWT authorization for intentions","path":"connect/intentions/jwt-authorization","filePath":"../content/docs/connect/intentions/jwt-authorization.mdx","fullPath":"/consul/docs/connect/intentions/jwt-authorization","id":"sidebar-nav-item-155"},{"title":"Service intentions legacy mode","path":"connect/intentions/legacy","filePath":"../content/docs/connect/intentions/legacy.mdx","fullPath":"/consul/docs/connect/intentions/legacy","id":"sidebar-nav-item-156"},{"title":"Configuration","href":null,"fullPath":"/consul/docs/connect/config-entries/service-intentions","id":"sidebar-nav-item-157","path":"/consul/docs/connect/config-entries/service-intentions"}],"id":"sidebar-nav-item-152"},{"title":"Observability","routes":[{"title":"Overview","path":"connect/observability","filePath":"../content/docs/connect/observability/index.mdx","fullPath":"/consul/docs/connect/observability","id":"sidebar-nav-item-159"},{"title":"Access Logs","path":"connect/observability/access-logs","filePath":"../content/docs/connect/observability/access-logs.mdx","fullPath":"/consul/docs/connect/observability/access-logs","id":"sidebar-nav-item-160"},{"title":"UI Visualization","path":"connect/observability/ui-visualization","filePath":"../content/docs/connect/observability/ui-visualization.mdx","fullPath":"/consul/docs/connect/observability/ui-visualization","id":"sidebar-nav-item-161"}],"id":"sidebar-nav-item-158"},{"title":"Manage traffic","routes":[{"title":"Overview","path":"connect/manage-traffic","filePath":"../content/docs/connect/manage-traffic/index.mdx","fullPath":"/consul/docs/connect/manage-traffic","id":"sidebar-nav-item-163"},{"title":"Route traffic to local upstreams","path":"connect/manage-traffic/route-to-local-upstreams","filePath":"../content/docs/connect/manage-traffic/route-to-local-upstreams.mdx","fullPath":"/consul/docs/connect/manage-traffic/route-to-local-upstreams","id":"sidebar-nav-item-164"},{"title":"Limit request rates to services","path":"connect/manage-traffic/limit-request-rates","filePath":"../content/docs/connect/manage-traffic/limit-request-rates.mdx","fullPath":"/consul/docs/connect/manage-traffic/limit-request-rates","id":"sidebar-nav-item-165"},{"title":"Fault Injection","path":"connect/manage-traffic/fault-injection","filePath":"../content/docs/connect/manage-traffic/fault-injection.mdx","fullPath":"/consul/docs/connect/manage-traffic/fault-injection","id":"sidebar-nav-item-166"},{"title":"Failover","routes":[{"title":"Overview","path":"connect/manage-traffic/failover","filePath":"../content/docs/connect/manage-traffic/failover/index.mdx","fullPath":"/consul/docs/connect/manage-traffic/failover","id":"sidebar-nav-item-168"},{"title":"Configure failover services for Kubernetes","href":null,"fullPath":"/consul/docs/k8s/l7-traffic/failover-tproxy","id":"sidebar-nav-item-169","path":"/docs/k8s/l7-traffic/failover-tproxy"},{"title":"Automate geo-failover with prepared queries","href":null,"fullPath":"/consul/tutorials/developer-discovery/automate-geo-failover","id":"sidebar-nav-item-170","path":"/tutorials/developer-discovery/automate-geo-failover"},{"title":"Failover with sameness groups","path":"connect/manage-traffic/failover/sameness","filePath":"../content/docs/connect/manage-traffic/failover/sameness.mdx","fullPath":"/consul/docs/connect/manage-traffic/failover/sameness","id":"sidebar-nav-item-171"},{"title":"Configuration","routes":[{"title":"Service resolver","href":null,"fullPath":"/consul/docs/connect/config-entries/service-resolver","id":"sidebar-nav-item-173","path":"/consul/docs/connect/config-entries/service-resolver"},{"title":"Service intentions","href":null,"fullPath":"/consul/docs/connect/config-entries/service-intentions","id":"sidebar-nav-item-174","path":"/consul/docs/connect/config-entries/service-intentions"}],"id":"sidebar-nav-item-172"}],"id":"sidebar-nav-item-167"},{"title":"Discovery chain reference","path":"connect/manage-traffic/discovery-chain","filePath":"../content/docs/connect/manage-traffic/discovery-chain.mdx","fullPath":"/consul/docs/connect/manage-traffic/discovery-chain","id":"sidebar-nav-item-175"}],"id":"sidebar-nav-item-162"},{"title":"Connectivity Tasks","path":"connect/connectivity-tasks","filePath":"../content/docs/connect/connectivity-tasks.mdx","fullPath":"/consul/docs/connect/connectivity-tasks","id":"sidebar-nav-item-176"},{"title":"Distributed Tracing","path":"connect/distributed-tracing","filePath":"../content/docs/connect/distributed-tracing.mdx","fullPath":"/consul/docs/connect/distributed-tracing","id":"sidebar-nav-item-177"},{"title":"Gateways","routes":[{"title":"Overview","path":"connect/gateways","filePath":"../content/docs/connect/gateways/index.mdx","fullPath":"/consul/docs/connect/gateways","id":"sidebar-nav-item-179"},{"title":"API Gateways","routes":[{"title":"Overview","path":"connect/gateways/api-gateway","filePath":"../content/docs/connect/gateways/api-gateway/index.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway","id":"sidebar-nav-item-181"},{"title":"Technical specifications for Kubernetes","path":"connect/gateways/api-gateway/tech-specs","filePath":"../content/docs/connect/gateways/api-gateway/tech-specs.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/tech-specs","id":"sidebar-nav-item-182"},{"title":"Install on Kubernetes","path":"connect/gateways/api-gateway/install-k8s","filePath":"../content/docs/connect/gateways/api-gateway/install-k8s.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/install-k8s","id":"sidebar-nav-item-183"},{"title":"Upgrade on Kubernetes","path":"connect/gateways/api-gateway/upgrades-k8s","filePath":"../content/docs/connect/gateways/api-gateway/upgrades-k8s.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/upgrades-k8s","id":"sidebar-nav-item-184"},{"title":"Deploy listeners","routes":[{"title":"Deploy listeners to VMs","path":"connect/gateways/api-gateway/deploy/listeners-vms","filePath":"../content/docs/connect/gateways/api-gateway/deploy/listeners-vms.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/deploy/listeners-vms","id":"sidebar-nav-item-186"},{"title":"Deploy listeners to Kubernetes","path":"connect/gateways/api-gateway/deploy/listeners-k8s","filePath":"../content/docs/connect/gateways/api-gateway/deploy/listeners-k8s.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/deploy/listeners-k8s","id":"sidebar-nav-item-187"}],"id":"sidebar-nav-item-185"},{"title":"Define routes","routes":[{"title":"Define routes on VMs","path":"connect/gateways/api-gateway/define-routes/routes-vms","filePath":"../content/docs/connect/gateways/api-gateway/define-routes/routes-vms.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/define-routes/routes-vms","id":"sidebar-nav-item-189"},{"title":"Define routes on Kubernetes","path":"connect/gateways/api-gateway/define-routes/routes-k8s","filePath":"../content/docs/connect/gateways/api-gateway/define-routes/routes-k8s.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/define-routes/routes-k8s","id":"sidebar-nav-item-190"},{"title":"Reroute traffic in Kubernetes","path":"connect/gateways/api-gateway/define-routes/reroute-http-requests","filePath":"../content/docs/connect/gateways/api-gateway/define-routes/reroute-http-requests.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/define-routes/reroute-http-requests","id":"sidebar-nav-item-191"},{"title":"Route to peered services in Kubernetes","path":"connect/gateways/api-gateway/define-routes/route-to-peered-services","filePath":"../content/docs/connect/gateways/api-gateway/define-routes/route-to-peered-services.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/define-routes/route-to-peered-services","id":"sidebar-nav-item-192"}],"id":"sidebar-nav-item-188"},{"title":"Secure traffic","routes":[{"title":"Encrypt traffic on virtual machines","path":"connect/gateways/api-gateway/secure-traffic/encrypt-vms","filePath":"../content/docs/connect/gateways/api-gateway/secure-traffic/encrypt-vms.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/secure-traffic/encrypt-vms","id":"sidebar-nav-item-194"},{"title":"Verify incoming requests with JWTs on virtual machines","path":"connect/gateways/api-gateway/secure-traffic/verify-jwts-vms","filePath":"../content/docs/connect/gateways/api-gateway/secure-traffic/verify-jwts-vms.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/secure-traffic/verify-jwts-vms","id":"sidebar-nav-item-195"},{"title":"Verify incoming requests with JWTs on Kubernetes","path":"connect/gateways/api-gateway/secure-traffic/verify-jwts-k8s","filePath":"../content/docs/connect/gateways/api-gateway/secure-traffic/verify-jwts-k8s.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/secure-traffic/verify-jwts-k8s","id":"sidebar-nav-item-196"}],"id":"sidebar-nav-item-193"},{"title":"Configuration","routes":[{"title":"Overview","path":"connect/gateways/api-gateway/configuration","filePath":"../content/docs/connect/gateways/api-gateway/configuration/index.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration","id":"sidebar-nav-item-198"},{"title":"Gateway","path":"connect/gateways/api-gateway/configuration/gateway","filePath":"../content/docs/connect/gateways/api-gateway/configuration/gateway.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/gateway","id":"sidebar-nav-item-199"},{"title":"GatewayClass","path":"connect/gateways/api-gateway/configuration/gatewayclass","filePath":"../content/docs/connect/gateways/api-gateway/configuration/gatewayclass.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/gatewayclass","id":"sidebar-nav-item-200"},{"title":"GatewayClassConfig","path":"connect/gateways/api-gateway/configuration/gatewayclassconfig","filePath":"../content/docs/connect/gateways/api-gateway/configuration/gatewayclassconfig.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/gatewayclassconfig","id":"sidebar-nav-item-201"},{"title":"GatewayPolicy","path":"connect/gateways/api-gateway/configuration/gatewaypolicy","filePath":"../content/docs/connect/gateways/api-gateway/configuration/gatewaypolicy.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/gatewaypolicy","id":"sidebar-nav-item-202"},{"title":"RouteAuthFilter","path":"connect/gateways/api-gateway/configuration/routeauthfilter","filePath":"../content/docs/connect/gateways/api-gateway/configuration/routeauthfilter.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/routeauthfilter","id":"sidebar-nav-item-203"},{"title":"Routes","path":"connect/gateways/api-gateway/configuration/routes","filePath":"../content/docs/connect/gateways/api-gateway/configuration/routes.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/routes","id":"sidebar-nav-item-204"},{"title":"RouteRetryFilter","path":"connect/gateways/api-gateway/configuration/routeretryfilter","filePath":"../content/docs/connect/gateways/api-gateway/configuration/routeretryfilter.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/routeretryfilter","id":"sidebar-nav-item-205"},{"title":"RouteTimeoutFilter","path":"connect/gateways/api-gateway/configuration/routetimeoutfilter","filePath":"../content/docs/connect/gateways/api-gateway/configuration/routetimeoutfilter.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/routetimeoutfilter","id":"sidebar-nav-item-206"},{"title":"MeshService","path":"connect/gateways/api-gateway/configuration/meshservice","filePath":"../content/docs/connect/gateways/api-gateway/configuration/meshservice.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/configuration/meshservice","id":"sidebar-nav-item-207"}],"id":"sidebar-nav-item-197"},{"title":"Error Messages","path":"connect/gateways/api-gateway/errors","filePath":"../content/docs/connect/gateways/api-gateway/errors.mdx","fullPath":"/consul/docs/connect/gateways/api-gateway/errors","id":"sidebar-nav-item-208"}],"id":"sidebar-nav-item-180"},{"title":"Mesh Gateways","routes":[{"title":"Overview","path":"connect/gateways/mesh-gateway","filePath":"../content/docs/connect/gateways/mesh-gateway/index.mdx","fullPath":"/consul/docs/connect/gateways/mesh-gateway","id":"sidebar-nav-item-210"},{"title":"Enabling WAN Federation Control Plane Traffic","path":"connect/gateways/mesh-gateway/wan-federation-via-mesh-gateways","filePath":"../content/docs/connect/gateways/mesh-gateway/wan-federation-via-mesh-gateways.mdx","fullPath":"/consul/docs/connect/gateways/mesh-gateway/wan-federation-via-mesh-gateways","id":"sidebar-nav-item-211"},{"title":"Enabling Service-to-service Traffic Across WAN Federated Datacenters","path":"connect/gateways/mesh-gateway/service-to-service-traffic-wan-datacenters","filePath":"../content/docs/connect/gateways/mesh-gateway/service-to-service-traffic-wan-datacenters.mdx","fullPath":"/consul/docs/connect/gateways/mesh-gateway/service-to-service-traffic-wan-datacenters","id":"sidebar-nav-item-212"},{"title":"Enabling Service-to-service Traffic Across Admin Partitions","path":"connect/gateways/mesh-gateway/service-to-service-traffic-partitions","filePath":"../content/docs/connect/gateways/mesh-gateway/service-to-service-traffic-partitions.mdx","fullPath":"/consul/docs/connect/gateways/mesh-gateway/service-to-service-traffic-partitions","id":"sidebar-nav-item-213"},{"title":"Enabling Peering Control Plane Traffic","path":"connect/gateways/mesh-gateway/peering-via-mesh-gateways","filePath":"../content/docs/connect/gateways/mesh-gateway/peering-via-mesh-gateways.mdx","fullPath":"/consul/docs/connect/gateways/mesh-gateway/peering-via-mesh-gateways","id":"sidebar-nav-item-214"}],"id":"sidebar-nav-item-209"},{"title":"Ingress Gateways","routes":[{"title":"Overview","path":"connect/gateways/ingress-gateway","filePath":"../content/docs/connect/gateways/ingress-gateway/index.mdx","fullPath":"/consul/docs/connect/gateways/ingress-gateway","id":"sidebar-nav-item-216"},{"title":"Implement an ingress gateway","path":"connect/gateways/ingress-gateway/usage","filePath":"../content/docs/connect/gateways/ingress-gateway/usage.mdx","fullPath":"/consul/docs/connect/gateways/ingress-gateway/usage","id":"sidebar-nav-item-217"},{"title":"Serve TLS certificates from an external service","path":"connect/gateways/ingress-gateway/tls-external-service","filePath":"../content/docs/connect/gateways/ingress-gateway/tls-external-service.mdx","fullPath":"/consul/docs/connect/gateways/ingress-gateway/tls-external-service","id":"sidebar-nav-item-218"},{"title":"Configuration","href":null,"fullPath":"/consul/docs/connect/config-entries/ingress-gateway","id":"sidebar-nav-item-219","path":"/consul/docs/connect/config-entries/ingress-gateway"}],"id":"sidebar-nav-item-215"},{"title":"Terminating Gateways","path":"connect/gateways/terminating-gateway","filePath":"../content/docs/connect/gateways/terminating-gateway.mdx","fullPath":"/consul/docs/connect/gateways/terminating-gateway","id":"sidebar-nav-item-220"}],"id":"sidebar-nav-item-178"},{"title":"Cluster Peering","routes":[{"title":"Overview","path":"connect/cluster-peering","filePath":"../content/docs/connect/cluster-peering/index.mdx","fullPath":"/consul/docs/connect/cluster-peering","id":"sidebar-nav-item-222"},{"title":"Technical Specifications","path":"connect/cluster-peering/tech-specs","filePath":"../content/docs/connect/cluster-peering/tech-specs.mdx","fullPath":"/consul/docs/connect/cluster-peering/tech-specs","id":"sidebar-nav-item-223"},{"title":"Usage","routes":[{"title":"Establish Cluster Peering Connections","path":"connect/cluster-peering/usage/establish-cluster-peering","filePath":"../content/docs/connect/cluster-peering/usage/establish-cluster-peering.mdx","fullPath":"/consul/docs/connect/cluster-peering/usage/establish-cluster-peering","id":"sidebar-nav-item-225"},{"title":"Manage Cluster Peering Connections","path":"connect/cluster-peering/usage/manage-connections","filePath":"../content/docs/connect/cluster-peering/usage/manage-connections.mdx","fullPath":"/consul/docs/connect/cluster-peering/usage/manage-connections","id":"sidebar-nav-item-226"},{"title":"Manage L7 Traffic With Cluster Peering","path":"connect/cluster-peering/usage/peering-traffic-management","filePath":"../content/docs/connect/cluster-peering/usage/peering-traffic-management.mdx","fullPath":"/consul/docs/connect/cluster-peering/usage/peering-traffic-management","id":"sidebar-nav-item-227"},{"title":"Create Sameness Groups","path":"connect/cluster-peering/usage/create-sameness-groups","filePath":"../content/docs/connect/cluster-peering/usage/create-sameness-groups.mdx","fullPath":"/consul/docs/connect/cluster-peering/usage/create-sameness-groups","id":"sidebar-nav-item-228"}],"id":"sidebar-nav-item-224"}],"id":"sidebar-nav-item-221"},{"title":"Nomad","path":"connect/nomad","filePath":"../content/docs/connect/nomad.mdx","fullPath":"/consul/docs/connect/nomad","id":"sidebar-nav-item-229"},{"title":"Kubernetes","href":null,"fullPath":"/consul/docs/k8s/connect","id":"sidebar-nav-item-230","path":"/docs/k8s/connect"},{"title":"Native App Integration","routes":[{"title":"Overview","path":"connect/native","filePath":"../content/docs/connect/native/index.mdx","fullPath":"/consul/docs/connect/native","id":"sidebar-nav-item-232"},{"title":"Go Integration","path":"connect/native/go","filePath":"../content/docs/connect/native/go.mdx","fullPath":"/consul/docs/connect/native/go","id":"sidebar-nav-item-233"}],"id":"sidebar-nav-item-231"},{"title":"Certificate Management","routes":[{"title":"Overview","path":"connect/ca","filePath":"../content/docs/connect/ca/index.mdx","fullPath":"/consul/docs/connect/ca","id":"sidebar-nav-item-235"},{"title":"Built-In CA","path":"connect/ca/consul","filePath":"../content/docs/connect/ca/consul.mdx","fullPath":"/consul/docs/connect/ca/consul","id":"sidebar-nav-item-236"},{"title":"Vault","path":"connect/ca/vault","filePath":"../content/docs/connect/ca/vault.mdx","fullPath":"/consul/docs/connect/ca/vault","id":"sidebar-nav-item-237"},{"title":"ACM Private CA","path":"connect/ca/aws","filePath":"../content/docs/connect/ca/aws.mdx","fullPath":"/consul/docs/connect/ca/aws","id":"sidebar-nav-item-238"}],"id":"sidebar-nav-item-234"},{"title":"Develop and Debug","path":"connect/dev","filePath":"../content/docs/connect/dev.mdx","fullPath":"/consul/docs/connect/dev","id":"sidebar-nav-item-239"},{"title":"Consul Dataplane","routes":[{"title":"Overview","path":"connect/dataplane","filePath":"../content/docs/connect/dataplane/index.mdx","fullPath":"/consul/docs/connect/dataplane","id":"sidebar-nav-item-241"},{"title":"CLI Reference","path":"connect/dataplane/consul-dataplane","filePath":"../content/docs/connect/dataplane/consul-dataplane.mdx","fullPath":"/consul/docs/connect/dataplane/consul-dataplane","id":"sidebar-nav-item-242"},{"title":"Telemetry","path":"connect/dataplane/telemetry","filePath":"../content/docs/connect/dataplane/telemetry.mdx","fullPath":"/consul/docs/connect/dataplane/telemetry","id":"sidebar-nav-item-243"}],"id":"sidebar-nav-item-240"}],"id":"sidebar-nav-item-104"},{"title":"Dynamic App Configuration","routes":[{"title":"Consul KV","routes":[{"title":"Overview","path":"dynamic-app-config/kv","filePath":"../content/docs/dynamic-app-config/kv/index.mdx","fullPath":"/consul/docs/dynamic-app-config/kv","id":"sidebar-nav-item-246"},{"title":"Store keys and values","path":"dynamic-app-config/kv/store","filePath":"../content/docs/dynamic-app-config/kv/store.mdx","fullPath":"/consul/docs/dynamic-app-config/kv/store","id":"sidebar-nav-item-247"}],"id":"sidebar-nav-item-245"},{"title":"Sessions","path":"dynamic-app-config/sessions","filePath":"../content/docs/dynamic-app-config/sessions.mdx","fullPath":"/consul/docs/dynamic-app-config/sessions","id":"sidebar-nav-item-248"},{"title":"Watches","path":"dynamic-app-config/watches","filePath":"../content/docs/dynamic-app-config/watches.mdx","fullPath":"/consul/docs/dynamic-app-config/watches","id":"sidebar-nav-item-249"}],"id":"sidebar-nav-item-244"},{"title":"Security","routes":[{"title":"Overview","path":"security","filePath":"../content/docs/security/index.mdx","fullPath":"/consul/docs/security","id":"sidebar-nav-item-251"},{"title":"Access Control (ACLs)","routes":[{"title":"ACL System Overview","path":"security/acl","filePath":"../content/docs/security/acl/index.mdx","fullPath":"/consul/docs/security/acl","id":"sidebar-nav-item-253"},{"title":"Tokens","routes":[{"title":"Overview","path":"security/acl/tokens","filePath":"../content/docs/security/acl/tokens/index.mdx","fullPath":"/consul/docs/security/acl/tokens","id":"sidebar-nav-item-255"},{"title":"Create ACL Tokens","routes":[{"title":"Create a service token","path":"security/acl/tokens/create/create-a-service-token","filePath":"../content/docs/security/acl/tokens/create/create-a-service-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-service-token","id":"sidebar-nav-item-257"},{"title":"Create an agent token","path":"security/acl/tokens/create/create-an-agent-token","filePath":"../content/docs/security/acl/tokens/create/create-an-agent-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-an-agent-token","id":"sidebar-nav-item-258"},{"title":"Create a UI token","path":"security/acl/tokens/create/create-a-ui-token","filePath":"../content/docs/security/acl/tokens/create/create-a-ui-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-ui-token","id":"sidebar-nav-item-259"},{"title":"Create a mesh gateway token","path":"security/acl/tokens/create/create-a-mesh-gateway-token","filePath":"../content/docs/security/acl/tokens/create/create-a-mesh-gateway-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-mesh-gateway-token","id":"sidebar-nav-item-260"},{"title":"Create an ingress gateway token","path":"security/acl/tokens/create/create-an-ingress-gateway-token","filePath":"../content/docs/security/acl/tokens/create/create-an-ingress-gateway-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-an-ingress-gateway-token","id":"sidebar-nav-item-261"},{"title":"Create a terminating gateway token","path":"security/acl/tokens/create/create-a-terminating-gateway-token","filePath":"../content/docs/security/acl/tokens/create/create-a-terminating-gateway-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-terminating-gateway-token","id":"sidebar-nav-item-262"},{"title":"Create a DNS token","path":"security/acl/tokens/create/create-a-dns-token","filePath":"../content/docs/security/acl/tokens/create/create-a-dns-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-dns-token","id":"sidebar-nav-item-263"},{"title":"Create a replication token","path":"security/acl/tokens/create/create-a-replication-token","filePath":"../content/docs/security/acl/tokens/create/create-a-replication-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-replication-token","id":"sidebar-nav-item-264"},{"title":"Create a snapshot agent token","path":"security/acl/tokens/create/create-a-snapshot-agent-token","filePath":"../content/docs/security/acl/tokens/create/create-a-snapshot-agent-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-snapshot-agent-token","id":"sidebar-nav-item-265"},{"title":"Create a token for Vault's Consul storage backend","path":"security/acl/tokens/create/create-a-token-for-vault-consul-storage","filePath":"../content/docs/security/acl/tokens/create/create-a-token-for-vault-consul-storage.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-token-for-vault-consul-storage","id":"sidebar-nav-item-266"},{"title":"Create a Consul ESM token","path":"security/acl/tokens/create/create-a-consul-esm-token","filePath":"../content/docs/security/acl/tokens/create/create-a-consul-esm-token.mdx","fullPath":"/consul/docs/security/acl/tokens/create/create-a-consul-esm-token","id":"sidebar-nav-item-267"}],"id":"sidebar-nav-item-256"}],"id":"sidebar-nav-item-254"},{"title":"Policies","path":"security/acl/acl-policies","filePath":"../content/docs/security/acl/acl-policies.mdx","fullPath":"/consul/docs/security/acl/acl-policies","id":"sidebar-nav-item-268"},{"title":"Roles","path":"security/acl/acl-roles","filePath":"../content/docs/security/acl/acl-roles.mdx","fullPath":"/consul/docs/security/acl/acl-roles","id":"sidebar-nav-item-269"},{"title":"Rules Reference","path":"security/acl/acl-rules","filePath":"../content/docs/security/acl/acl-rules.mdx","fullPath":"/consul/docs/security/acl/acl-rules","id":"sidebar-nav-item-270"},{"title":"ACLs in Federated Datacenters","path":"security/acl/acl-federated-datacenters","filePath":"../content/docs/security/acl/acl-federated-datacenters.mdx","fullPath":"/consul/docs/security/acl/acl-federated-datacenters","id":"sidebar-nav-item-271"},{"title":"Auth Methods","routes":[{"title":"Overview","path":"security/acl/auth-methods","filePath":"../content/docs/security/acl/auth-methods/index.mdx","fullPath":"/consul/docs/security/acl/auth-methods","id":"sidebar-nav-item-273"},{"title":"Kubernetes","path":"security/acl/auth-methods/kubernetes","filePath":"../content/docs/security/acl/auth-methods/kubernetes.mdx","fullPath":"/consul/docs/security/acl/auth-methods/kubernetes","id":"sidebar-nav-item-274"},{"title":"JWT","path":"security/acl/auth-methods/jwt","filePath":"../content/docs/security/acl/auth-methods/jwt.mdx","fullPath":"/consul/docs/security/acl/auth-methods/jwt","id":"sidebar-nav-item-275"},{"title":"OIDC","path":"security/acl/auth-methods/oidc","filePath":"../content/docs/security/acl/auth-methods/oidc.mdx","fullPath":"/consul/docs/security/acl/auth-methods/oidc","id":"sidebar-nav-item-276"},{"title":"AWS IAM","path":"security/acl/auth-methods/aws-iam","filePath":"../content/docs/security/acl/auth-methods/aws-iam.mdx","fullPath":"/consul/docs/security/acl/auth-methods/aws-iam","id":"sidebar-nav-item-277"}],"id":"sidebar-nav-item-272"}],"id":"sidebar-nav-item-252"},{"title":"Encryption","path":"security/encryption","filePath":"../content/docs/security/encryption.mdx","fullPath":"/consul/docs/security/encryption","id":"sidebar-nav-item-278"},{"title":"Security Models","routes":[{"title":"Overview","path":"security/security-models","filePath":"../content/docs/security/security-models/index.mdx","fullPath":"/consul/docs/security/security-models","id":"sidebar-nav-item-280"},{"title":"Core","path":"security/security-models/core","filePath":"../content/docs/security/security-models/core.mdx","fullPath":"/consul/docs/security/security-models/core","id":"sidebar-nav-item-281"},{"title":"Network Infrastructure Automation","path":"security/security-models/nia","filePath":"../content/docs/security/security-models/nia.mdx","fullPath":"/consul/docs/security/security-models/nia","id":"sidebar-nav-item-282"}],"id":"sidebar-nav-item-279"}],"id":"sidebar-nav-item-250"},{"title":"Agent","routes":[{"title":"Overview","path":"agent","filePath":"../content/docs/agent/index.mdx","fullPath":"/consul/docs/agent","id":"sidebar-nav-item-284"},{"title":"Configuration","routes":[{"title":"General","path":"agent/config","filePath":"../content/docs/agent/config/index.mdx","fullPath":"/consul/docs/agent/config","id":"sidebar-nav-item-286"},{"title":"CLI Reference","path":"agent/config/cli-flags","filePath":"../content/docs/agent/config/cli-flags.mdx","fullPath":"/consul/docs/agent/config/cli-flags","id":"sidebar-nav-item-287"},{"title":"Configuration Reference","path":"agent/config/config-files","filePath":"../content/docs/agent/config/config-files.mdx","fullPath":"/consul/docs/agent/config/config-files","id":"sidebar-nav-item-288"}],"id":"sidebar-nav-item-285"},{"title":"Limit traffic rates","routes":[{"title":"Overview","path":"agent/limits","filePath":"../content/docs/agent/limits/index.mdx","fullPath":"/consul/docs/agent/limits","id":"sidebar-nav-item-290"},{"title":"Usage","routes":[{"title":"Initialize rate limit settings","path":"agent/limits/usage/init-rate-limits","filePath":"../content/docs/agent/limits/usage/init-rate-limits.mdx","fullPath":"/consul/docs/agent/limits/usage/init-rate-limits","id":"sidebar-nav-item-292"},{"title":"Monitor traffic rate limits","path":"agent/limits/usage/monitor-rate-limits","filePath":"../content/docs/agent/limits/usage/monitor-rate-limits.mdx","fullPath":"/consul/docs/agent/limits/usage/monitor-rate-limits","id":"sidebar-nav-item-293"},{"title":"Set global traffic rate limits","path":"agent/limits/usage/set-global-traffic-rate-limits","filePath":"../content/docs/agent/limits/usage/set-global-traffic-rate-limits.mdx","fullPath":"/consul/docs/agent/limits/usage/set-global-traffic-rate-limits","id":"sidebar-nav-item-294"},{"title":"Limit traffic rates from source IP addresses","path":"agent/limits/usage/limit-request-rates-from-ips","filePath":"../content/docs/agent/limits/usage/limit-request-rates-from-ips.mdx","fullPath":"/consul/docs/agent/limits/usage/limit-request-rates-from-ips","id":"sidebar-nav-item-295"}],"id":"sidebar-nav-item-291"},{"title":"Configuration","href":null,"fullPath":"/consul/docs/connect/config-entries/control-plane-request-limit","id":"sidebar-nav-item-296","path":"/docs/connect/config-entries/control-plane-request-limit"}],"id":"sidebar-nav-item-289"},{"title":"Configuration Entries","path":"agent/config-entries","filePath":"../content/docs/agent/config-entries.mdx","fullPath":"/consul/docs/agent/config-entries","id":"sidebar-nav-item-297"},{"title":"Telemetry","path":"agent/telemetry","filePath":"../content/docs/agent/telemetry.mdx","fullPath":"/consul/docs/agent/telemetry","id":"sidebar-nav-item-298"},{"title":"Sentinel","path":"agent/sentinel","filePath":"../content/docs/agent/sentinel.mdx","fullPath":"/consul/docs/agent/sentinel","id":"sidebar-nav-item-299"},{"title":"Experimental WAL LogStore","routes":[{"title":"Overview","path":"agent/wal-logstore","filePath":"../content/docs/agent/wal-logstore/index.mdx","fullPath":"/consul/docs/agent/wal-logstore","id":"sidebar-nav-item-301"},{"title":"Enable WAL LogStore backend","path":"agent/wal-logstore/enable","filePath":"../content/docs/agent/wal-logstore/enable.mdx","fullPath":"/consul/docs/agent/wal-logstore/enable","id":"sidebar-nav-item-302"},{"title":"Monitor Raft metrics and logs for WAL","path":"agent/wal-logstore/monitoring","filePath":"../content/docs/agent/wal-logstore/monitoring.mdx","fullPath":"/consul/docs/agent/wal-logstore/monitoring","id":"sidebar-nav-item-303"},{"title":"Revert to BoltDB","path":"agent/wal-logstore/revert-to-boltdb","filePath":"../content/docs/agent/wal-logstore/revert-to-boltdb.mdx","fullPath":"/consul/docs/agent/wal-logstore/revert-to-boltdb","id":"sidebar-nav-item-304"}],"id":"sidebar-nav-item-300"}],"id":"sidebar-nav-item-283"},{"title":"Integrations","routes":[{"title":"Consul Integration Program","path":"integrate/partnerships","filePath":"../content/docs/integrate/partnerships.mdx","fullPath":"/consul/docs/integrate/partnerships","id":"sidebar-nav-item-306"},{"title":"NIA Integration Program","path":"integrate/nia-integration","filePath":"../content/docs/integrate/nia-integration.mdx","fullPath":"/consul/docs/integrate/nia-integration","id":"sidebar-nav-item-307"},{"title":"Vault Integration","href":null,"fullPath":"/consul/docs/connect/ca/vault","id":"sidebar-nav-item-308","path":"/docs/connect/ca/vault"},{"title":"Proxy Integration","href":null,"fullPath":"/consul/docs/connect/proxies/integrate","id":"sidebar-nav-item-309","path":"/docs/connect/proxies/integrate"},{"title":"Consul Tools","path":"integrate/download-tools","filePath":"../content/docs/integrate/download-tools.mdx","fullPath":"/consul/docs/integrate/download-tools","id":"sidebar-nav-item-310"}],"id":"sidebar-nav-item-305"},{"title":"Troubleshoot","routes":[{"title":"Service-to-Service Troubleshooting","path":"troubleshoot/troubleshoot-services","filePath":"../content/docs/troubleshoot/troubleshoot-services.mdx","fullPath":"/consul/docs/troubleshoot/troubleshoot-services","id":"sidebar-nav-item-312"},{"title":"Common Error Messages","path":"troubleshoot/common-errors","filePath":"../content/docs/troubleshoot/common-errors.mdx","fullPath":"/consul/docs/troubleshoot/common-errors","id":"sidebar-nav-item-313"},{"title":"FAQ","path":"troubleshoot/faq","filePath":"../content/docs/troubleshoot/faq.mdx","fullPath":"/consul/docs/troubleshoot/faq","id":"sidebar-nav-item-314"}],"id":"sidebar-nav-item-311"},{"divider":true,"id":"sidebar-nav-item-315"},{"title":"Kubernetes","routes":[{"title":"Overview","path":"k8s","filePath":"../content/docs/k8s/index.mdx","fullPath":"/consul/docs/k8s","id":"sidebar-nav-item-317"},{"title":"Architecture","path":"k8s/architecture","filePath":"../content/docs/k8s/architecture.mdx","fullPath":"/consul/docs/k8s/architecture","id":"sidebar-nav-item-318"},{"title":"Installation","routes":[{"title":"Install from Consul K8s CLI","path":"k8s/installation/install-cli","filePath":"../content/docs/k8s/installation/install-cli.mdx","fullPath":"/consul/docs/k8s/installation/install-cli","id":"sidebar-nav-item-320"},{"title":"Install from Helm Chart","path":"k8s/installation/install","filePath":"../content/docs/k8s/installation/install.mdx","fullPath":"/consul/docs/k8s/installation/install","id":"sidebar-nav-item-321"}],"id":"sidebar-nav-item-319"},{"title":"Deployment Configurations","routes":[{"title":"Consul Clients Outside Kubernetes","path":"k8s/deployment-configurations/clients-outside-kubernetes","filePath":"../content/docs/k8s/deployment-configurations/clients-outside-kubernetes.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/clients-outside-kubernetes","id":"sidebar-nav-item-323"},{"title":"Consul Servers Outside Kubernetes","path":"k8s/deployment-configurations/servers-outside-kubernetes","filePath":"../content/docs/k8s/deployment-configurations/servers-outside-kubernetes.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/servers-outside-kubernetes","id":"sidebar-nav-item-324"},{"title":"Single Consul Datacenter in Multiple Kubernetes Clusters","path":"k8s/deployment-configurations/single-dc-multi-k8s","filePath":"../content/docs/k8s/deployment-configurations/single-dc-multi-k8s.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/single-dc-multi-k8s","id":"sidebar-nav-item-325"},{"title":"Consul Enterprise","path":"k8s/deployment-configurations/consul-enterprise","filePath":"../content/docs/k8s/deployment-configurations/consul-enterprise.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/consul-enterprise","id":"sidebar-nav-item-326"},{"title":"Multi-Cluster Federation","routes":[{"title":"Overview","path":"k8s/deployment-configurations/multi-cluster","filePath":"../content/docs/k8s/deployment-configurations/multi-cluster/index.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/multi-cluster","id":"sidebar-nav-item-328"},{"title":"Federation Between Kubernetes Clusters","path":"k8s/deployment-configurations/multi-cluster/kubernetes","filePath":"../content/docs/k8s/deployment-configurations/multi-cluster/kubernetes.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/multi-cluster/kubernetes","id":"sidebar-nav-item-329"},{"title":"Federation Between VMs and Kubernetes","path":"k8s/deployment-configurations/multi-cluster/vms-and-kubernetes","filePath":"../content/docs/k8s/deployment-configurations/multi-cluster/vms-and-kubernetes.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/multi-cluster/vms-and-kubernetes","id":"sidebar-nav-item-330"}],"id":"sidebar-nav-item-327"},{"title":"Vault as Secrets Backend","routes":[{"title":"Overview","path":"k8s/deployment-configurations/vault","filePath":"../content/docs/k8s/deployment-configurations/vault/index.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault","id":"sidebar-nav-item-332"},{"title":"Systems Integration","path":"k8s/deployment-configurations/vault/systems-integration","filePath":"../content/docs/k8s/deployment-configurations/vault/systems-integration.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/systems-integration","id":"sidebar-nav-item-333"},{"title":"Data Integration","routes":[{"title":"Overview","path":"k8s/deployment-configurations/vault/data-integration","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/index.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration","id":"sidebar-nav-item-335"},{"title":"Bootstrap Token","path":"k8s/deployment-configurations/vault/data-integration/bootstrap-token","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/bootstrap-token.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/bootstrap-token","id":"sidebar-nav-item-336"},{"title":"Enterprise License","path":"k8s/deployment-configurations/vault/data-integration/enterprise-license","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/enterprise-license.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/enterprise-license","id":"sidebar-nav-item-337"},{"title":"Gossip Encryption Key","path":"k8s/deployment-configurations/vault/data-integration/gossip","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/gossip.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/gossip","id":"sidebar-nav-item-338"},{"title":"Partition Token","path":"k8s/deployment-configurations/vault/data-integration/partition-token","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/partition-token.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/partition-token","id":"sidebar-nav-item-339"},{"title":"Replication Token","path":"k8s/deployment-configurations/vault/data-integration/replication-token","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/replication-token.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/replication-token","id":"sidebar-nav-item-340"},{"title":"Server TLS","path":"k8s/deployment-configurations/vault/data-integration/server-tls","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/server-tls.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/server-tls","id":"sidebar-nav-item-341"},{"title":"Service Mesh Certificates","path":"k8s/deployment-configurations/vault/data-integration/connect-ca","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/connect-ca.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/connect-ca","id":"sidebar-nav-item-342"},{"title":"Snapshot Agent Config","path":"k8s/deployment-configurations/vault/data-integration/snapshot-agent-config","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/snapshot-agent-config.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/snapshot-agent-config","id":"sidebar-nav-item-343"},{"title":"Webhook Certificates","path":"k8s/deployment-configurations/vault/data-integration/webhook-certs","filePath":"../content/docs/k8s/deployment-configurations/vault/data-integration/webhook-certs.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/data-integration/webhook-certs","id":"sidebar-nav-item-344"}],"id":"sidebar-nav-item-334"},{"title":"WAN Federation","path":"k8s/deployment-configurations/vault/wan-federation","filePath":"../content/docs/k8s/deployment-configurations/vault/wan-federation.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/vault/wan-federation","id":"sidebar-nav-item-345"}],"id":"sidebar-nav-item-331"},{"title":"Datadog metrics","path":"k8s/deployment-configurations/datadog","filePath":"../content/docs/k8s/deployment-configurations/datadog.mdx","fullPath":"/consul/docs/k8s/deployment-configurations/datadog","id":"sidebar-nav-item-346"}],"id":"sidebar-nav-item-322"},{"title":"Platform Guides","routes":[{"title":"Minikube","href":"/consul/tutorials/kubernetes/kubernetes-minikube?utm_source=consul.io\u0026utm_medium=docs\u0026utm_content=k8s\u0026utm_term=mk","id":"sidebar-nav-item-348"},{"title":"Kind","href":"/consul/tutorials/kubernetes/kubernetes-kind?utm_source=consul.io\u0026utm_medium=docs\u0026utm_content=k8s\u0026utm_term=kind","id":"sidebar-nav-item-349"},{"title":"AKS (Azure)","href":"/consul/tutorials/kubernetes/kubernetes-aks-azure?utm_source=consul.io\u0026utm_medium=docs\u0026utm_content=k8s\u0026utm_term=aks","id":"sidebar-nav-item-350"},{"title":"EKS (AWS)","href":"/consul/tutorials/kubernetes/kubernetes-eks-aws?utm_source=consul.io\u0026utm_medium=docs\u0026utm_content=k8s\u0026utm_term=eks","id":"sidebar-nav-item-351"},{"title":"GKE (Google Cloud)","href":"/consul/tutorials/kubernetes/kubernetes-gke-google?utm_source=consul.io\u0026utm_medium=docs\u0026utm_content=k8s\u0026utm_term=gke","id":"sidebar-nav-item-352"},{"title":"Red Hat OpenShift","href":"/consul/tutorials/kubernetes/kubernetes-openshift-red-hat?utm_source=consul.io\u0026utm_medium=docs\u0026utm_content=k8s\u0026utm_term=openshift","id":"sidebar-nav-item-353"},{"title":"Self Hosted Kubernetes","path":"k8s/platforms/self-hosted-kubernetes","filePath":"../content/docs/k8s/platforms/self-hosted-kubernetes.mdx","fullPath":"/consul/docs/k8s/platforms/self-hosted-kubernetes","id":"sidebar-nav-item-354"}],"id":"sidebar-nav-item-347"},{"title":"Service Mesh","routes":[{"title":"Overview","path":"k8s/connect","filePath":"../content/docs/k8s/connect/index.mdx","fullPath":"/consul/docs/k8s/connect","id":"sidebar-nav-item-356"},{"title":"Admin Partitions","href":null,"fullPath":"/consul/docs/enterprise/admin-partitions","id":"sidebar-nav-item-357","path":"/docs/enterprise/admin-partitions"},{"title":"Cluster Peering","routes":[{"title":"Technical Specifications","path":"k8s/connect/cluster-peering/tech-specs","filePath":"../content/docs/k8s/connect/cluster-peering/tech-specs.mdx","fullPath":"/consul/docs/k8s/connect/cluster-peering/tech-specs","id":"sidebar-nav-item-359"},{"title":"Usage","routes":[{"title":"Establish Cluster Peering Connections","path":"k8s/connect/cluster-peering/usage/establish-peering","filePath":"../content/docs/k8s/connect/cluster-peering/usage/establish-peering.mdx","fullPath":"/consul/docs/k8s/connect/cluster-peering/usage/establish-peering","id":"sidebar-nav-item-361"},{"title":"Manage Cluster Peering Connections","path":"k8s/connect/cluster-peering/usage/manage-peering","filePath":"../content/docs/k8s/connect/cluster-peering/usage/manage-peering.mdx","fullPath":"/consul/docs/k8s/connect/cluster-peering/usage/manage-peering","id":"sidebar-nav-item-362"},{"title":"Manage L7 Traffic With Cluster Peering","path":"k8s/connect/cluster-peering/usage/l7-traffic","filePath":"../content/docs/k8s/connect/cluster-peering/usage/l7-traffic.mdx","fullPath":"/consul/docs/k8s/connect/cluster-peering/usage/l7-traffic","id":"sidebar-nav-item-363"},{"title":"Create Sameness Groups","path":"k8s/connect/cluster-peering/usage/create-sameness-groups","filePath":"../content/docs/k8s/connect/cluster-peering/usage/create-sameness-groups.mdx","fullPath":"/consul/docs/k8s/connect/cluster-peering/usage/create-sameness-groups","id":"sidebar-nav-item-364"}],"id":"sidebar-nav-item-360"}],"id":"sidebar-nav-item-358"},{"title":"Transparent Proxy","routes":[{"title":"Overview","path":"k8s/connect/transparent-proxy","filePath":"../content/docs/k8s/connect/transparent-proxy/index.mdx","fullPath":"/consul/docs/k8s/connect/transparent-proxy","id":"sidebar-nav-item-366"},{"title":"Enable transparent proxy","path":"k8s/connect/transparent-proxy/enable-transparent-proxy","filePath":"../content/docs/k8s/connect/transparent-proxy/enable-transparent-proxy.mdx","fullPath":"/consul/docs/k8s/connect/transparent-proxy/enable-transparent-proxy","id":"sidebar-nav-item-367"},{"title":"Route traffic to virtual services","href":null,"fullPath":"/consul/docs/k8s/l7-traffic/route-to-virtual-services","id":"sidebar-nav-item-368","path":"/docs/k8s/l7-traffic/route-to-virtual-services"}],"id":"sidebar-nav-item-365"},{"title":"Onboarding services in transparent proxy mode","path":"k8s/connect/onboarding-tproxy-mode","filePath":"../content/docs/k8s/connect/onboarding-tproxy-mode.mdx","fullPath":"/consul/docs/k8s/connect/onboarding-tproxy-mode","id":"sidebar-nav-item-369"},{"title":"Ingress Gateways","path":"k8s/connect/ingress-gateways","filePath":"../content/docs/k8s/connect/ingress-gateways.mdx","fullPath":"/consul/docs/k8s/connect/ingress-gateways","id":"sidebar-nav-item-370"},{"title":"Terminating Gateways","path":"k8s/connect/terminating-gateways","filePath":"../content/docs/k8s/connect/terminating-gateways.mdx","fullPath":"/consul/docs/k8s/connect/terminating-gateways","id":"sidebar-nav-item-371"},{"title":"Ingress Controllers","path":"k8s/connect/ingress-controllers","filePath":"../content/docs/k8s/connect/ingress-controllers.mdx","fullPath":"/consul/docs/k8s/connect/ingress-controllers","id":"sidebar-nav-item-372"},{"title":"Configuring a Connect CA Provider","path":"k8s/connect/connect-ca-provider","filePath":"../content/docs/k8s/connect/connect-ca-provider.mdx","fullPath":"/consul/docs/k8s/connect/connect-ca-provider","id":"sidebar-nav-item-373"},{"title":"Health Checks","path":"k8s/connect/health","filePath":"../content/docs/k8s/connect/health.mdx","fullPath":"/consul/docs/k8s/connect/health","id":"sidebar-nav-item-374"},{"title":"Observability","routes":[{"title":"Metrics","path":"k8s/connect/observability/metrics","filePath":"../content/docs/k8s/connect/observability/metrics.mdx","fullPath":"/consul/docs/k8s/connect/observability/metrics","id":"sidebar-nav-item-376"}],"id":"sidebar-nav-item-375"}],"id":"sidebar-nav-item-355"},{"title":"V2 Catalog API","routes":[{"title":"Overview","path":"k8s/multiport","filePath":"../content/docs/k8s/multiport/index.mdx","fullPath":"/consul/docs/k8s/multiport","id":"sidebar-nav-item-378"},{"title":"Configure multi-port services","path":"k8s/multiport/configure","filePath":"../content/docs/k8s/multiport/configure.mdx","fullPath":"/consul/docs/k8s/multiport/configure","id":"sidebar-nav-item-379"},{"title":"Split TCP traffic between multiple ports","path":"k8s/multiport/traffic-split","filePath":"../content/docs/k8s/multiport/traffic-split.mdx","fullPath":"/consul/docs/k8s/multiport/traffic-split","id":"sidebar-nav-item-380"},{"title":"Reference","routes":[{"title":"GRPCRoute resource","path":"k8s/multiport/reference/grpcroute","filePath":"../content/docs/k8s/multiport/reference/grpcroute.mdx","fullPath":"/consul/docs/k8s/multiport/reference/grpcroute","id":"sidebar-nav-item-382"},{"title":"HTTPRoute resource","path":"k8s/multiport/reference/httproute","filePath":"../content/docs/k8s/multiport/reference/httproute.mdx","fullPath":"/consul/docs/k8s/multiport/reference/httproute","id":"sidebar-nav-item-383"},{"title":"ProxyConfiguration resource","path":"k8s/multiport/reference/proxyconfiguration","filePath":"../content/docs/k8s/multiport/reference/proxyconfiguration.mdx","fullPath":"/consul/docs/k8s/multiport/reference/proxyconfiguration","id":"sidebar-nav-item-384"},{"title":"TCPRoute resource","path":"k8s/multiport/reference/tcproute","filePath":"../content/docs/k8s/multiport/reference/tcproute.mdx","fullPath":"/consul/docs/k8s/multiport/reference/tcproute","id":"sidebar-nav-item-385"},{"title":"TrafficPermissions resource","path":"k8s/multiport/reference/trafficpermissions","filePath":"../content/docs/k8s/multiport/reference/trafficpermissions.mdx","fullPath":"/consul/docs/k8s/multiport/reference/trafficpermissions","id":"sidebar-nav-item-386"}],"id":"sidebar-nav-item-381"}],"id":"sidebar-nav-item-377"},{"title":"L7 traffic management","routes":[{"title":"Overview","href":null,"fullPath":"/consul/docs/connect/manage-traffic","id":"sidebar-nav-item-388","path":"/docs/connect/manage-traffic"},{"title":"Configure failover services","path":"k8s/l7-traffic/failover-tproxy","filePath":"../content/docs/k8s/l7-traffic/failover-tproxy.mdx","fullPath":"/consul/docs/k8s/l7-traffic/failover-tproxy","id":"sidebar-nav-item-389"},{"title":"Route traffic to virtual services","path":"k8s/l7-traffic/route-to-virtual-services","filePath":"../content/docs/k8s/l7-traffic/route-to-virtual-services.mdx","fullPath":"/consul/docs/k8s/l7-traffic/route-to-virtual-services","id":"sidebar-nav-item-390"}],"id":"sidebar-nav-item-387"},{"title":"Service Sync","path":"k8s/service-sync","filePath":"../content/docs/k8s/service-sync.mdx","fullPath":"/consul/docs/k8s/service-sync","id":"sidebar-nav-item-391"},{"title":"Custom Resource Definitions","routes":[{"title":"Overview","path":"k8s/crds","filePath":"../content/docs/k8s/crds/index.mdx","fullPath":"/consul/docs/k8s/crds","id":"sidebar-nav-item-393"},{"title":"Upgrade An Existing Cluster to CRDs","path":"k8s/crds/upgrade-to-crds","filePath":"../content/docs/k8s/crds/upgrade-to-crds.mdx","fullPath":"/consul/docs/k8s/crds/upgrade-to-crds","id":"sidebar-nav-item-394"}],"id":"sidebar-nav-item-392"},{"title":"Annotations and Labels","path":"k8s/annotations-and-labels","filePath":"../content/docs/k8s/annotations-and-labels.mdx","fullPath":"/consul/docs/k8s/annotations-and-labels","id":"sidebar-nav-item-395"},{"title":"Consul DNS","path":"k8s/dns","filePath":"../content/docs/k8s/dns.mdx","fullPath":"/consul/docs/k8s/dns","id":"sidebar-nav-item-396"},{"title":"Upgrade","routes":[{"title":"Upgrading Consul on Kubernetes","path":"k8s/upgrade","filePath":"../content/docs/k8s/upgrade/index.mdx","fullPath":"/consul/docs/k8s/upgrade","id":"sidebar-nav-item-398"},{"title":"Upgrading Consul K8s CLI","path":"k8s/upgrade/upgrade-cli","filePath":"../content/docs/k8s/upgrade/upgrade-cli.mdx","fullPath":"/consul/docs/k8s/upgrade/upgrade-cli","id":"sidebar-nav-item-399"}],"id":"sidebar-nav-item-397"},{"title":"Consul Dataplane","routes":[{"title":"Overview","href":null,"fullPath":"/consul/docs/connect/dataplane","id":"sidebar-nav-item-401","path":"/docs/connect/dataplane"},{"title":"CLI Reference","href":null,"fullPath":"/consul/docs/connect/dataplane/consul-dataplane","id":"sidebar-nav-item-402","path":"/docs/connect/dataplane/consul-dataplane"}],"id":"sidebar-nav-item-400"},{"title":"Operations","routes":[{"title":"Uninstall","path":"k8s/operations/uninstall","filePath":"../content/docs/k8s/operations/uninstall.mdx","fullPath":"/consul/docs/k8s/operations/uninstall","id":"sidebar-nav-item-404"},{"title":"Certificate Rotation","path":"k8s/operations/certificate-rotation","filePath":"../content/docs/k8s/operations/certificate-rotation.mdx","fullPath":"/consul/docs/k8s/operations/certificate-rotation","id":"sidebar-nav-item-405"},{"title":"Gossip Encryption Key Rotation","path":"k8s/operations/gossip-encryption-key-rotation","filePath":"../content/docs/k8s/operations/gossip-encryption-key-rotation.mdx","fullPath":"/consul/docs/k8s/operations/gossip-encryption-key-rotation","id":"sidebar-nav-item-406"},{"title":"Configure TLS on an Existing Cluster","path":"k8s/operations/tls-on-existing-cluster","filePath":"../content/docs/k8s/operations/tls-on-existing-cluster.mdx","fullPath":"/consul/docs/k8s/operations/tls-on-existing-cluster","id":"sidebar-nav-item-407"}],"id":"sidebar-nav-item-403"},{"title":"Troubleshoot","routes":[{"title":"Common Error Messages","href":null,"fullPath":"/consul/docs/troubleshoot/common-errors#common-errors-on-kubernetes","id":"sidebar-nav-item-409","path":"/docs/troubleshoot/common-errors#common-errors-on-kubernetes"},{"title":"FAQ","href":null,"fullPath":"/consul/docs/troubleshoot/faq#consul-on-kubernetes","id":"sidebar-nav-item-410","path":"/docs/troubleshoot/faq#consul-on-kubernetes"}],"id":"sidebar-nav-item-408"},{"title":"Compatibility Matrix","path":"k8s/compatibility","filePath":"../content/docs/k8s/compatibility.mdx","fullPath":"/consul/docs/k8s/compatibility","id":"sidebar-nav-item-411"},{"title":"Helm Chart Configuration","path":"k8s/helm","filePath":"../content/docs/k8s/helm.mdx","fullPath":"/consul/docs/k8s/helm","id":"sidebar-nav-item-412"},{"title":"Consul K8s CLI Reference","path":"k8s/k8s-cli","filePath":"../content/docs/k8s/k8s-cli.mdx","fullPath":"/consul/docs/k8s/k8s-cli","id":"sidebar-nav-item-413"}],"id":"sidebar-nav-item-316"},{"title":"Nomad","path":"nomad","filePath":"../content/docs/nomad/index.mdx","fullPath":"/consul/docs/nomad","id":"sidebar-nav-item-414"},{"title":"AWS ECS","routes":[{"title":"Overview","path":"ecs","filePath":"../content/docs/ecs/index.mdx","fullPath":"/consul/docs/ecs","id":"sidebar-nav-item-416"},{"title":"Architecture","path":"ecs/architecture","filePath":"../content/docs/ecs/architecture.mdx","fullPath":"/consul/docs/ecs/architecture","id":"sidebar-nav-item-417"},{"title":"Technical specifications","path":"ecs/tech-specs","filePath":"../content/docs/ecs/tech-specs.mdx","fullPath":"/consul/docs/ecs/tech-specs","id":"sidebar-nav-item-418"},{"title":"Deploy Consul to ECS","routes":[{"title":"Deploy using the Terraform module","path":"ecs/deploy/terraform","filePath":"../content/docs/ecs/deploy/terraform.mdx","fullPath":"/consul/docs/ecs/deploy/terraform","id":"sidebar-nav-item-420"},{"title":"Deploy manually","path":"ecs/deploy/manual","filePath":"../content/docs/ecs/deploy/manual.mdx","fullPath":"/consul/docs/ecs/deploy/manual","id":"sidebar-nav-item-421"},{"title":"Configure the ECS task bind address","path":"ecs/deploy/bind-addresses","filePath":"../content/docs/ecs/deploy/bind-addresses.mdx","fullPath":"/consul/docs/ecs/deploy/bind-addresses","id":"sidebar-nav-item-422"},{"title":"Configure routes between ECS tasks","path":"ecs/deploy/configure-routes","filePath":"../content/docs/ecs/deploy/configure-routes.mdx","fullPath":"/consul/docs/ecs/deploy/configure-routes","id":"sidebar-nav-item-423"},{"title":"Migrate existing tasks","path":"ecs/deploy/migrate-existing-tasks","filePath":"../content/docs/ecs/deploy/migrate-existing-tasks.mdx","fullPath":"/consul/docs/ecs/deploy/migrate-existing-tasks","id":"sidebar-nav-item-424"}],"id":"sidebar-nav-item-419"},{"title":"Upgrade to Consul dataplane architecture","path":"ecs/upgrade-to-dataplanes","filePath":"../content/docs/ecs/upgrade-to-dataplanes.mdx","fullPath":"/consul/docs/ecs/upgrade-to-dataplanes","id":"sidebar-nav-item-425"},{"title":"Consul Enterprise","path":"ecs/enterprise","filePath":"../content/docs/ecs/enterprise.mdx","fullPath":"/consul/docs/ecs/enterprise","id":"sidebar-nav-item-426"},{"title":"Reference","routes":[{"title":"ECS configuration reference","path":"ecs/reference/configuration-reference","filePath":"../content/docs/ecs/reference/configuration-reference.mdx","fullPath":"/consul/docs/ecs/reference/configuration-reference","id":"sidebar-nav-item-428"},{"title":"ECS compatibility matrix","path":"ecs/reference/compatibility","filePath":"../content/docs/ecs/reference/compatibility.mdx","fullPath":"/consul/docs/ecs/reference/compatibility","id":"sidebar-nav-item-429"},{"title":"ECS Consul server JSON schema","path":"ecs/reference/consul-server-json","filePath":"../content/docs/ecs/reference/consul-server-json.mdx","fullPath":"/consul/docs/ecs/reference/consul-server-json","id":"sidebar-nav-item-430"}],"id":"sidebar-nav-item-427"}],"id":"sidebar-nav-item-415"},{"title":"AWS Lambda","routes":[{"title":"Overview","path":"lambda","filePath":"../content/docs/lambda/index.mdx","fullPath":"/consul/docs/lambda","id":"sidebar-nav-item-432"},{"title":"Register Lambda Functions","routes":[{"title":"Requirements","path":"lambda/registration","filePath":"../content/docs/lambda/registration/index.mdx","fullPath":"/consul/docs/lambda/registration","id":"sidebar-nav-item-434"},{"title":"Automate Registration","path":"lambda/registration/automate","filePath":"../content/docs/lambda/registration/automate.mdx","fullPath":"/consul/docs/lambda/registration/automate","id":"sidebar-nav-item-435"},{"title":"Manual Registration","path":"lambda/registration/manual","filePath":"../content/docs/lambda/registration/manual.mdx","fullPath":"/consul/docs/lambda/registration/manual","id":"sidebar-nav-item-436"}],"id":"sidebar-nav-item-433"},{"title":"Invoke Lambda Functions from Services","path":"lambda/invocation","filePath":"../content/docs/lambda/invocation.mdx","fullPath":"/consul/docs/lambda/invocation","id":"sidebar-nav-item-437"},{"title":"Invoke Services from Lambda Functions","path":"lambda/invoke-from-lambda","badge":{"text":"BETA","type":"outlined","color":"neutral"},"filePath":"../content/docs/lambda/invoke-from-lambda.mdx","fullPath":"/consul/docs/lambda/invoke-from-lambda","id":"sidebar-nav-item-438"}],"id":"sidebar-nav-item-431"},{"divider":true,"id":"sidebar-nav-item-439"},{"title":"HCP Consul","href":"/hcp/docs/consul","id":"sidebar-nav-item-440"},{"title":"Consul Enterprise","routes":[{"title":"Overview","path":"enterprise","filePath":"../content/docs/enterprise/index.mdx","fullPath":"/consul/docs/enterprise","id":"sidebar-nav-item-442"},{"title":"Long Term Support (LTS)","path":"enterprise/long-term-support","filePath":"../content/docs/enterprise/long-term-support.mdx","fullPath":"/consul/docs/enterprise/long-term-support","id":"sidebar-nav-item-443"},{"title":"Admin Partitions","path":"enterprise/admin-partitions","filePath":"../content/docs/enterprise/admin-partitions.mdx","fullPath":"/consul/docs/enterprise/admin-partitions","id":"sidebar-nav-item-444"},{"title":"Audit Logging","path":"enterprise/audit-logging","filePath":"../content/docs/enterprise/audit-logging.mdx","fullPath":"/consul/docs/enterprise/audit-logging","id":"sidebar-nav-item-445"},{"title":"Automated Backups","path":"enterprise/backups","filePath":"../content/docs/enterprise/backups.mdx","fullPath":"/consul/docs/enterprise/backups","id":"sidebar-nav-item-446"},{"title":"Automated Upgrades","path":"enterprise/upgrades","filePath":"../content/docs/enterprise/upgrades.mdx","fullPath":"/consul/docs/enterprise/upgrades","id":"sidebar-nav-item-447"},{"title":"Enhanced Read Scalability","path":"enterprise/read-scale","filePath":"../content/docs/enterprise/read-scale.mdx","fullPath":"/consul/docs/enterprise/read-scale","id":"sidebar-nav-item-448"},{"title":"Fault injection","href":null,"fullPath":"/consul/docs/connect/manage-traffic/fault-injection","id":"sidebar-nav-item-449","path":"/docs/connect/manage-traffic/fault-injection"},{"title":"FIPS","path":"enterprise/fips","filePath":"../content/docs/enterprise/fips.mdx","fullPath":"/consul/docs/enterprise/fips","id":"sidebar-nav-item-450"},{"title":"Single sign-on - OIDC","href":null,"fullPath":"/consul/docs/security/acl/auth-methods/oidc","id":"sidebar-nav-item-451","path":"/docs/security/acl/auth-methods/oidc"},{"title":"Redundancy Zones","path":"enterprise/redundancy","filePath":"../content/docs/enterprise/redundancy.mdx","fullPath":"/consul/docs/enterprise/redundancy","id":"sidebar-nav-item-452"},{"title":"Advanced Federation","path":"enterprise/federation","filePath":"../content/docs/enterprise/federation.mdx","fullPath":"/consul/docs/enterprise/federation","id":"sidebar-nav-item-453"},{"title":"Network Segments","routes":[{"title":"Network Segments Overview","path":"enterprise/network-segments/network-segments-overview","filePath":"../content/docs/enterprise/network-segments/network-segments-overview.mdx","fullPath":"/consul/docs/enterprise/network-segments/network-segments-overview","id":"sidebar-nav-item-455"},{"title":"Create a Network Segment","path":"enterprise/network-segments/create-network-segment","filePath":"../content/docs/enterprise/network-segments/create-network-segment.mdx","fullPath":"/consul/docs/enterprise/network-segments/create-network-segment","id":"sidebar-nav-item-456"}],"id":"sidebar-nav-item-454"},{"title":"Namespaces","path":"enterprise/namespaces","filePath":"../content/docs/enterprise/namespaces.mdx","fullPath":"/consul/docs/enterprise/namespaces","id":"sidebar-nav-item-457"},{"title":"NIA with TFE","href":null,"fullPath":"/consul/docs/nia/enterprise","id":"sidebar-nav-item-458","path":"/docs/nia/enterprise"},{"title":"License","routes":[{"title":"Overview","path":"enterprise/license/overview","filePath":"../content/docs/enterprise/license/overview.mdx","fullPath":"/consul/docs/enterprise/license/overview","id":"sidebar-nav-item-460"},{"title":"Automated entitlement utilization reporting","path":"enterprise/license/utilization-reporting","filePath":"../content/docs/enterprise/license/utilization-reporting.mdx","fullPath":"/consul/docs/enterprise/license/utilization-reporting","id":"sidebar-nav-item-461"},{"title":"FAQ","path":"enterprise/license/faq","filePath":"../content/docs/enterprise/license/faq.mdx","fullPath":"/consul/docs/enterprise/license/faq","id":"sidebar-nav-item-462"}],"id":"sidebar-nav-item-459"},{"title":"Enterprise to CE downgrade","path":"enterprise/ent-to-ce-downgrades","filePath":"../content/docs/enterprise/ent-to-ce-downgrades.mdx","fullPath":"/consul/docs/enterprise/ent-to-ce-downgrades","id":"sidebar-nav-item-463"}],"id":"sidebar-nav-item-441"},{"divider":true,"id":"sidebar-nav-item-464"},{"title":"Network Infrastructure Automation","routes":[{"title":"Overview","path":"nia","filePath":"../content/docs/nia/index.mdx","fullPath":"/consul/docs/nia","id":"sidebar-nav-item-466"},{"title":"Get Started","routes":[{"title":"Installation","path":"nia/installation/install","filePath":"../content/docs/nia/installation/install.mdx","fullPath":"/consul/docs/nia/installation/install","id":"sidebar-nav-item-468"},{"title":"Configuration","path":"nia/installation/configure","filePath":"../content/docs/nia/installation/configure.mdx","fullPath":"/consul/docs/nia/installation/configure","id":"sidebar-nav-item-469"}],"id":"sidebar-nav-item-467"},{"title":"Usage","routes":[{"title":"Requirements","path":"nia/usage/requirements","filePath":"../content/docs/nia/usage/requirements.mdx","fullPath":"/consul/docs/nia/usage/requirements","id":"sidebar-nav-item-471"},{"title":"Run Consul-Terraform-Sync","path":"nia/usage/run","filePath":"../content/docs/nia/usage/run.mdx","fullPath":"/consul/docs/nia/usage/run","id":"sidebar-nav-item-472"},{"title":"Run Consul-Terraform-Sync with High Availability","path":"nia/usage/run-ha","filePath":"../content/docs/nia/usage/run-ha.mdx","fullPath":"/consul/docs/nia/usage/run-ha","id":"sidebar-nav-item-473"},{"title":"Error Messages","path":"nia/usage/errors-ref","filePath":"../content/docs/nia/usage/errors-ref.mdx","fullPath":"/consul/docs/nia/usage/errors-ref","id":"sidebar-nav-item-474"}],"id":"sidebar-nav-item-470"},{"title":"Architecture","path":"nia/architecture","filePath":"../content/docs/nia/architecture.mdx","fullPath":"/consul/docs/nia/architecture","id":"sidebar-nav-item-475"},{"title":"API","routes":[{"title":"Overview","path":"nia/api","filePath":"../content/docs/nia/api/index.mdx","fullPath":"/consul/docs/nia/api","id":"sidebar-nav-item-477"},{"title":"Status","path":"nia/api/status","filePath":"../content/docs/nia/api/status.mdx","fullPath":"/consul/docs/nia/api/status","id":"sidebar-nav-item-478"},{"title":"Tasks","path":"nia/api/tasks","filePath":"../content/docs/nia/api/tasks.mdx","fullPath":"/consul/docs/nia/api/tasks","id":"sidebar-nav-item-479"},{"title":"Health","path":"nia/api/health","filePath":"../content/docs/nia/api/health.mdx","fullPath":"/consul/docs/nia/api/health","id":"sidebar-nav-item-480"}],"id":"sidebar-nav-item-476"},{"title":"CLI","routes":[{"title":"Overview","path":"nia/cli","filePath":"../content/docs/nia/cli/index.mdx","fullPath":"/consul/docs/nia/cli","id":"sidebar-nav-item-482"},{"title":"task","path":"nia/cli/task","filePath":"../content/docs/nia/cli/task.mdx","fullPath":"/consul/docs/nia/cli/task","id":"sidebar-nav-item-483"},{"title":"start","path":"nia/cli/start","filePath":"../content/docs/nia/cli/start.mdx","fullPath":"/consul/docs/nia/cli/start","id":"sidebar-nav-item-484"}],"id":"sidebar-nav-item-481"},{"title":"Configuration","path":"nia/configuration","filePath":"../content/docs/nia/configuration.mdx","fullPath":"/consul/docs/nia/configuration","id":"sidebar-nav-item-485"},{"title":"Tasks","path":"nia/tasks","filePath":"../content/docs/nia/tasks.mdx","fullPath":"/consul/docs/nia/tasks","id":"sidebar-nav-item-486"},{"title":"Terraform Modules","path":"nia/terraform-modules","filePath":"../content/docs/nia/terraform-modules.mdx","fullPath":"/consul/docs/nia/terraform-modules","id":"sidebar-nav-item-487"},{"title":"Enterprise","routes":[{"title":"Overview","path":"nia/enterprise","filePath":"../content/docs/nia/enterprise/index.mdx","fullPath":"/consul/docs/nia/enterprise","id":"sidebar-nav-item-489"},{"title":"License","path":"nia/enterprise/license","filePath":"../content/docs/nia/enterprise/license.mdx","fullPath":"/consul/docs/nia/enterprise/license","id":"sidebar-nav-item-490"},{"title":"HCP Terraform Driver","href":null,"fullPath":"/consul/docs/nia/network-drivers/terraform-cloud","id":"sidebar-nav-item-491","path":"/docs/nia/network-drivers/terraform-cloud"}],"id":"sidebar-nav-item-488"},{"title":"Network Drivers","routes":[{"title":"Overview","path":"nia/network-drivers","filePath":"../content/docs/nia/network-drivers/index.mdx","fullPath":"/consul/docs/nia/network-drivers","id":"sidebar-nav-item-493"},{"title":"Terraform","path":"nia/network-drivers/terraform","filePath":"../content/docs/nia/network-drivers/terraform.mdx","fullPath":"/consul/docs/nia/network-drivers/terraform","id":"sidebar-nav-item-494"},{"title":"HCP Terraform","path":"nia/network-drivers/hcp-terraform","filePath":"../content/docs/nia/network-drivers/hcp-terraform.mdx","fullPath":"/consul/docs/nia/network-drivers/hcp-terraform","id":"sidebar-nav-item-495"}],"id":"sidebar-nav-item-492"},{"title":"Compatibility","path":"nia/compatibility","filePath":"../content/docs/nia/compatibility.mdx","fullPath":"/consul/docs/nia/compatibility","id":"sidebar-nav-item-496"}],"id":"sidebar-nav-item-465"}],"title":"Documentation","visuallyHideTitle":true}],"mainWidth":"narrow","githubFileUrl":"https://github.com/hashicorp/consul/blob/main/website/../content/docs/upgrading/upgrade-specific.mdx"},"metadata":{"title":"Upgrading Specific Versions","description":"Specific versions of Consul may have additional information about the upgrade process beyond the standard flow.","layout":null},"outlineItems":[{"title":"Upgrading Specific Versions","url":"#upgrading-specific-versions","dataHeapTrack":"toc-list-item-index-0"},{"title":"Consul v1.19.x","url":"#consul-v1-19-x","dataHeapTrack":"toc-list-item-index-1"},{"title":"Consul 1.17.x","url":"#consul-1-17-x","dataHeapTrack":"toc-list-item-index-2"},{"title":"Consul 1.16.x","url":"#consul-1-16-x","dataHeapTrack":"toc-list-item-index-3"},{"title":"Consul 1.15.x","url":"#consul-1-15-x","dataHeapTrack":"toc-list-item-index-4"},{"title":"Consul 1.14.x","url":"#consul-1-14-x","dataHeapTrack":"toc-list-item-index-5"},{"title":"Consul 1.13.x","url":"#consul-1-13-x","dataHeapTrack":"toc-list-item-index-6"},{"title":"Consul 1.12.x","url":"#consul-1-12-x","dataHeapTrack":"toc-list-item-index-7"},{"title":"Consul 1.11.x","url":"#consul-1-11-x","dataHeapTrack":"toc-list-item-index-8"},{"title":"Consul 1.10.0","url":"#consul-1-10-0","dataHeapTrack":"toc-list-item-index-9"},{"title":"Consul 1.9.0","url":"#consul-1-9-0","dataHeapTrack":"toc-list-item-index-10"},{"title":"Consul 1.8.0","url":"#consul-1-8-0","dataHeapTrack":"toc-list-item-index-11"},{"title":"Consul 1.7.0","url":"#consul-1-7-0","dataHeapTrack":"toc-list-item-index-12"},{"title":"Consul 1.6.3","url":"#consul-1-6-3","dataHeapTrack":"toc-list-item-index-13"},{"title":"Consul 1.6.0","url":"#consul-1-6-0","dataHeapTrack":"toc-list-item-index-14"},{"title":"Consul 1.4.0","url":"#consul-1-4-0","dataHeapTrack":"toc-list-item-index-15"},{"title":"Consul 1.3.0","url":"#consul-1-3-0","dataHeapTrack":"toc-list-item-index-16"},{"title":"Consul 1.1.0","url":"#consul-1-1-0","dataHeapTrack":"toc-list-item-index-17"},{"title":"Consul 1.0.7","url":"#consul-1-0-7","dataHeapTrack":"toc-list-item-index-18"},{"title":"Consul 1.0.1","url":"#consul-1-0-1","dataHeapTrack":"toc-list-item-index-19"},{"title":"Consul 1.0","url":"#consul-1-0","dataHeapTrack":"toc-list-item-index-20"},{"title":"Consul 0.9.0","url":"#consul-0-9-0","dataHeapTrack":"toc-list-item-index-21"},{"title":"Consul 0.8.0","url":"#consul-0-8-0","dataHeapTrack":"toc-list-item-index-22"},{"title":"Consul 0.7.1","url":"#consul-0-7-1","dataHeapTrack":"toc-list-item-index-23"},{"title":"Consul 0.7","url":"#consul-0-7","dataHeapTrack":"toc-list-item-index-24"},{"title":"Consul 0.6.4","url":"#consul-0-6-4","dataHeapTrack":"toc-list-item-index-25"},{"title":"Consul 0.6","url":"#consul-0-6","dataHeapTrack":"toc-list-item-index-26"},{"title":"Consul 0.5.1","url":"#consul-0-5-1","dataHeapTrack":"toc-list-item-index-27"},{"title":"Consul 0.5","url":"#consul-0-5","dataHeapTrack":"toc-list-item-index-28"}],"pageHeading":{"id":"upgrading-specific-versions","title":"Upgrading Specific Versions"},"mdxSource":{"compiledSource":"const makeShortcode=name=\u003efunction MDXDefaultShortcode(props){console.warn(\"Component \"+name+\" was not imported, exported, or provided by MDXProvider as global scope\");return mdx(\"div\",props)};const CodeBlockConfig=makeShortcode(\"CodeBlockConfig\");const EnterpriseAlert=makeShortcode(\"EnterpriseAlert\");const layoutProps={};const MDXLayout=\"wrapper\";function MDXContent({components,...props}){return mdx(MDXLayout,{...layoutProps,...props,components:components,mdxType:\"MDXLayout\"},mdx(\"p\",null,`The `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/upgrading\"},`upgrading page`),` covers the details of doing a\nstandard upgrade. However, specific versions of Consul may have more details\nprovided for their upgrades as a result of new features or changed behavior.\nThis page is used to document those details separately from the standard\nupgrade flow.`),mdx(\"h2\",{\"id\":\"consul-v1-19-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-v1-19-x\",\"aria-label\":\"consul v1 19 x permalink\"},`\\xbb`),`Consul v1.19.x`),mdx(\"h3\",{\"id\":\"metrics-removal\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#metrics-removal\",\"aria-label\":\"metrics removal permalink\"},`\\xbb`),`Metrics removal`),mdx(\"p\",null,`In previous versions, Consul emitted redundant state store usage metrics that contained two instances of `,mdx(\"inlineCode\",{parentName:\"p\"},`consul`),` in the metric name. As an example, config entry usage counts were emitted as both:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"consul-state-config_entries\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#consul-state-config_entries\",\"aria-label\":\"consul state config_entries permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`consul.state.config_entries`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"consul-consul-state-config_entries\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#consul-consul-state-config_entries\",\"aria-label\":\"consul consul state config_entries permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`consul.consul.state.config_entries`)))),mdx(\"p\",null,`As of Consul v1.19, Consul does not emit the redundant metric with the double `,mdx(\"inlineCode\",{parentName:\"p\"},`consul.consul`),` in its name. Any monitoring alerts and dashboards that you may have utilizing these metrics may require edits to update to the simplified metric name.`),mdx(\"h3\",{\"id\":\"legacy-api-gateway-removal\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#legacy-api-gateway-removal\",\"aria-label\":\"legacy api gateway removal permalink\"},`\\xbb`),`Legacy API Gateway Removal`),mdx(\"p\",null,`The Consul Kubernetes Helm chart stanza\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/v1.16.x/k8s/helm#apigateway-1\"},mdx(\"inlineCode\",{parentName:\"a\"},`.apiGateway`)),`\nis removed in Consul v1.19.0. If using that stanza, migrate to the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/k8s/helm#v-connectinject-apigateway\"},mdx(\"inlineCode\",{parentName:\"a\"},`connectInject.apiGateway`)),`\nstanza before upgrading to Consul v1.19 or later.`),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`.apiGateway`),` stanza is associated with the legacy API gateway that was\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/release-notes/consul/v1_16_x#what-s-deprecated\"},`deprecated in Consul v1.16.0`),`.\nThe Kubernetes-only legacy API gateway is superseded by the modern, multi-runtime\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/api-gateway\"},`API gateway`),`.\nOn Kubernetes, the modern API gateway is associated with the `,mdx(\"inlineCode\",{parentName:\"p\"},`connectInject.apiGateway`),` stanza.`),mdx(\"h2\",{\"id\":\"consul-1-17-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-17-x\",\"aria-label\":\"consul 1 17 x permalink\"},`\\xbb`),`Consul 1.17.x`),mdx(\"h3\",{\"id\":\"known-issues\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#known-issues\",\"aria-label\":\"known issues permalink\"},`\\xbb`),`Known issues`),mdx(\"p\",null,`Consul versions 1.17.2 and 1.16.5 perform excessively strict TLS SAN verification on terminating gateways, which prevents connections outside of the mesh to upstream services. Terminating gateway users are advised to avoid deploying these Consul versions. A fix will be present in a future release of Consul 1.17.3 and 1.16.6 [`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/issues/20360\"},`GH-20360`),`].`),mdx(\"h4\",{\"id\":\"audit-log-naming-changes-enterprise\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#audit-log-naming-changes-enterprise\",\"aria-label\":\"audit log naming changes enterprise permalink\"},`\\xbb`),`Audit Log naming changes (Enterprise)`),mdx(\"p\",null,`Prior to Consul 1.17.0, audit logs contained timestamps on both the original log file names as well as rotated log file names.\nAfter Consul 1.17.0, only timestamps will be included in rotated log file names.`),mdx(\"h4\",{\"id\":\"service-defaults-upstream-config-enterprise\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#service-defaults-upstream-config-enterprise\",\"aria-label\":\"service defaults upstream config enterprise permalink\"},`\\xbb`),`Service-defaults upstream config (Enterprise)`),mdx(\"p\",null,`Prior to Consul v1.17.0, `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/k8s/annotations-and-labels#consul-hashicorp-com-connect-service-upstreams\"},`Kubernetes annotations for upstream services`),`\nthat did not explicitly specify a namespace or partition incorrectly used service-defaults configurations, such as `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-defaults#set-the-default-protocol\"},`default protocol`),`, from the default partition and namespace instead of the local partition and namespace.`),mdx(\"p\",null,`This bug is fixed starting in Consul v1.17.0. Now service-defaults configurations from the local partition and namespace are fetched when not specified in annotations.\nIf you are using non-default partitions and namespaces with Consul-k8s, we recommend explicitly defining these fields for all upstreams in addition to ensuring that accurate\nservice-defaults are configured in each partition and namespace before upgrading. Doing so ensures that no unexpected protocol changes occur during the upgrade.`),mdx(\"h4\",{\"id\":\"acl-tokens-with-templated-policies\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#acl-tokens-with-templated-policies\",\"aria-label\":\"acl tokens with templated policies permalink\"},`\\xbb`),`ACL tokens with templated policies`),mdx(\"p\",null,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/security/acl#templated-policies\"},`ACL templated policies`),` were added to 1.17.0 to simplify obtaining the right permissions for ACL tokens. When performing a `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/datacenter-operations/upgrade-federated-environment#server-rolling-upgrade\"},`rolling upgrade`),` and a version of Consul prior to 1.17.x is presented with a token created Consul v1.17.x or newer that contains templated policies, the templated policies field is not recognized. As a result, the token might not have the expected permissions on the older version of Consul.`),mdx(\"h2\",{\"id\":\"consul-1-16-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-16-x\",\"aria-label\":\"consul 1 16 x permalink\"},`\\xbb`),`Consul 1.16.x`),mdx(\"h3\",{\"id\":\"known-issues-1\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#known-issues-1\",\"aria-label\":\"known issues permalink\"},`\\xbb`),`Known issues`),mdx(\"p\",null,`Consul versions 1.17.2 and 1.16.5 perform excessively strict TLS SAN verification on terminating gateways, which prevents connections outside of the mesh to upstream services. Terminating gateway users are advised to avoid deploying these Consul versions. A fix will be present in a future release of Consul 1.17.3 and 1.16.6 [`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/issues/20360\"},`GH-20360`),`].`),mdx(\"p\",null,`Service mesh in Consul versions 1.16.0 and 1.16.1 may have issues when a snapshot restore is performed and the servers are hosting xDS streams.\nWhen this bug triggers, it causes Envoy to incorrectly populate upstream endpoints. To prevent this issue, service mesh users who run agent-less workloads should upgrade Consul to v1.16.2 or later.`),mdx(\"h4\",{\"id\":\"vault-enterprise-as-ca\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#vault-enterprise-as-ca-1-16\",\"aria-label\":\"vault enterprise as ca permalink\"},`\\xbb`),mdx(\"a\",{parentName:\"h4\",\"className\":\"__target-h __compat\",\"id\":\"vault-enterprise-as-ca-1-16\",\"aria-hidden\":\"true\"}),`Vault Enterprise as CA`),mdx(\"p\",null,`Using Vault as CA with Consul version 1.16.2 will fail to initialize the CA if `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#namespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`namespace`)),` is set\nbut `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#intermediatepkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`intermediate_pki_namespace`)),` or `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#rootpkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`root_pki_namespace`)),`\nare empty. This is a bug which will be fixed in a future version.`),mdx(\"p\",null,`To work around this issue, users must explicitly set `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#intermediatepkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`intermediate_pki_namespace`)),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#rootpkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`root_pki_namespace`)),` to the same value as `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#namespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`namespace`)),`.\nSet your configuration by calling `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/ca#set-config\"},`set-config`),` then use `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/ca#get-config\"},`get-config`),` to check.`),mdx(\"h4\",{\"id\":\"api-health-endpoints-return-different-status-code\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#api-health-endpoints-return-different-status-code\",\"aria-label\":\"api health endpoints return different status code permalink\"},`\\xbb`),`API health endpoints return different status code`),mdx(\"p\",null,`Consul versions 1.16.0+ now return an error 403 \"Permission denied\" status\nwhenever the `,mdx(\"inlineCode\",{parentName:\"p\"},`/v1/health/connect/`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`/v1/health/ingress/`),` endpoints are\nqueried with insufficient ACL `,mdx(\"inlineCode\",{parentName:\"p\"},`service:read`),` privileges.`),mdx(\"p\",null,`In Consul versions older than 1.16.0, the service health API did not return an explicit error when given a token with invalid permissions. Instead, it returned an empty list with a success status code.`),mdx(\"p\",null,`Before upgrading, ensure that all of your applications can handle this new API behavior properly. An update is not required unless you have a custom application that is querying one of these API endpoints directly.`),mdx(\"h4\",{\"id\":\"remove-deprecated-service-defaults-peer-upstream-override-behavior\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#remove-deprecated-service-defaults-peer-upstream-override-behavior\",\"aria-label\":\"remove deprecated service defaults peer upstream override behavior permalink\"},`\\xbb`),`Remove deprecated service-defaults peer upstream override behavior`),mdx(\"p\",null,`When configuring a service defaults configuration entry, the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-defaults#upstreamconfig-overrides\"},mdx(\"inlineCode\",{parentName:\"a\"},`UpstreamConfig.Overrides`),` configuration`),`\ndoes not apply to peer upstreams unless the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-defaults#upstreamconfig-overrides-peer\"},mdx(\"inlineCode\",{parentName:\"a\"},`Peer`)),` field is explicitly provided.\nThis change removes the backward-compatibility behavior introduced in Consul 1.15.x. Refer to the `,mdx(\"a\",{parentName:\"p\",\"href\":\"#service-defaults-overrides-for-upstream-peered-services\"},`upgrade instructions for 1.15.x`),` for more information.`),mdx(\"h2\",{\"id\":\"consul-1-15-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-15-x\",\"aria-label\":\"consul 1 15 x permalink\"},`\\xbb`),`Consul 1.15.x`),mdx(\"h3\",{\"id\":\"service-mesh-compatibility\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#service-mesh-compatibility-1-15\",\"aria-label\":\"service mesh compatibility permalink\"},`\\xbb`),mdx(\"a\",{parentName:\"h3\",\"className\":\"__target-h __compat\",\"id\":\"service-mesh-compatibility-1-15\",\"aria-hidden\":\"true\"}),`Service mesh compatibility`),mdx(\"p\",null,`Upgrade to `,mdx(\"strong\",{parentName:\"p\"},`Consul version 1.15.2 or later`),`.\nIf using `,mdx(\"a\",{parentName:\"p\",\"href\":\"#vault-enterprise-as-ca-1-15\"},`Vault Enterprise as CA`),`, `,mdx(\"strong\",{parentName:\"p\"},`avoid Consul version 1.15.6`),`.`),mdx(\"p\",null,`Consul versions 1.15.0 - 1.15.1 contain a race condition that can cause\nsome service instances to lose their ability to communicate in the mesh after\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/consul#leafcertttl\"},`72 hours (LeafCertTTL)`),`\ndue to a problem with leaf certificate rotation.`),mdx(\"p\",null,`This bug is fixed in Consul versions 1.15.2 and newer.`),mdx(\"h4\",{\"id\":\"vault-enterprise-as-ca-1\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#vault-enterprise-as-ca-1-15\",\"aria-label\":\"vault enterprise as ca permalink\"},`\\xbb`),mdx(\"a\",{parentName:\"h4\",\"className\":\"__target-h __compat\",\"id\":\"vault-enterprise-as-ca-1-15\",\"aria-hidden\":\"true\"}),`Vault Enterprise as CA`),mdx(\"p\",null,`Using Vault as CA with Consul version 1.15.6 will fail to initialize the CA if `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#namespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`namespace`)),` is set\nbut `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#intermediatepkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`intermediate_pki_namespace`)),` or `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#rootpkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`root_pki_namespace`)),`\nare empty. This is a bug which will be fixed in a future version.`),mdx(\"p\",null,`To work around this issue, users must explicitly set `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#intermediatepkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`intermediate_pki_namespace`)),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#rootpkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`root_pki_namespace`)),` to the same value as `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#namespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`namespace`)),`.\nSet your configuration by calling `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/ca#set-config\"},`set-config`),` then use `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/ca#get-config\"},`get-config`),` to check.`),mdx(\"h4\",{\"id\":\"removing-configuration-options\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#removing-configuration-options\",\"aria-label\":\"removing configuration options permalink\"},`\\xbb`),`Removing configuration options`),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`connect.enable_serverless_plugin`),` configuration option was removed. Lambda integration is now enabled by default.`),mdx(\"h4\",{\"id\":\"deprecating-authentication-via-token-query-parameter\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#deprecating-authentication-via-token-query-parameter\",\"aria-label\":\"deprecating authentication via token query parameter permalink\"},`\\xbb`),`Deprecating authentication via token query parameter`),mdx(\"p\",null,`Providing a Consul ACL token in API requests using the `,mdx(\"inlineCode\",{parentName:\"p\"},`token`),` query parameter is deprecated and will be removed in a future Consul version.\nInstead, you should provide the token through the `,mdx(\"inlineCode\",{parentName:\"p\"},`X-Consul-Token`),` header or with the Bearer scheme in the authorization header as described in the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/api-structure#authentication\"},`API authentication documentation`),`.`),mdx(\"p\",null,`Check whether you are using a `,mdx(\"inlineCode\",{parentName:\"p\"},`token`),` query parameter by searching your Consul agent logs for the message:`),mdx(\"pre\",{\"className\":\"language-shell-session\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-shell-session\",\"metastring\":\"hideClipboard\",\"hideClipboard\":true},mdx(\"span\",{parentName:\"code\",\"className\":\"token command\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token shell-symbol important\"},`$`),` `,mdx(\"span\",{parentName:\"span\",\"className\":\"token bash language-bash\"},`This request used the token query parameter `,mdx(\"span\",{parentName:\"span\",\"className\":\"token function\"},`which`),` is deprecated and will be removed `,mdx(\"span\",{parentName:\"span\",\"className\":\"token keyword\"},`in`),` a future Consul version`)),`\n`)),mdx(\"p\",null,`Deprecated authentication using the `,mdx(\"inlineCode\",{parentName:\"p\"},`token`),` query parameter:`),mdx(\"pre\",{\"className\":\"language-shell-session\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-shell-session\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token command\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token shell-symbol important\"},`$`),` `,mdx(\"span\",{parentName:\"span\",\"className\":\"token bash language-bash\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token function\"},`curl`),` `,mdx(\"span\",{parentName:\"span\",\"className\":\"token punctuation\"},`\\\\`))),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token command\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token bash language-bash\"},`    http://127.0.0.1:8500/v1/agent/members?token`,mdx(\"span\",{parentName:\"span\",\"className\":\"token operator\"},`=`))),mdx(\"span\",{parentName:\"code\",\"className\":\"token output\"},`\u003cconsul token\u003e`),`\n`)),mdx(\"p\",null,`Recommended authentication method:`),mdx(\"pre\",{\"className\":\"language-shell-session\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-shell-session\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token command\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token shell-symbol important\"},`$`),` `,mdx(\"span\",{parentName:\"span\",\"className\":\"token bash language-bash\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token function\"},`curl`),` `,mdx(\"span\",{parentName:\"span\",\"className\":\"token punctuation\"},`\\\\`))),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token command\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token bash language-bash\"},`    --header `,mdx(\"span\",{parentName:\"span\",\"className\":\"token string\"},`\"X-Consul-Token: \u003cconsul token\u003e\"`),` `,mdx(\"span\",{parentName:\"span\",\"className\":\"token punctuation\"},`\\\\`))),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token command\"},mdx(\"span\",{parentName:\"span\",\"className\":\"token bash language-bash\"},`    http://127.0.0.1:8500/v1/agent/members`)),`\n`)),mdx(\"h4\",{\"id\":\"lambda-configuration\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#lambda-configuration\",\"aria-label\":\"lambda configuration permalink\"},`\\xbb`),`Lambda Configuration`),mdx(\"p\",null,`Instead of configuring Lambda functions in the `,mdx(\"inlineCode\",{parentName:\"p\"},`Meta`),` field of `,mdx(\"inlineCode\",{parentName:\"p\"},`service-defaults`),` configuration entries, configure them with the `,mdx(\"inlineCode\",{parentName:\"p\"},`EnvoyExtensions`),` field.`),mdx(\"p\",null,`Before Consul v1.15:`),mdx(CodeBlockConfig,{filename:\"lambda-service-defaults.hcl\",mdxType:\"CodeBlockConfig\"},mdx(\"pre\",{\"className\":\"language-hcl\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-hcl\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Kind`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"service-defaults\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"\u003cSERVICE_NAME\u003e\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Protocol`),`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"http\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Meta`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"serverless.consul.hashicorp.com/v1alpha1/lambda/enabled\"`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"true\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`))),mdx(\"p\",null,`In Consul v1.15 and higher:`),mdx(CodeBlockConfig,{filename:\"lambda-service-defaults.hcl\",mdxType:\"CodeBlockConfig\"},mdx(\"pre\",{\"className\":\"language-hcl\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-hcl\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Kind`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"service-defaults\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"\u003cSERVICE_NAME\u003e\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Protocol`),`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"http\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`EnvoyExtensions`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`[`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"Name\"`),`: `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"builtin/aws/lambda\"`),`,`,`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"Arguments\"`),`: `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"Region\"`),`: `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"us-east-2\"`),`,`,`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"ARN\"`),`: `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"\u003cINSERT ARN HERE\u003e\"`),`,`,`\n`,`      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"PayloadPassthrough\"`),`: `,mdx(\"span\",{parentName:\"code\",\"className\":\"token boolean\"},`true`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`]`),`\n`))),mdx(\"h4\",{\"id\":\"service-defaults-overrides-for-upstream-peered-services\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#service-defaults-overrides-for-upstream-peered-services\",\"aria-label\":\"service defaults overrides for upstream peered services permalink\"},`\\xbb`),mdx(\"inlineCode\",{parentName:\"h4\"},`service-defaults`),` Overrides for Upstream Peered Services`),mdx(\"p\",null,`In Consul 1.14.x, `,mdx(\"inlineCode\",{parentName:\"p\"},`service-defaults`),` upstream `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-defaults#overrides\"},mdx(\"inlineCode\",{parentName:\"a\"},`overrides`)),` apply to both local and peered services as long as the `,mdx(\"inlineCode\",{parentName:\"p\"},`name`),` field matches.\nConsul 1.15.0 is backward compatible with 1.14 if the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-defaults#peer\"},mdx(\"inlineCode\",{parentName:\"a\"},`peer`)),` is not set in any override.\nWe recommend converting any upstream peer service overrides as a 1.15.x post-upgrade step.`),mdx(\"p\",null,`Before Consul v1.15:`),mdx(CodeBlockConfig,{mdxType:\"CodeBlockConfig\"},mdx(\"pre\",{\"className\":\"language-hcl\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-hcl\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Kind`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"service-defaults\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"\u003cSERVICE_NAME\u003e\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Protocol`),`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"http\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`UpstreamConfig`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Overrides`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`[`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`       `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` foo      `,mdx(\"span\",{parentName:\"code\",\"className\":\"token comment\"},`# Applies to local \\`foo\\` and any peered service \\`foo\\``),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`]`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`))),mdx(\"p\",null,`In Consul v1.15 and higher:`),mdx(CodeBlockConfig,{mdxType:\"CodeBlockConfig\"},mdx(\"pre\",{\"className\":\"language-hcl\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-hcl\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Kind`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"service-defaults\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"\u003cSERVICE_NAME\u003e\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Protocol`),`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token string\"},`\"http\"`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`UpstreamConfig`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Overrides`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`[`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`       `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` foo  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token comment\"},`# Applies to local service \\`foo\\``),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`,`,`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`       `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Name`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` foo  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token comment\"},`# Applies to \\`foo\\` imported from peered cluster \\`bar\\``),`\n`,`       `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`Peer`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`=`),` bar`,`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`]`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`))),mdx(\"h2\",{\"id\":\"consul-1-14-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-14-x\",\"aria-label\":\"consul 1 14 x permalink\"},`\\xbb`),`Consul 1.14.x`),mdx(\"h3\",{\"id\":\"service-mesh-compatibility-1\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#service-mesh-compatibility-1\",\"aria-label\":\"service mesh compatibility permalink\"},`\\xbb`),`Service Mesh Compatibility`),mdx(\"p\",null,`Prior to Consul 1.14, cluster peering and Consul service mesh were disabled by default.\nA breaking change was made in Consul 1.14 that:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/connect/cluster-peering\"},`Cluster Peering is enabled by default.`),`\nCluster peering and WAN federation can coexist,\nso there is no need to disable cluster peering to upgrade existing WAN federated datacenters.\nTo disable cluster peering nonetheless, set `,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#peering_enabled\"},mdx(\"inlineCode\",{parentName:\"a\"},`peering.enabled`)),` to `,mdx(\"inlineCode\",{parentName:\"li\"},`false`),`.`),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/connect\"},`Consul service mesh is enabled by default.`),`\nTo disable, set `,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#connect_enabled\"},mdx(\"inlineCode\",{parentName:\"a\"},`connect.enabled`)),` to `,mdx(\"inlineCode\",{parentName:\"li\"},`false`),`.`)),mdx(\"p\",null,`The changes to Consul service mesh in version 1.14 are incompatible with Nomad 1.4.3 and\nearlier. If you operate Consul service mesh using Nomad 1.4.3 or earlier, do not upgrade to\nConsul 1.14 until `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/nomad/issues/15266\"},`hashicorp/nomad#15266`),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/nomad/issues/15360\"},`hashicorp/nomad#15360`),` have been fixed.`),mdx(\"p\",null,`For 1.14.0, there is a known issue with `,mdx(\"inlineCode\",{parentName:\"p\"},`consul connect envoy`),`. If the command is configured\nto use TLS for contacting the HTTP API, it will also incorrectly enable TLS for gRPC.\nUsers should not upgrade to 1.14.0 if they are using plaintext gRPC connections in\nconjunction with TLS-encrypted HTTP APIs.`),mdx(\"h4\",{\"id\":\"vault-enterprise-as-ca-2\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#vault-enterprise-as-ca-1-14\",\"aria-label\":\"vault enterprise as ca permalink\"},`\\xbb`),mdx(\"a\",{parentName:\"h4\",\"className\":\"__target-h __compat\",\"id\":\"vault-enterprise-as-ca-1-14\",\"aria-hidden\":\"true\"}),`Vault Enterprise as CA`),mdx(\"p\",null,`Using Vault as CA with Consul version 1.14.10 will fail to initialize the CA if `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#namespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`namespace`)),` is set\nbut `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#intermediatepkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`intermediate_pki_namespace`)),` or `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#rootpkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`root_pki_namespace`)),`\nare empty. This is a bug which will be fixed in a future version.`),mdx(\"p\",null,`To work around this issue, users must explicitly set `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#intermediatepkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`intermediate_pki_namespace`)),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#rootpkinamespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`root_pki_namespace`)),` to the same value as `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#namespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`namespace`)),`.\nSet your configuration by calling `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/ca#set-config\"},`set-config`),` then use `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/ca#get-config\"},`get-config`),` to check.`),mdx(\"h4\",{\"id\":\"changes-to-grpc-tls-configuration\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#changes-to-grpc-tls-configuration\",\"aria-label\":\"changes to grpc tls configuration permalink\"},`\\xbb`),`Changes to gRPC TLS configuration`),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},`Make configuration changes`),` if using `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#grpc_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports.grpc`)),` in conjunction with any of the following settings that enables encryption:`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#tls_grpc\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.grpc`))),mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#tls_defaults\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.defaults`))),mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#auto_encrypt\"},mdx(\"inlineCode\",{parentName:\"a\"},`auto_encrypt`))),mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#auto_config\"},mdx(\"inlineCode\",{parentName:\"a\"},`auto_config`)))),mdx(\"p\",null,`Prior to Consul 1.14, it was possible to encrypt communication between Consul and Envoy over `,mdx(\"inlineCode\",{parentName:\"p\"},`ports.grpc`),` using these settings.`),mdx(\"p\",null,`Consul 1.14 introduces `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#grpc_tls_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports.grpc_tls`)),`, a new configuration\nfor encrypting communication over gRPC. The existing `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#grpc_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports.grpc`)),` configuration `,mdx(\"strong\",{parentName:\"p\"},`no longer supports encryption`),`. As of version 1.14,\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#grpc_tls_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports.grpc_tls`)),` is the only port that serves encrypted gRPC traffic.\nThe default value for the gRPC TLS port is 8503 for Consul servers. To disable the gRPC TLS port, use value -1.`),mdx(\"p\",null,`If you already use gRPC encryption, change the following fields to ensure compatibility:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`Change `,mdx(\"inlineCode\",{parentName:\"li\"},`ports.grpc`),` to `,mdx(\"inlineCode\",{parentName:\"li\"},`ports.grpc_tls`),`. Refer to the `,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#grpc_tls_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`grpc_tls_port`),` documentation`),` for details.`),mdx(\"li\",{parentName:\"ul\"},`Change `,mdx(\"inlineCode\",{parentName:\"li\"},`addresses.grpc`),` to `,mdx(\"inlineCode\",{parentName:\"li\"},`addresses.grpc_tls`),`. Refer to the `,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#grpc_tls\"},mdx(\"inlineCode\",{parentName:\"a\"},`grpc_tls`),` documentation`),` for details.`),mdx(\"li\",{parentName:\"ul\"},`Update `,mdx(\"inlineCode\",{parentName:\"li\"},`consul connect envoy`),` command invocations to specify gRPC CA certificates with one of the new configuration options:\n`,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/commands/connect/envoy#grpc-ca-file\"},mdx(\"inlineCode\",{parentName:\"a\"},`-grpc-ca-file`)),` or\n`,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/commands/connect/envoy#grpc-ca-path\"},mdx(\"inlineCode\",{parentName:\"a\"},`-grpc-ca-path`)),`\n(or their corresponding environment variables).`)),mdx(\"h4\",{\"id\":\"changes-to-peering\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#changes-to-peering\",\"aria-label\":\"changes to peering permalink\"},`\\xbb`),`Changes to peering`),mdx(\"p\",null,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/cluster-peering\"},`Cluster peering`),` was released in Consul 1.13 as an experimental feature.\nIn Consul 1.14, cluster peering has been improved and is now considered stable. All experimental peering\nconnections created by 1.13 should be\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/cluster-peering/usage/manage-connections#delete-peering-connections\"},`deleted`),`\nprior to upgrading, as they will no longer be compatible with 1.14.`),mdx(\"h2\",{\"id\":\"consul-1-13-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-13-x\",\"aria-label\":\"consul 1 13 x permalink\"},`\\xbb`),`Consul 1.13.x`),mdx(\"h3\",{\"id\":\"service-mesh-compatibility-2\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#service-mesh-compatibility-2\",\"aria-label\":\"service mesh compatibility permalink\"},`\\xbb`),`Service Mesh Compatibility`),mdx(\"p\",null,`Before upgrading existing Consul deployments using service mesh to Consul 1.13.x,\nreview the following guidances relevant to your deployment:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"#all-service-mesh-deployments\"},`All service mesh deployments`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"#service-mesh-deployments-using-auto-encrypt-or-auto-config\"},`Service mesh deployments using auto-encrypt or auto-config`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"#service-mesh-deployments-without-the-https-port-enabled-on-consul-agents\"},`Service mesh deployments without the HTTPS port enabled on Consul agents`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"#modify-vault-policy-for-vault-ca-provider\"},`All service mesh deployments using the Vault CA provider`))),mdx(\"h4\",{\"id\":\"all-service-mesh-deployments\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#all-service-mesh-deployments\",\"aria-label\":\"all service mesh deployments permalink\"},`\\xbb`),`All service mesh deployments`),mdx(\"p\",null,`Upgrade to `,mdx(\"strong\",{parentName:\"p\"},`Consul version 1.13.1 or later`),`.`),mdx(\"p\",null,`Consul 1.13.0 contains a bug that prevents Consul server agents from restoring\nsaved state on startup if the state`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},`was generated before Consul 1.13 (such as during an upgrade), and`),mdx(\"li\",{parentName:\"ol\"},`contained any service mesh proxy registrations.`)),mdx(\"p\",null,`This bug is fixed in Consul versions 1.13.1 and newer.`),mdx(\"h4\",{\"id\":\"service-mesh-deployments-using-auto-encrypt-or-auto-config\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#service-mesh-deployments-using-auto-encrypt-or-auto-config\",\"aria-label\":\"service mesh deployments using auto encrypt or auto config permalink\"},`\\xbb`),`Service mesh deployments using auto-encrypt or auto-config`),mdx(\"p\",null,`Upgrade to `,mdx(\"strong\",{parentName:\"p\"},`Consul version 1.13.2 or later`),` if using\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#auto_encrypt\"},`auto-encrypt`),` or\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#auto_config\"},`auto-config`),`.`),mdx(\"p\",null,`In Consul 1.13.0 - 1.13.1, auto-encrypt and auto-config both cause Consul\nto require TLS for gRPC communication with Envoy proxies.\nIn environments where Envoy proxies are not already configured\nto use TLS for gRPC, upgrading to Consul 1.13.0 - 1.13.1 will cause\nEnvoy proxies to disconnect from the control plane (Consul agents).`),mdx(\"p\",null,`If upgrading to version 1.13.2 or later, you must enable\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#use_auto_cert\"},`tls.grpc.use_auto_cert`),`\nif you currently rely on Consul agents presenting the auto-encrypt or\nauto-config certs as the TLS server certs on the gRPC port.\nThe new `,mdx(\"inlineCode\",{parentName:\"p\"},`use_auto_cert`),` flag enables TLS for gRPC based on the presence\nof auto-encrypt certs.`),mdx(\"h4\",{\"id\":\"service-mesh-deployments-without-the-https-port-enabled-on-consul-agents\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#grpc-tls\",\"aria-label\":\"service mesh deployments without the https port enabled on consul agents permalink\"},`\\xbb`),mdx(\"a\",{parentName:\"h4\",\"className\":\"__target-h __compat\",\"id\":\"grpc-tls\",\"aria-hidden\":\"true\"}),`Service mesh deployments without the HTTPS port enabled on Consul agents`),mdx(\"p\",null,`If the HTTPS port is not enabled\n(`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#https_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports { https = POSITIVE_INTEGER }`)),`)\non a pre-1.13 Consul agent,\n`,mdx(\"strong\",{parentName:\"p\"},mdx(\"a\",{parentName:\"strong\",\"href\":\"#modify-the-consul-agent-s-tls-configuration\"},`modify the agent's TLS configuration before upgrading`)),`\nto avoid Envoy proxies disconnecting from the control plane (Consul agents).\nEnvoy proxies include service mesh sidecars and gateways.`),mdx(\"h5\",{\"id\":\"changes-to-grpc-and-http-interface-configuration\"},mdx(\"a\",{parentName:\"h5\",\"className\":\"__permalink-h\",\"href\":\"#changes-to-grpc-and-http-interface-configuration\",\"aria-label\":\"changes to grpc and http interface configuration permalink\"},`\\xbb`),`Changes to gRPC and HTTP interface configuration`),mdx(\"p\",null,`If a Consul agent's HTTP API is exposed externally,\nenabling HTTPS (TLS encryption for HTTP) is important.`),mdx(\"p\",null,`The gRPC interface is used for xDS communication between Consul and\nEnvoy proxies when using Consul service mesh.\nA Consul agent's gRPC traffic is often loopback-only,\nwhich TLS encryption is not important for.`),mdx(\"p\",null,`Prior to Consul 1.13, if `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#https_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports { https = POSITIVE_INTEGER }`)),`\nwas configured, TLS was enabled for both HTTP `,mdx(\"em\",{parentName:\"p\"},`and`),` gRPC.\nThis was inconvenient for deployments that\nneeded TLS for HTTP, but not for gRPC.\nEnabling HTTPS also required launching Envoy proxies\nwith the necessary TLS material for xDS communication\nwith its Consul agent via TLS over gRPC.`),mdx(\"p\",null,`Consul 1.13 addresses this inconvenience by fully decoupling the TLS configuration for HTTP and gRPC interfaces.\nTLS for gRPC is no longer enabled by setting\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#https_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports { https = POSITIVE_INTEGER }`)),`.\nTLS configuration for gRPC is now determined exclusively by:`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#tls_grpc\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.grpc`)),`, which overrides`),mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#tls_defaults\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.defaults`)),`, which overrides`),mdx(\"li\",{parentName:\"ol\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#tls_deprecated_options\"},`Deprecated TLS options`),` such as\n`,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#ca_file-4\"},mdx(\"inlineCode\",{parentName:\"a\"},`ca_file`)),`,\n`,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#cert_file-4\"},mdx(\"inlineCode\",{parentName:\"a\"},`cert_file`)),`, and\n`,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#key_file-4\"},mdx(\"inlineCode\",{parentName:\"a\"},`key_file`)),`.`)),mdx(\"p\",null,`This decoupling has a side effect that requires a\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"#modify-the-consul-agent-s-tls-configuration\"},`TLS configuration change`),`\nfor pre-1.13 agents without the HTTPS port enabled.\nWithout a TLS configuration change,\nConsul 1.13 agents may now expect gRPC `,mdx(\"em\",{parentName:\"p\"},`with`),` TLS,\ncausing communication to fail with Envoy proxies\nthat continue to use gRPC `,mdx(\"em\",{parentName:\"p\"},`without`),` TLS.`),mdx(\"h5\",{\"id\":\"modify-the-consul-agent-s-tls-configuration\"},mdx(\"a\",{parentName:\"h5\",\"className\":\"__permalink-h\",\"href\":\"#modify-the-consul-agent-s-tls-configuration\",\"aria-label\":\"modify the consul agent s tls configuration permalink\"},`\\xbb`),`Modify the Consul agent's TLS configuration`),mdx(\"p\",null,`If `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls_grpc\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.grpc`)),`,\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls_defaults\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.defaults`)),`,\nor the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls_deprecated_options\"},`deprecated TLS options`),`\ndefine TLS material in their\n`,mdx(\"inlineCode\",{parentName:\"p\"},`ca_file`),`, `,mdx(\"inlineCode\",{parentName:\"p\"},`ca_path`),`, `,mdx(\"inlineCode\",{parentName:\"p\"},`cert_file`),`, or `,mdx(\"inlineCode\",{parentName:\"p\"},`key_file`),` fields,\nTLS for gRPC will be enabled in Consul 1.13, even if\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#https_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports { https = POSITIVE_INTEGER }`)),`\nis not set.`),mdx(\"p\",null,`This will cause Envoy proxies to disconnect from the control plane\nafter upgrading to Consul 1.13 if associated pre-1.13 Consul agents\nhave `,mdx(\"strong\",{parentName:\"p\"},`not`),` set\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#https_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports { https = POSITIVE_INTEGER }`)),`.\nTo avoid this problem, make the following agent configuration changes:`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Remove TLS material from the Consul agents'\ninterface-generic TLS configuration options:\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls_grpc\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.defaults`)),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls_deprecated_options\"},`deprecated TLS options`))),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Reapply TLS material to the non-gRPC interfaces that need it with the\ninterface-specific TLS configuration stanzas\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/upgrading/upgrade-specific#tls-configuration\"},`introduced in Consul 1.12`),`:\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls_https\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.https`)),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls_internal_rpc\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls.internal_rpc`)),`.`),mdx(\"p\",{parentName:\"li\"},`If upgrading directly from pre-1.12 Consul,\nthe above configuration change cannot be made before upgrading.\nTherefore, consider upgrading agents to Consul 1.12 before upgrading to 1.13.`))),mdx(\"p\",null,`If pre-1.13 Consul agents have set\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#https_port\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports { https = POSITIVE_INTEGER }`)),`,\nthis configuration change is not required to upgrade.\nThat setting means the pre-1.13 Consul agent requires TLS for gRPC `,mdx(\"em\",{parentName:\"p\"},`already`),`,\nand will continue to do so after upgrading to 1.13.\nIf your pre-1.13 service mesh is working, you have already\nconfigured your Envoy proxies to use TLS for gRPC when bootstrapping Envoy\nvia `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/envoy\"},mdx(\"inlineCode\",{parentName:\"a\"},`consul connect envoy`)),`,\nsuch as with flags or environment variables like\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/envoy#ca-file\"},mdx(\"inlineCode\",{parentName:\"a\"},`-ca-file`)),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands#consul_cacert\"},mdx(\"inlineCode\",{parentName:\"a\"},`CONSUL_CACERT`)),`.`),mdx(\"h4\",{\"id\":\"modify-vault-policy-for-vault-ca-provider\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#modify-vault-policy-for-vault-ca-provider\",\"aria-label\":\"modify vault policy for vault ca provider permalink\"},`\\xbb`),`Modify Vault policy for Vault CA provider`),mdx(\"p\",null,`If using the Vault CA provider,\nmodify the Vault policy used by Consul to interact with Vault\nto ensure that certificates required for service mesh operation can still be generated.\nThe policy must include the `,mdx(\"inlineCode\",{parentName:\"p\"},`update`),` capability on the intermediate PKI's tune mount configuration endpoint\nat path `,mdx(\"inlineCode\",{parentName:\"p\"},`/sys/mounts/\u003cintermediate_pki_mount_name\u003e/tune`),`.\nRefer to the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/ca/vault#vault-acl-policies\"},`Vault CA provider documentation`),`\nfor updated example Vault policies for use with Vault-managed or Consul-managed PKI paths.`),mdx(\"p\",null,`You are using the Vault CA provider if either of the following configurations exists:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`The Consul server agent configuration option `,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#connect_ca_provider\"},mdx(\"inlineCode\",{parentName:\"a\"},`connect.ca_provider`)),` is set to `,mdx(\"inlineCode\",{parentName:\"li\"},`vault`),`, or`),mdx(\"li\",{parentName:\"ul\"},`The Consul on Kubernetes Helm Chart `,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/k8s/helm#v-global-secretsbackend-vault-connectca\"},mdx(\"inlineCode\",{parentName:\"a\"},`global.secretsBackend.vault.connectCA`)),` value is configured.`)),mdx(\"p\",null,`Though this guidance is listed in the 1.13.x section, it applies to several release series.\nAffected Consul versions contain a\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/pull/14516\"},`bugfix that allows the intermediate CA's TTL configuration to be modified`),`.\nThe bugfix requires the `,mdx(\"inlineCode\",{parentName:\"p\"},`update`),` capability to tune that configuration.\nWithout the `,mdx(\"inlineCode\",{parentName:\"p\"},`update`),` capability, the Consul versions listed in the `,mdx(\"em\",{parentName:\"p\"},`breaking change`),` column\ncannot provide services with the certificates they need to participate in the mesh.\nThe Consul versions in the `,mdx(\"em\",{parentName:\"p\"},`recommended versions`),` column restore the intermediate CA's ability\nto provide certificates even without the `,mdx(\"inlineCode\",{parentName:\"p\"},`update`),` capability on the tune configuration endpoint,\nthough the `,mdx(\"inlineCode\",{parentName:\"p\"},`update`),` capability will still be needed to modify the CA's TTL configuration.`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",{parentName:\"tr\",\"align\":null},`Release Series`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Versions with breaking change`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Recommended versions`))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`Consul 1.13.x`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.13.2`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.13.3 or later`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`Consul 1.12.x`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.12.5`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.12.6 or later`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`Consul 1.11.x`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.11.9 - 1.11.10`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.11.11 or later`)))),mdx(\"p\",null,`As a precaution, we recommend both modifying the Vault policy\nand upgrading to a recommended version as a double protection\nto ensure the operation of your service mesh and to enable CA TTL modification.`),mdx(\"h3\",{\"id\":\"1-9-telemetry-compatibility\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#1-9-telemetry-compatibility\",\"aria-label\":\"1 9 telemetry compatibility permalink\"},`\\xbb`),`1.9 Telemetry Compatibility`),mdx(\"h4\",{\"id\":\"removing-configuration-options-1\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#removing-configuration-options-1\",\"aria-label\":\"removing configuration options permalink\"},`\\xbb`),`Removing configuration options`),mdx(\"p\",null,`The `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-disable_compat_1.9\"},mdx(\"inlineCode\",{parentName:\"a\"},`disable_compat_19`)),` telemetry configuration option is now removed.\nIn prior Consul versions (1.10.x through 1.11.x), the config defaulted to `,mdx(\"inlineCode\",{parentName:\"p\"},`false`),`. In 1.12.x it defaulted to `,mdx(\"inlineCode\",{parentName:\"p\"},`true`),`.\nIf you were using this flag, you must remove it before upgrading.`),mdx(\"h3\",{\"id\":\"modify-vault-policy-for-vault-ca-provider-1\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#modify-vault-policy-for-vault-ca-provider-1\",\"aria-label\":\"modify vault policy for vault ca provider permalink\"},`\\xbb`),`Modify Vault Policy for Vault CA Provider`),mdx(\"p\",null,`Follow the same guidance as provided in the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"#modify-vault-policy-for-vault-ca-provider\"},`1.13 upgrade section for modifying the Vault policy if using the Vault CA provider`),`.\nA breaking change was made in Consul 1.13.2 that impacts service mesh operation\nif the Vault policy is not modified as described.\nAs a precaution, we recommend both modifying the Vault policy and upgrading\nto Consul 1.13.3 or later to avoid the breaking nature of that change.`),mdx(\"h3\",{\"id\":\"nomad-incompatibility\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#nomad-incompatibility\",\"aria-label\":\"nomad incompatibility permalink\"},`\\xbb`),`Nomad Incompatibility`),mdx(\"p\",null,`Nomad users should not upgrade to Consul v1.13.8. An API change in this Consul\nrelease prevents Nomad from correctly detecting the Consul agent version. As a\nresult, allocations are not placed in clients running v1.13.8.`),mdx(\"h2\",{\"id\":\"consul-1-12-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-12-0\",\"aria-label\":\"consul 1 12 x permalink\"},`\\xbb`),mdx(\"a\",{parentName:\"h2\",\"className\":\"__target-h __compat\",\"id\":\"consul-1-12-0\",\"aria-hidden\":\"true\"}),`Consul 1.12.x`),mdx(\"h3\",{\"id\":\"modify-vault-policy-for-vault-ca-provider-2\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#modify-vault-policy-for-vault-ca-provider-2\",\"aria-label\":\"modify vault policy for vault ca provider permalink\"},`\\xbb`),`Modify Vault Policy for Vault CA Provider`),mdx(\"p\",null,`Follow the same guidance as provided in the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"#modify-vault-policy-for-vault-ca-provider\"},`1.13 upgrade section for modifying the Vault policy if using the Vault CA provider`),`.\nA breaking change was made in Consul 1.12.5 that impacts service mesh operation\nif the Vault policy is not modified as described.\nAs a precaution, we recommend both modifying the Vault policy and upgrading\nto Consul 1.12.6 or later to avoid the breaking nature of that change.`),mdx(\"h3\",{\"id\":\"1-9-telemetry-compatibility-1\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#1-9-telemetry-compatibility-1\",\"aria-label\":\"1 9 telemetry compatibility permalink\"},`\\xbb`),`1.9 Telemetry Compatibility`),mdx(\"h4\",{\"id\":\"changing-the-default-behavior-for-option\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#changing-the-default-behavior-for-option\",\"aria-label\":\"changing the default behavior for option permalink\"},`\\xbb`),`Changing the default behavior for option`),mdx(\"p\",null,`The `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-disable_compat_1.9\"},mdx(\"inlineCode\",{parentName:\"a\"},`disable_compat_19`)),` telemetry configuration option now defaults\nto `,mdx(\"inlineCode\",{parentName:\"p\"},`true`),`. In prior Consul versions (1.10.x through 1.11.x), the config defaulted to `,mdx(\"inlineCode\",{parentName:\"p\"},`false`),`. If you require 1.9 style\n`,mdx(\"inlineCode\",{parentName:\"p\"},`consul.http...`),` metrics, you may enable them by setting the flag to `,mdx(\"inlineCode\",{parentName:\"p\"},`false`),`. However, be advised that these metrics, as\nwell as the flag will be removed in upcoming Consul 1.13. We recommend changing your instrumentation to use 1.10 and later\nstyle `,mdx(\"inlineCode\",{parentName:\"p\"},`consul.api.http...`),` metrics and removing the configuration flag from your setup.`),mdx(\"h3\",{\"id\":\"nomad-namespace-incompatibility\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#nomad-namespace-incompatibility\",\"aria-label\":\"nomad namespace incompatibility permalink\"},`\\xbb`),`Nomad Namespace Incompatibility`),mdx(\"p\",null,`Nomad Enterprise users should not upgrade to Consul Enterprise 1.12.0, and instead should upgrade to 1.12.1 or later.`),mdx(\"p\",null,`Consul 1.12.0 Enterprise introduced a change that prevents Nomad Enterprise from removing services from non-default Consul namespaces.`),mdx(\"p\",null,`The Consul Enterprise codebase was updated with a fix for this issue in version 1.12.1.`),mdx(\"h3\",{\"id\":\"tls-configuration\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#tls-configuration\",\"aria-label\":\"tls configuration permalink\"},`\\xbb`),`TLS Configuration`),mdx(\"p\",null,`You can now configure TLS differently for each of Consul's exposed ports. As a\nresult, the following top-level configuration fields are deprecated and should\nbe replaced with the new `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#tls-configuration-reference\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls`),` stanza`),`:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"cert_file\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#cert_file\",\"aria-label\":\"cert_file permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`cert_file`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"key_file\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#key_file\",\"aria-label\":\"key_file permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`key_file`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"ca_file\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#ca_file\",\"aria-label\":\"ca_file permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`ca_file`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"ca_path\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#ca_path\",\"aria-label\":\"ca_path permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`ca_path`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"tls_min_version\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#tls_min_version\",\"aria-label\":\"tls_min_version permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls_min_version`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"tls_cipher_suites\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#tls_cipher_suites\",\"aria-label\":\"tls_cipher_suites permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls_cipher_suites`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"verify_incoming\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#verify_incoming\",\"aria-label\":\"verify_incoming permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`verify_incoming`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"verify_incoming_rpc\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#verify_incoming_rpc\",\"aria-label\":\"verify_incoming_rpc permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`verify_incoming_rpc`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"verify_incoming_https\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#verify_incoming_https\",\"aria-label\":\"verify_incoming_https permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`verify_incoming_https`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"verify_outgoing\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#verify_outgoing\",\"aria-label\":\"verify_outgoing permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`verify_outgoing`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"verify_server_hostname\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#verify_server_hostname\",\"aria-label\":\"verify_server_hostname permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`verify_server_hostname`)))),mdx(\"h2\",{\"id\":\"consul-1-11-x\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-11-0\",\"aria-label\":\"consul 1 11 x permalink\"},`\\xbb`),mdx(\"a\",{parentName:\"h2\",\"className\":\"__target-h __compat\",\"id\":\"consul-1-11-0\",\"aria-hidden\":\"true\"}),`Consul 1.11.x`),mdx(\"h3\",{\"id\":\"1-10-compatibility\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#1-10-compatibility\",\"aria-label\":\"1 10 compatibility permalink\"},`\\xbb`),`1.10 Compatibility `,mdx(EnterpriseAlert,{inline:true,mdxType:\"EnterpriseAlert\"})),mdx(\"p\",null,`Consul Enterprise versions 1.10.0 through 1.10.4 contain a latent bug that\ncauses those client or server agents to deregister their own services or health\nchecks when some of the servers have been upgraded to 1.11 or later.\nBefore upgrading Consul Enterprise servers to 1.11 or later,\nyou should first upgrade all Consul client and server agents to 1.10.7 or higher\nto ensure forward compatibility and prevent flapping of catalog registrations.`),mdx(\"h3\",{\"id\":\"deprecated-agent-config-options\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#deprecated-agent-config-options\",\"aria-label\":\"deprecated agent config options permalink\"},`\\xbb`),`Deprecated Agent Config Options`),mdx(\"p\",null,`Consul 1.11.0 is compiled with Go 1.17 and now the ordering of\n`,mdx(\"inlineCode\",{parentName:\"p\"},`tls_cipher_suites`),` will no longer be honored. Additionally\n`,mdx(\"inlineCode\",{parentName:\"p\"},`tls_prefer_server_cipher_suites`),` is now ignored.`),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`master`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`agent_master`),` ACL tokens in the `,mdx(\"inlineCode\",{parentName:\"p\"},`acl.tokens`),` config block\nhave been renamed to `,mdx(\"inlineCode\",{parentName:\"p\"},`initial_management`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`agent_recovery`),` respectively.\nThe old names have been deprecated and will be removed at a future date.`),mdx(\"p\",null,`Due to this rename the following endpoint is also deprecated:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/api-docs/agent#update-acl-tokens\"},mdx(\"inlineCode\",{parentName:\"a\"},`PUT /v1/agent/token/agent_master`)))),mdx(\"h3\",{\"id\":\"deprecated-agent-config-options-1\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#deprecated-agent-config-options-1\",\"aria-label\":\"deprecated agent config options permalink\"},`\\xbb`),`Deprecated Agent Config Options `,mdx(EnterpriseAlert,{inline:true,mdxType:\"EnterpriseAlert\"})),mdx(\"p\",null,`These config keys are now deprecated:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"audit-sink-name\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#audit-sink-name\",\"aria-label\":\"audit sink name permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`audit.sink[].name`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/agent/config/config-files#dns_prefer_namespace\"},mdx(\"inlineCode\",{parentName:\"a\"},`dns_config.dns_prefer_namespace`)))),mdx(\"h3\",{\"id\":\"deprecated-cli-subcommands\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#deprecated-cli-subcommands\",\"aria-label\":\"deprecated cli subcommands permalink\"},`\\xbb`),`Deprecated CLI Subcommands`),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`consul acl set-agent-token master`),` subcommand has been replaced with\n`,mdx(\"inlineCode\",{parentName:\"p\"},`consul acl set-agent-token recovery`),`. The old subcommand is deprecated.`),mdx(\"h3\",{\"id\":\"legacy-acl-system-removal\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#legacy-acl-system-removal\",\"aria-label\":\"legacy acl system removal permalink\"},`\\xbb`),`Legacy ACL System Removal`),mdx(\"p\",null,`The legacy ACL system that was deprecated in Consul 1.4.0 was removed in 1.11.0.\nBefore upgrading you should verify that nothing is still using the legacy ACL\nsystem. Complete the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/security-operations/access-control-token-migration\"},`Migrate Legacy ACL Tokens`),` tutorial to learn more.`),mdx(\"h3\",{\"id\":\"raft-storage-changes\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#raft-storage-changes\",\"aria-label\":\"raft storage changes permalink\"},`\\xbb`),`Raft Storage Changes`),mdx(\"p\",null,`The underlying library used for persisting the Raft log to persistent storage\nwas `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/issues/11720\"},`upgraded`),` from\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://pkg.go.dev/github.com/boltdb/bolt\"},mdx(\"inlineCode\",{parentName:\"a\"},`boltdb`)),` to\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://pkg.go.dev/go.etcd.io/bbolt\"},mdx(\"inlineCode\",{parentName:\"a\"},`bbolt`)),`.`),mdx(\"p\",null,`The newer `,mdx(\"inlineCode\",{parentName:\"p\"},`bbolt`),` library is compatible with the persisted format generated by\n`,mdx(\"inlineCode\",{parentName:\"p\"},`boltdb`),` but the reverse is not necessarily guaranteed. Like any Consul upgrade\nit is strongly recommended that you take a snapshot of your database if you\nexpect that you will need to downgrade.`),mdx(\"h3\",{\"id\":\"envoy-xds-protocol-upgrades\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#envoy-xds-protocol-upgrades\",\"aria-label\":\"envoy xds protocol upgrades permalink\"},`\\xbb`),`Envoy xDS Protocol Upgrades`),mdx(\"p\",null,`As noted in earlier upgrades, previous versions of Consul supported both v2 and v3\nvariants of the XDS Transport Protocol. In Consul 1.11, support for Envoy 1.16 is\nremoved and consequently v2 is no longer supported. What this means is that if\nyou have generated your Envoy bootstrap files using the Consul CLI that is newer\nthan 1.10, you must make sure that you upgrade Consul and Envoy per the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"#stairstep-upgrade-path\"},`Stairstep Upgrade Path`),` before upgrading to Consul 1.11.\nWhen upgrading to Consul 1.10, you must ensure that the Envoy sidecars are\nrestarted and bootstrapped using a version of the Consul CLI \u003e= 1.10. This\nensures your sidecars are supported by Consul 1.11.`),mdx(\"h3\",{\"id\":\"modify-vault-policy-for-vault-ca-provider-3\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#modify-vault-policy-for-vault-ca-provider-3\",\"aria-label\":\"modify vault policy for vault ca provider permalink\"},`\\xbb`),`Modify Vault Policy for Vault CA Provider`),mdx(\"p\",null,`Follow the same guidance as provided in the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"#modify-vault-policy-for-vault-ca-provider\"},`1.13 upgrade section for modifying the Vault policy if using the Vault CA provider`),`.\nA breaking change was made in Consul 1.11.9 that impacts service mesh operation\nif the Vault policy is not modified as described.\nAs a precaution, we recommend both modifying the Vault policy and upgrading\nto Consul 1.11.11 or later to avoid the breaking nature of that change.`),mdx(\"h2\",{\"id\":\"consul-1-10-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-10-0\",\"aria-label\":\"consul 1 10 0 permalink\"},`\\xbb`),`Consul 1.10.0`),mdx(\"h3\",{\"id\":\"licensing-changes\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#licensing-changes\",\"aria-label\":\"licensing changes permalink\"},`\\xbb`),`Licensing Changes `,mdx(EnterpriseAlert,{inline:true,mdxType:\"EnterpriseAlert\"})),mdx(\"p\",null,`You can only upgrade to Consul Enterprise 1.10 from the following Enterprise versions:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`1.8 release series: 1.8.13+`),mdx(\"li\",{parentName:\"ul\"},`1.9 release series: 1.9.7+`)),mdx(\"p\",null,`Other versions of Consul Enterprise are not forward compatible with v1.10 and will\ncause issues during the upgrade that could result in agents failing to start due to\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/enterprise/license/faq\"},`changes in the way we manage licenses`),`.`),mdx(\"p\",null,`Consul Enterprise 1.10 has removed temporary licensing capabilities from the binaries\nfound on `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://releases.hashicorp.com.\"},`https://releases.hashicorp.com.`),` Servers will no longer load a license previously\nset through the CLI or API. Instead the license must be present in the server's configuration\nor environment prior to starting. See the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/enterprise/license/overview\"},`licensing documentation`),`\nfor more information about how to configure the license. Client agents previously retrieved their\nlicense from the servers in the cluster within 30 minutes of starting and the snapshot agent\nwould similarly retrieve its license from the server or client agent it was configured to use. As\nof Consul Enterprise 1.10 both the snapshot agent and client agent have gained the ability to\nhave a license loaded from a configuration file or from their environment the same way server\nagents must have the license specified. Both agents can still perform automatic retrieval of their\nlicense but with a few extra stipulations. First, license auto-retrieval now requires that ACLs\nare on and that the client or snapshot agent is configured with a valid ACL token. Secondly, client\nagents require that either the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#start_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`start_join`)),` or\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`retry_join`)),` configurations are set and that they resolve to server\nagents. If those stipulations are not met, attempting to start the client or snapshot agent will\nresult in it immediately shutting down.`),mdx(\"p\",null,`For the step by step upgrade procedures see the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/upgrading/instructions/upgrade-to-1-10-x\"},`Upgrading to 1.10.0`),` documentation.\nFor answers to common licensing questions please refer to the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/enterprise/license/faq\"},`FAQ`)),mdx(\"h3\",{\"id\":\"envoy-xds-protocol-upgrades-1\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#envoy-xds-protocol-upgrades-1\",\"aria-label\":\"envoy xds protocol upgrades permalink\"},`\\xbb`),`Envoy xDS Protocol Upgrades`),mdx(\"p\",null,`Consul versions 1.9 and earlier exposed an xDS server for use by\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.envoyproxy.io\"},`Envoy`),` proxies using the v2 `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.envoyproxy.io/docs/envoy/v1.17.2/api-docs/xds_protocol#variants-of-the-xds-transport-protocol\"},`\"State of the\nWorld\"`),`\nprotocol variant.`),mdx(\"p\",null,`Consul 1.10.0 adds support for the v3\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.envoyproxy.io/docs/envoy/v1.17.2/api-docs/xds_protocol#incremental-xds\"},`Incremental`),`\nprotocol variant as the preferred way of conversing with Envoy. Both protocol\nvariants are supported in this Consul version to facilitate upgrading Consul\nand Envoy in a stairstep order to avoid downtime.`),mdx(\"p\",null,`In `,mdx(\"a\",{parentName:\"p\",\"href\":\"#consul-1-11-0\"},`Consul 1.11`),` the v2 State of the World protocol support will be removed.`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",{parentName:\"tr\",\"align\":null},`Protocol`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Version`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Compatible Envoy Versions`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Compatible Consul Versions`))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`Incremental`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`v3`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.18.x, 1.17.x, 1.16.x, 1.15.x`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.10.x`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`State of the World`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`v2`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.16.x and older`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1.10.x and older`)))),mdx(\"h4\",{\"id\":\"escape-hatches\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#escape-hatches\",\"aria-label\":\"escape hatches permalink\"},`\\xbb`),`Escape Hatches`),mdx(\"p\",null,`Any `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/proxies/envoy#advanced-configuration\"},`escape hatches`),` that\nare defined will likely need to be switched from using xDS v2 to xDS v3\nstructures. Mostly this involves migrating off of deprecated (and now removed)\nfields and switching untyped config to `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.envoyproxy.io/docs/envoy/v1.17.2/configuration/overview/extension\"},`typed config`),`\nwith `,mdx(\"inlineCode\",{parentName:\"p\"},`@type`),` attributes set appropriately.`),mdx(\"p\",null,`xDS v3 syntax has been `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.envoyproxy.io/docs/envoy/v1.13.0/api-v3/api\"},`supported since Envoy\n1.13.0`),` so this could\nbe done on most earlier versions of Consul+Envoy in advance of the Consul\n1.10.0 upgrade.`),mdx(\"p\",null,`As an example, here's a Zipkin integration\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/blob/v1.9.5/test/integration/connect/envoy/case-zipkin/service_s2.hcl\"},`before`),`\nand `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/blob/71d45a34601423abdfc0a64d44c6a55cf88fa2fc/test/integration/connect/envoy/case-zipkin/service_s2.hcl\"},`after`)),mdx(\"h4\",{\"id\":\"stairstep-upgrade-path\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#stairstep-upgrade-path\",\"aria-label\":\"stairstep upgrade path permalink\"},`\\xbb`),`Stairstep Upgrade Path`),mdx(\"ol\",null,mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Upgrade Envoy sidecars to the latest version of Envoy that is\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/proxies/envoy#supported-versions\"},`supported`),` by the currently\nrunning version of Consul as well as Consul 1.10.0.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Determine if you are using the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/proxies/envoy#advanced-configuration\"},`escape hatch`),`\nfeature. If so, rewrite the escape hatch to use the xDS v3 syntax and update\nthe service registration to reflect the updated escape hatch configuration\nby re-registering. This should purge v2 elements from any configs.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Perform a normal upgrade of both Consul servers and clients to 1.10.0. At\nthis point the existing Envoy instances will continue to speak the v2 State\nof the World protocol to the new Consul instances without issue.`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`Once a Consul client is upgraded, use an updated CLI binary to re-bootstrap\nand restart Envoy using `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/connect/envoy\"},mdx(\"inlineCode\",{parentName:\"a\"},`consul connect envoy`)),`.\nThis will ensure it switches over to the v3 Incremental xDS protocol.`),mdx(\"p\",{parentName:\"li\"},`Depending upon how you have chosen to run Envoy this is either one step\n(`,mdx(\"inlineCode\",{parentName:\"p\"},`consul connect envoy`),`) or two steps (`,mdx(\"inlineCode\",{parentName:\"p\"},`consul connect envoy -bootstrap`),`\nfollowed by running Envoy directly).`)),mdx(\"li\",{parentName:\"ol\"},mdx(\"p\",{parentName:\"li\"},`(Optionally) upgrade Envoy to the latest version supported in Consul 1.10.0.`))),mdx(\"h3\",{\"id\":\"transparent-proxy-on-kubernetes\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#transparent-proxy-on-kubernetes\",\"aria-label\":\"transparent proxy on kubernetes permalink\"},`\\xbb`),`Transparent Proxy on Kubernetes`),mdx(\"p\",null,`When upgrading to Consul \u003e= 1.10.0, Consul-helm \u003e= 0.32.0, and Consul-k8s \u003e= 0.26.0, a Kubernetes Service must be added for every service registered to Consul. This Service should be added before\nperforming the upgrade. This will allow services to be managed by a central component, called `,mdx(\"inlineCode\",{parentName:\"p\"},`endpoints-controller`),`, which will enable features like\ntransparent proxy.`),mdx(\"p\",null,`After the upgrade is performed, all Pods of a service will need to be restarted. The service will be up and health\nchecks will continue to work without restarting the service, but a restart is required so the Pods can be re-injected with the latest\ncontainer configuration.`),mdx(\"h2\",{\"id\":\"consul-1-9-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-9-0\",\"aria-label\":\"consul 1 9 0 permalink\"},`\\xbb`),`Consul 1.9.0`),mdx(\"h3\",{\"id\":\"changes-to-raft-protocol-support\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#changes-to-raft-protocol-support\",\"aria-label\":\"changes to raft protocol support permalink\"},`\\xbb`),`Changes to Raft Protocol Support`),mdx(\"p\",null,`Consul 1.8 supported Raft protocols 2 and 3. Consul 1.9.0 now only supports\nRaft protocol 3. Consul has defaulted to using Raft protocol 3 since version 1.0.0,\nso this should only impact users who have been using Consul prior to 1.0.0 and\nmay have the `,mdx(\"inlineCode\",{parentName:\"p\"},`raft_protocol`),` config setting set to 2. Users in that position\nshould upgrade to a previous release supporting both protocol versions and\nupdate their configuration to use Raft protocol 3 before continuing their upgrade\nto Consul 1.9.0.`),mdx(\"h3\",{\"id\":\"changes-to-configuration-defaults\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#changes-to-configuration-defaults\",\"aria-label\":\"changes to configuration defaults permalink\"},`\\xbb`),`Changes to Configuration Defaults`),mdx(\"p\",null,`The `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#enable_central_service_config\"},mdx(\"inlineCode\",{parentName:\"a\"},`enable_central_service_config`)),`\nconfiguration now defaults to `,mdx(\"inlineCode\",{parentName:\"p\"},`true`),`.`),mdx(\"h3\",{\"id\":\"changes-to-intentions\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#changes-to-intentions\",\"aria-label\":\"changes to intentions permalink\"},`\\xbb`),`Changes to Intentions`),mdx(\"h4\",{\"id\":\"namespaced-intentions\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#namespaced-intentions\",\"aria-label\":\"namespaced intentions permalink\"},`\\xbb`),`Namespaced Intentions `,mdx(EnterpriseAlert,{inline:true,mdxType:\"EnterpriseAlert\"})),mdx(\"p\",null,`The API endpoint to `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/connect/intentions#list-intentions\"},`list\nintentions`),` now accepts the same\n`,mdx(\"inlineCode\",{parentName:\"p\"},`ns`),` query parameter (or `,mdx(\"inlineCode\",{parentName:\"p\"},`X-Consul-Namespace`),` header) used on other API\nendpoints. By default this will now only list the intentions in a specific\nnamespace, rather than listing all intentions across all namespaces. To achieve\nthe same results as Consul versions prior to 1.9.0 request the wildcard\nnamespace with a query parameter of `,mdx(\"inlineCode\",{parentName:\"p\"},`?ns=*`),`.`),mdx(\"h4\",{\"id\":\"migration\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#migration\",\"aria-label\":\"migration permalink\"},`\\xbb`),`Migration`),mdx(\"p\",null,`Upgrading to Consul 1.9.0 will trigger a one-time background migration of\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/intentions\"},`intentions`),` into an equivalent set of\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-intentions\"},mdx(\"inlineCode\",{parentName:\"a\"},`service-intentions`)),` config\nentries. This process will wait until all of the Consul servers in the primary\ndatacenter are running Consul 1.9.0+.`),mdx(\"p\",null,`All write requests via either the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/connect/intentions\"},`Intentions\nAPI`),` endpoints or `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/config\"},`Config Entry\nAPI`),` endpoints for a `,mdx(\"inlineCode\",{parentName:\"p\"},`service-intentions`),` kind will be\nblocked until the migration process is complete after the upgrade. Reads will\nfunction normally throughout the migration, so authorization enforcement will\nbe unaffected.`),mdx(\"p\",null,`Secondary datacenters will perform their own one-time migration operations\nafter the primary datacenter completes its migration and all of the Consul\nservers in the secondary datacenter are running Consul 1.9.0+. It is safe to\nupgrade the datacenters in any order.`),mdx(\"h4\",{\"id\":\"deprecated-fields\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#deprecated-fields\",\"aria-label\":\"deprecated fields permalink\"},`\\xbb`),`Deprecated Fields`),mdx(\"p\",null,`All old ID-based `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/connect/intentions\"},`Intentions API`),` CRUD endpoints\nwill retain all of their prior fields `,mdx(\"em\",{parentName:\"p\"},`as long as those endpoints are\nexclusively used to edit intentions`),`. Once the underlying config entry\nrepresentation is edited it will transition the intention into the newer format\nwhere some fields are no longer present. Once this transition occurs those\nintentions can no longer be used with the ID-based endpoints unless they are\nre-created via the old endpoints. Fields that are being removed or changing\nbehavior:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"intention-id\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#intention-id\",\"aria-label\":\"intention id permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`Intention.ID`)),` after migration is stored in the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-intentions#legacyid\"},mdx(\"inlineCode\",{parentName:\"a\"},`LegacyID`)),` field.\nAfter transitioning this field is cleared.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"intention-createdat\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#intention-createdat\",\"aria-label\":\"intention createdat permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`Intention.CreatedAt`)),` after migration is stored in the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-intentions#legacycreatetime\"},mdx(\"inlineCode\",{parentName:\"a\"},`LegacyCreateTime`)),`\nfield. After transitioning this field is cleared.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"intention-updatedat\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#intention-updatedat\",\"aria-label\":\"intention updatedat permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`Intention.UpdatedAt`)),` after migration is stored in the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-intentions#legacyupdatetime\"},mdx(\"inlineCode\",{parentName:\"a\"},`LegacyUpdateTime`)),`\nfield. After transitioning this field is cleared.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"intention-meta\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"p\",{parentName:\"li\"},mdx(\"a\",{parentName:\"p\",\"href\":\"#intention-meta\",\"aria-label\":\"intention meta permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`Intention.Meta`)),` after migration is stored in the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-intentions#legacymeta\"},mdx(\"inlineCode\",{parentName:\"a\"},`LegacyMeta`)),`\nfield. To complete the transition, this field `,mdx(\"strong\",{parentName:\"p\"},`must be cleared manually`),`\nand the metadata moved up to the enclosing config entry's\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/config-entries/service-intentions#meta\"},mdx(\"inlineCode\",{parentName:\"a\"},`Meta`)),` field. This is\nnot done automatically since it is potentially a lossy operation.`))),mdx(\"h2\",{\"id\":\"consul-1-8-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-8-0\",\"aria-label\":\"consul 1 8 0 permalink\"},`\\xbb`),`Consul 1.8.0`),mdx(\"h4\",{\"id\":\"removal-of-deprecated-features\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#removal-of-deprecated-features\",\"aria-label\":\"removal of deprecated features permalink\"},`\\xbb`),`Removal of Deprecated Features`),mdx(\"p\",null,`The `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#acl_enforce_version_8\"},mdx(\"inlineCode\",{parentName:\"a\"},`acl_enforce_version_8`)),`\nconfiguration has been removed (with version 8 ACL support by being on by\ndefault).`),mdx(\"h2\",{\"id\":\"consul-1-7-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-7-0\",\"aria-label\":\"consul 1 7 0 permalink\"},`\\xbb`),`Consul 1.7.0`),mdx(\"p\",null,`Consul 1.7.0 contains three major changes that impact upgrades:\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"#stricter-json-decoding\"},`stricter JSON decoding`),`, `,mdx(\"a\",{parentName:\"p\",\"href\":\"#dns-ptr-record-output\"},`modified DNS outputs`),`,\nand `,mdx(\"a\",{parentName:\"p\",\"href\":\"#session-api\"},`backward-incompatible Session API changes`),`.`),mdx(\"h3\",{\"id\":\"session-api\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#session-api\",\"aria-label\":\"session api permalink\"},`\\xbb`),`Session API`),mdx(\"p\",null,`Consul 1.7.0 introduced a backwards incompatible change to the Session API.\nQueries to view or renew sessions from agents on earlier versions will be rejected.\nThis impacts features and products including: Vault, the Enterprise snapshot agent, and locks.`),mdx(\"p\",null,`The issue occurs when clients are still running 1.6.4 or earlier but servers have been upgraded to 1.7.0 or 1.7.1.\nFor this reason, we recommend you upgrade directly to 1.7.2 when it is available as it will include a fix for this issue.`),mdx(\"h3\",{\"id\":\"stricter-json-decoding\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#stricter-json-decoding\",\"aria-label\":\"stricter json decoding permalink\"},`\\xbb`),`Stricter JSON Decoding`),mdx(\"p\",null,`The HTTP API will now return 400 status codes with a textual error when unknown fields\nare present in the payload of a request. Previously, Consul would simply ignore the\nunknown fields. You will need to ensure that your API usage only uses supported\nfields which are those documented in the example payloads in the API documentation.`),mdx(\"h3\",{\"id\":\"dns-ptr-record-output\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#dns-ptr-record-output\",\"aria-label\":\"dns ptr record output permalink\"},`\\xbb`),`DNS PTR Record Output`),mdx(\"p\",null,`Consul will now return the canonical service name in response to PTR queries. For CE users, the\nchange is that the datacenter will be present where it was not before. For Consul Enterprise\nusers, both the datacenter and the services namespace will be present. For example, where a\nPTR record would previously have contained `,mdx(\"inlineCode\",{parentName:\"p\"},`web.service.consul`),`, it will now be `,mdx(\"inlineCode\",{parentName:\"p\"},`web.service.dc1.consul`),`\nin CE, or `,mdx(\"inlineCode\",{parentName:\"p\"},`web.service.ns1.dc1.consul`),` for Enterprise.`),mdx(\"h3\",{\"id\":\"telemetry-semantics-of-consul-rpc-query-changed-see-consul-rpc-queries_blocking\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#telemetry-semantics-of-consul-rpc-query-changed-see-consul-rpc-queries_blocking\",\"aria-label\":\"telemetry semantics of consul rpc query changed see consul rpc queries_blocking permalink\"},`\\xbb`),`Telemetry: semantics of `,mdx(\"inlineCode\",{parentName:\"h3\"},`consul.rpc.query`),` changed, see `,mdx(\"inlineCode\",{parentName:\"h3\"},`consul.rpc.queries_blocking`)),mdx(\"p\",null,`Consul has changed the semantics of query counts in its `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/telemetry#metrics-reference\"},`telemetry`),`.\n`,mdx(\"inlineCode\",{parentName:\"p\"},`consul.rpc.query`),` now only increments on the `,mdx(\"em\",{parentName:\"p\"},`start`),` of a query (blocking or non-blocking), whereas before it would\nmeasure when blocking queries polled for more data. The `,mdx(\"inlineCode\",{parentName:\"p\"},`consul.rpc.queries_blocking`),` gauge has been added\nto more precisely capture the view of `,mdx(\"em\",{parentName:\"p\"},`active`),` blocking queries.`),mdx(\"h3\",{\"id\":\"vault-default-http_max_conns_per_client-too-low-to-run-vault-properly\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#vault-default-http_max_conns_per_client-too-low-to-run-vault-properly\",\"aria-label\":\"vault default http_max_conns_per_client too low to run vault properly permalink\"},`\\xbb`),`Vault: default `,mdx(\"inlineCode\",{parentName:\"h3\"},`http_max_conns_per_client`),` too low to run Vault properly`),mdx(\"p\",null,`Consul 1.7.0 introduced `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#http_max_conns_per_client\"},`limiting of connections per client`),`. The default value\nwas 100, but Vault could use up to 128, which caused problems. If you want to use Vault with Consul 1.7.0, you should change the value to 200.\nStarting with Consul 1.7.1 this is the new default.`),mdx(\"h2\",{\"id\":\"consul-1-6-3\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-6-3\",\"aria-label\":\"consul 1 6 3 permalink\"},`\\xbb`),`Consul 1.6.3`),mdx(\"h3\",{\"id\":\"vault-default-http_max_conns_per_client-too-low-to-run-vault-properly-1\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#vault-default-http_max_conns_per_client-too-low-to-run-vault-properly-1\",\"aria-label\":\"vault default http_max_conns_per_client too low to run vault properly permalink\"},`\\xbb`),`Vault: default `,mdx(\"inlineCode\",{parentName:\"h3\"},`http_max_conns_per_client`),` too low to run Vault properly`),mdx(\"p\",null,`Consul 1.6.3 introduced `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#http_max_conns_per_client\"},`limiting of connections per client`),`. The default value\nwas 100, but Vault could use up to 128, which caused problems. If you want to use Vault with Consul 1.6.3 through 1.7.0, you should change the value to 200.\nStarting with Consul 1.7.1 this is the new default.`),mdx(\"h2\",{\"id\":\"consul-1-6-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-6-0\",\"aria-label\":\"consul 1 6 0 permalink\"},`\\xbb`),`Consul 1.6.0`),mdx(\"h4\",{\"id\":\"removal-of-deprecated-features-1\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#removal-of-deprecated-features-1\",\"aria-label\":\"removal of deprecated features permalink\"},`\\xbb`),`Removal of Deprecated Features`),mdx(\"p\",null,`Managed proxies, which are deprecated since Consul v1.3.0, have now been\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/proxies\"},`removed`),`. Before upgrading, you must\nmigrate any managed proxy usage to `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/proxies/deploy-sidecar-services\"},`sidecar service\nregistrations`),`.`),mdx(\"h2\",{\"id\":\"consul-1-4-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-4-0\",\"aria-label\":\"consul 1 4 0 permalink\"},`\\xbb`),`Consul 1.4.0`),mdx(\"p\",null,`There are two major features in Consul 1.4.0 that may impact upgrades: a `,mdx(\"a\",{parentName:\"p\",\"href\":\"#acl-upgrade\"},`new\nACL system`),` and `,mdx(\"a\",{parentName:\"p\",\"href\":\"#multi-datacenter-service-mesh\"},`multi-datacenter support for\nservice mesh`),` in the Enterprise version.`),mdx(\"h3\",{\"id\":\"acl-upgrade\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#acl-upgrade\",\"aria-label\":\"acl upgrade permalink\"},`\\xbb`),`ACL Upgrade`),mdx(\"p\",null,`Consul 1.4.0 includes a `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/security/access-control-setup-production\"},`new ACL\nsystem`),`\nthat is designed to have a smooth upgrade path but requires care to upgrade\ncomponents in the right order.`),mdx(\"p\",null,mdx(\"strong\",{parentName:\"p\"},`Note:`),` As with most major version upgrades, you cannot downgrade once the\nupgrade to 1.4.0 is complete as it adds new state to the raft store. As always\nit is `,mdx(\"em\",{parentName:\"p\"},`strongly`),` recommended that you test the upgrade first outside of\nproduction and ensure you take backup snapshots of all datacenters before\nupgrading.`),mdx(\"h4\",{\"id\":\"primary-datacenter\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#primary-datacenter\",\"aria-label\":\"primary datacenter permalink\"},`\\xbb`),`Primary Datacenter`),mdx(\"p\",null,`The \"ACL datacenter\" in 1.3.x and earlier is now referred to as the \"Primary\ndatacenter\". All configuration is backwards compatible and shouldn't need to\nchange prior to upgrade although it's strongly recommended to migrate ACL\nconfiguration to the new syntax soon after upgrade. This includes moving to\n`,mdx(\"inlineCode\",{parentName:\"p\"},`primary_datacenter`),` rather than `,mdx(\"inlineCode\",{parentName:\"p\"},`acl_datacenter`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`acl_*`),` to the new `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#acl\"},`ACL\nblock`),`.`),mdx(\"p\",null,`Datacenters can be upgraded in any order although secondaries will remain in\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"#legacy-acl-mode\"},`Legacy ACL mode`),` until the primary datacenter is fully\nupgraded.`),mdx(\"p\",null,`Each datacenter should follow the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/upgrading#standard-upgrades\"},`standard rolling upgrade\nprocedure`),`.`),mdx(\"h4\",{\"id\":\"legacy-acl-mode\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#legacy-acl-mode\",\"aria-label\":\"legacy acl mode permalink\"},`\\xbb`),`Legacy ACL Mode`),mdx(\"p\",null,`When a 1.4.0 server first starts, it runs in \"Legacy ACL mode\". In this mode,\nbootstrap requests and new ACL APIs will not be functional yet and will return\nan error. The server advertises its ability to support 1.4.0 ACLs via gossip\nand waits.`),mdx(\"p\",null,`In the primary datacenter, the servers all wait in legacy ACL mode until they\nsee every server in the primary datacenter advertise 1.4.0 ACL support. Once\nthis happens, the leader will complete the transition out of \"legacy ACL mode\"\nand write this into the state so future restarts don't need to go through the\nsame transition.`),mdx(\"p\",null,`In a secondary datacenter, the same process happens except that servers\n`,mdx(\"em\",{parentName:\"p\"},`additionally`),` wait for all servers in the primary datacenter making it safe to\nupgrade datacenters in any order.`),mdx(\"p\",null,`It should be noted that even if you are not upgrading, starting a brand new\n1.4.0 cluster will transition through legacy ACL mode so you may be unable to\nbootstrap ACLs until all the expected servers are up and healthy.`),mdx(\"h4\",{\"id\":\"legacy-token-accessor-migration\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#legacy-token-accessor-migration\",\"aria-label\":\"legacy token accessor migration permalink\"},`\\xbb`),`Legacy Token Accessor Migration`),mdx(\"p\",null,`As soon as all servers in the primary datacenter have been upgraded to 1.4.0,\nthe leader will begin the process of creating new accessor IDs for all existing\nACL tokens.`),mdx(\"p\",null,`This process completes in the background and is rate limited to ensure it\ndoesn't overload the leader. It completes upgrades in batches of 128 tokens and\nwill not upgrade more than one batch per second so on a cluster with 10,000\ntokens, this may take several minutes.`),mdx(\"p\",null,`While this is happening both old and new ACLs will work correctly with the\ncaveat that new ACL `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/acl/tokens\"},`Token APIs`),` may not return an\naccessor ID for legacy tokens that are not yet migrated.`),mdx(\"h4\",{\"id\":\"migrating-existing-acls\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#migrating-existing-acls\",\"aria-label\":\"migrating existing acls permalink\"},`\\xbb`),`Migrating Existing ACLs`),mdx(\"p\",null,`New ACL policies have slightly different syntax designed to fix some\nshortcomings in old ACL syntax. During and after the upgrade process, any old\nACL tokens will continue to work and grant exactly the same level of access.`),mdx(\"p\",null,`After upgrade, it is still possible to create \"legacy\" tokens using the existing\nAPI so existing integrations that create tokens (e.g. Vault) will continue to\nwork. The \"legacy\" tokens generated though will not be able to take advantage of\nnew policy features. It's recommended that you complete migration of all tokens\nas soon as possible after upgrade, as well as updating any integrations to work\nwith the new ACL `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/acl/tokens\"},`Token`),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/acl/policies\"},`Policy`),` APIs.`),mdx(\"h3\",{\"id\":\"multi-datacenter-service-mesh\"},mdx(\"a\",{parentName:\"h3\",\"className\":\"__permalink-h\",\"href\":\"#multi-datacenter-service-mesh\",\"aria-label\":\"multi datacenter service mesh permalink\"},`\\xbb`),`Multi-datacenter service mesh`),mdx(\"p\",null,`This only applies to users upgrading from an older version of Consul Enterprise to Consul Enterprise 1.4.0 (all license types).`),mdx(\"p\",null,`In addition, this upgrade will only affect clusters where `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/connect/configuration\"},`service mesh is enabled`),` on your servers before the migration.`),mdx(\"p\",null,`Multi-datacenter service mesh uses the same primary/secondary approach as ACLs and\nwill use the same `,mdx(\"a\",{parentName:\"p\",\"href\":\"#primary-datacenter\"},`primary_datacenter`),`. When a secondary\ndatacenter server restarts with 1.4.0 it will detect it is not the primary and\nbegin an automatic bootstrap of multi-datacenter CA federation.`),mdx(\"p\",null,`Datacenters can be upgraded in either order; secondary datacenters will not\nswitch into multi-datacenter mode until all servers in both the secondary and\nprimary datacenter are detected to be running at least Consul 1.4.0. Secondary\ndatacenters monitor this periodically (every few minutes) and will\nautomatically upgrade service mesh to use a federated Certificate Authority when\nthey do.`),mdx(\"p\",null,`In general, migrating a Consul cluster from CE to Enterprise will update the\nCA to be federated automatically and without impact on service mesh traffic. When\nupgrading Consul Enterprise 1.3.x to Consul Enterprise 1.4.0 upgrades the CA\nupgrade is seamless, however depending on the size of the cluster, `,mdx(\"em\",{parentName:\"p\"},`new`),`\nconnection attempts in the secondary datacenter might fail for a short window\n(typically seconds) while the update is propagated due to the 1.3.x Beta\nauthorization endpoint validating originating cluster in a way that was not\nfully forwards compatible with migrating between cluster trust domains. That\nissue is fixed in 1.4.0 as part of General Availability.`),mdx(\"p\",null,`Once migrated (typically a few seconds). The service mesh will use the primary\ndatacenter's Certificate Authority as the root of trust for all other\ndatacenters. CA migration or root key changes in the primary will now rotate\nautomatically and without loss of connectivity throughout all datacenters and\nworkloads.`),mdx(\"h2\",{\"id\":\"consul-1-3-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-3-0\",\"aria-label\":\"consul 1 3 0 permalink\"},`\\xbb`),`Consul 1.3.0`),mdx(\"p\",null,`This version added support for multiple tag filters in service discovery\nqueries, however it introduced a subtle bug where API calls to\n`,mdx(\"inlineCode\",{parentName:\"p\"},`/catalog/service/:name?tag=\u003ctag\u003e`),` would ignore the tag filter `,mdx(\"em\",{parentName:\"p\"},`only during the\nupgrade`),`. It only occurs when clients are still running 1.2.3 or earlier but\nservers have been upgraded. The `,mdx(\"inlineCode\",{parentName:\"p\"},`/health/service/:name?tag=\u003ctag\u003e`),` endpoint and\nDNS interface were `,mdx(\"em\",{parentName:\"p\"},`not`),` affected.`),mdx(\"p\",null,`For this reason, we recommend you upgrade directly to 1.3.1 which includes only\na fix for this issue.`),mdx(\"h2\",{\"id\":\"consul-1-1-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-1-0\",\"aria-label\":\"consul 1 1 0 permalink\"},`\\xbb`),`Consul 1.1.0`),mdx(\"h4\",{\"id\":\"removal-of-deprecated-features-2\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#removal-of-deprecated-features-2\",\"aria-label\":\"removal of deprecated features permalink\"},`\\xbb`),`Removal of Deprecated Features`),mdx(\"p\",null,`The following previously deprecated fields and config options have been removed:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"checkid\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#checkid\",\"aria-label\":\"checkid permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`CheckID`)),` has been removed from config file check definitions (use `,mdx(\"inlineCode\",{parentName:\"li\"},`id`),` instead).`),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"script\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#script\",\"aria-label\":\"script permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`script`)),` has been removed from config file check definitions (use `,mdx(\"inlineCode\",{parentName:\"li\"},`args`),` instead).`),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"enabletagoverride\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#enabletagoverride\",\"aria-label\":\"enabletagoverride permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`enableTagOverride`)),` is no longer valid in service definitions (use `,mdx(\"inlineCode\",{parentName:\"li\"},`enable_tag_override`),` instead).`),mdx(\"li\",{parentName:\"ul\"},`The `,mdx(\"a\",{parentName:\"li\",\"href\":\"/consul/docs/upgrading/upgrade-specific#metric-names-updated\"},`deprecated set of metric names`),` (beginning with `,mdx(\"inlineCode\",{parentName:\"li\"},`consul.consul.`),`) has been removed\nalong with the `,mdx(\"inlineCode\",{parentName:\"li\"},`enable_deprecated_names`),` option from the metrics configuration.`)),mdx(\"h4\",{\"id\":\"new-defaults-for-raft-snapshot-creation\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#new-defaults-for-raft-snapshot-creation\",\"aria-label\":\"new defaults for raft snapshot creation permalink\"},`\\xbb`),`New defaults for Raft Snapshot Creation`),mdx(\"p\",null,`Consul 1.0.1 (and earlier versions of Consul) checked for raft snapshots every\n5 seconds, and created new snapshots for every 8192 writes. These defaults cause\nconstant disk IO in large busy clusters. Consul 1.1.0 increases these to larger values,\nand makes them tunable via the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#_raft_snapshot_interval\"},`raft_snapshot_interval`),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#_raft_snapshot_threshold\"},`raft_snapshot_threshold`),` parameters. We recommend\nkeeping the new defaults. However, operators can go back to the old defaults by changing their\nconfig if they prefer more frequent snapshots. See the documentation for `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#_raft_snapshot_interval\"},`raft_snapshot_interval`),`\nand `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#_raft_snapshot_threshold\"},`raft_snapshot_threshold`),` to understand the trade-offs\nwhen tuning these.`),mdx(\"h2\",{\"id\":\"consul-1-0-7\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-0-7\",\"aria-label\":\"consul 1 0 7 permalink\"},`\\xbb`),`Consul 1.0.7`),mdx(\"p\",null,`When requesting a specific service (`,mdx(\"inlineCode\",{parentName:\"p\"},`/v1/health/:service`),` or\n`,mdx(\"inlineCode\",{parentName:\"p\"},`/v1/catalog/:service`),` endpoints), the `,mdx(\"inlineCode\",{parentName:\"p\"},`X-Consul-Index`),` returned is now the\nindex at which that `,mdx(\"em\",{parentName:\"p\"},`specific service`),` was last modified. In version 1.0.6 and\nearlier the `,mdx(\"inlineCode\",{parentName:\"p\"},`X-Consul-Index`),` returned was the index at which `,mdx(\"em\",{parentName:\"p\"},`any`),` service was\nlast modified. See `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/issues/3890\"},`GH-3890`),`\nfor more details.`),mdx(\"p\",null,`During upgrades from 1.0.6 or lower to 1.0.7 or higher, watchers are likely to\nsee `,mdx(\"inlineCode\",{parentName:\"p\"},`X-Consul-Index`),` for these endpoints decrease between blocking calls.`),mdx(\"p\",null,`Consul's watch feature and `,mdx(\"inlineCode\",{parentName:\"p\"},`consul-template`),` should gracefully handle this case.\nOther tools relying on blocking service or health queries are also likely to\nwork; some may require a restart. It is possible external tools could break and\neither stop working or continually re-request data without blocking if they\nhave assumed indexes can never decrease or be reset and/or persist index\nvalues. Please test any blocking query integrations in a controlled environment\nbefore proceeding.`),mdx(\"h2\",{\"id\":\"consul-1-0-1\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-0-1\",\"aria-label\":\"consul 1 0 1 permalink\"},`\\xbb`),`Consul 1.0.1`),mdx(\"h4\",{\"id\":\"carefully-check-and-remove-stale-servers-during-rolling-upgrades\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#carefully-check-and-remove-stale-servers-during-rolling-upgrades\",\"aria-label\":\"carefully check and remove stale servers during rolling upgrades permalink\"},`\\xbb`),`Carefully Check and Remove Stale Servers During Rolling Upgrades`),mdx(\"p\",null,`Consul 1.0 (and earlier versions of Consul when running with `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#_raft_protocol\"},`Raft protocol\n3`),` had an issue where performing\nrolling updates of Consul servers could result in an outage from old servers\nremaining in the cluster.\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/datacenter-operations/autopilot-datacenter-operations\"},`Autopilot`),`\nwould normally remove old servers when new ones come online, but it was also\nwaiting to promote servers to voters in pairs to maintain an odd quorum size.\nThe pairwise promotion feature was removed so that servers become voters as\nsoon as they are stable, allowing Autopilot to remove old servers in a safer\nway.`),mdx(\"p\",null,`When upgrading from Consul 1.0, you may need to manually\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/force-leave\"},`force-leave`),` old servers as part of a rolling\nupdate to Consul 1.0.1.`),mdx(\"h2\",{\"id\":\"consul-1-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-1-0\",\"aria-label\":\"consul 1 0 permalink\"},`\\xbb`),`Consul 1.0`),mdx(\"p\",null,`Consul 1.0 has several important breaking changes that are documented here.\nPlease be sure to read over all the details here before upgrading.`),mdx(\"h4\",{\"id\":\"raft-protocol-now-defaults-to-3\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#raft-protocol-now-defaults-to-3\",\"aria-label\":\"raft protocol now defaults to 3 permalink\"},`\\xbb`),`Raft Protocol Now Defaults to 3`),mdx(\"p\",null,`The `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#_raft_protocol\"},mdx(\"inlineCode\",{parentName:\"a\"},`-raft-protocol`)),` default has\nbeen changed from 2 to 3, enabling all\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/datacenter-operations/autopilot-datacenter-operations\"},`Autopilot`),`\nfeatures by default.`),mdx(\"p\",null,`Raft protocol version 3 requires Consul running 0.8.0 or newer on all servers\nin order to work, so if you are upgrading with older servers in a cluster then\nyou will need to set this back to 2 in order to upgrade. See `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/upgrading/upgrade-specific#raft-protocol-version-compatibility\"},`Raft Protocol\nVersion\nCompatibility`),`\nfor more details. Also the format of `,mdx(\"inlineCode\",{parentName:\"p\"},`peers.json`),` used for outage recovery is\ndifferent when running with the latest Raft protocol. Review `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/datacenter-operations/recovery-outage#manual-recovery-using-peers-json\"},`Manual Recovery\nUsing\npeers.json`),`\nfor a description of the required format.`),mdx(\"p\",null,`Please note that the Raft protocol is different from Consul's internal protocol\nas described on the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/upgrading/compatibility\"},`Protocol Compatibility Promise`),`\npage, and as is shown in commands like `,mdx(\"inlineCode\",{parentName:\"p\"},`consul members`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`consul version`),`.\nTo see the version of the Raft protocol in use on each server, use the `,mdx(\"inlineCode\",{parentName:\"p\"},`consul operator raft list-peers`),` command.`),mdx(\"p\",null,`The easiest way to upgrade servers is to have each server leave the cluster,\nupgrade its Consul version, and then add it back. Make sure the new server\njoins successfully and that the cluster is stable before rolling the upgrade\nforward to the next server. It's also possible to stand up a new set of\nservers, and then slowly stand down each of the older servers in a similar\nfashion.`),mdx(\"p\",null,`When using Raft protocol version 3, servers are identified by their\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#_node_id\"},mdx(\"inlineCode\",{parentName:\"a\"},`-node-id`)),` instead of their IP address\nwhen Consul makes changes to its internal Raft quorum configuration. This means\nthat once a cluster has been upgraded with servers all running Raft protocol\nversion 3, it will no longer allow servers running any older Raft protocol\nversions to be added. If running a single Consul server, restarting it in-place\nwill result in that server not being able to elect itself as a leader. To avoid\nthis, either set the Raft protocol back to 2, or use `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/datacenter-operations/recovery-outage#manual-recovery-using-peers-json\"},`Manual Recovery Using\npeers.json`),`\nto map the server to its node ID in the Raft quorum configuration.`),mdx(\"h4\",{\"id\":\"config-files-require-an-extension\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#config-files-require-an-extension\",\"aria-label\":\"config files require an extension permalink\"},`\\xbb`),`Config Files Require an Extension`),mdx(\"p\",null,`As part of supporting the `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/hcl#syntax\"},`HCL`),` format\nfor Consul's config files, an `,mdx(\"inlineCode\",{parentName:\"p\"},`.hcl`),` or `,mdx(\"inlineCode\",{parentName:\"p\"},`.json`),` extension is required for all\nconfig files loaded by Consul, even when using the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#_config_file\"},mdx(\"inlineCode\",{parentName:\"a\"},`-config-file`)),` argument to specify a\nfile directly.`),mdx(\"h4\",{\"id\":\"use-snake-case-for-service-definition-parameters\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#use-snake-case-for-service-definition-parameters\",\"aria-label\":\"use snake case for service definition parameters permalink\"},`\\xbb`),`Use Snake Case for Service Definition Parameters`),mdx(\"p\",null,`Snake case, which is a convention that uses underscores between words in a configuration key, is required for all configuration file formats. Change any camel cased parameter to snake case equivalents before upgrading.`),mdx(\"h4\",{\"id\":\"deprecated-options-have-been-removed\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#deprecated-options-have-been-removed\",\"aria-label\":\"deprecated options have been removed permalink\"},`\\xbb`),`Deprecated Options Have Been Removed`),mdx(\"p\",null,`All of Consul's previously deprecated command line flags and config options\nhave been removed, so these will need to be mapped to their equivalents before\nupgrading. Here's the complete list of removed options and their equivalents:`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",{parentName:\"tr\",\"align\":null},`Removed Option`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Equivalent`))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-dc`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_datacenter\"},mdx(\"inlineCode\",{parentName:\"a\"},`-datacenter`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-azure-tag-name`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-azure-tag-value`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-ec2-region`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-ec2-tag-key`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-ec2-tag-value`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-gce-credentials-file`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-gce-project-name`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-gce-tag-name`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`-retry-join-gce-zone-pattern`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/cli-flags#_retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`addresses.rpc`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},`None, the RPC server for CLI commands is no longer supported.`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`advertise_addrs`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/config-files#ports\"},mdx(\"inlineCode\",{parentName:\"a\"},`ports`)),` with `,mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/config-files#advertise_addr\"},mdx(\"inlineCode\",{parentName:\"a\"},`advertise_addr`)),` and/or `,mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/config-files#advertise_addr_wan\"},mdx(\"inlineCode\",{parentName:\"a\"},`advertise_addr_wan`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`dogstatsd_addr`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-dogstatsd_addr\"},mdx(\"inlineCode\",{parentName:\"a\"},`telemetry.dogstatsd_addr`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`dogstatsd_tags`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-dogstatsd_tags\"},mdx(\"inlineCode\",{parentName:\"a\"},`telemetry.dogstatsd_tags`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`http_api_response_headers`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"a\",{parentName:\"td\",\"href\":\"/consul/docs/agent/config/config-files#response_headers\"},mdx(\"inlineCode\",{parentName:\"a\"},`http_config.response_headers`)))),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},mdx(\"inlineCode\",{parentName:\"td\"},`ports.rpc`)),mdx(\"td\",{parentName:\"tr\",\"align\":null},`None, the RPC server for CLI commands is no longer supported.`)))),mdx(\"p\",null,`| `,mdx(\"inlineCode\",{parentName:\"p\"},`recursor`),`                                             | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#recursors\"},mdx(\"inlineCode\",{parentName:\"a\"},`recursors`)),`                                                          |\n| `,mdx(\"inlineCode\",{parentName:\"p\"},`retry_join_azure`),`                                     | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`retry-join`)),`                                                                                                                       |\n| `,mdx(\"inlineCode\",{parentName:\"p\"},`retry_join_ec2`),`                                       | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`retry-join`)),`                                                                                                                       |\n| `,mdx(\"inlineCode\",{parentName:\"p\"},`retry_join_gce`),`                                       | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#retry_join\"},mdx(\"inlineCode\",{parentName:\"a\"},`retry-join`)),`                                                                                                                       |\n| `,mdx(\"inlineCode\",{parentName:\"p\"},`statsd_addr`),`                                          | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-statsd_address\"},mdx(\"inlineCode\",{parentName:\"a\"},`telemetry.statsd_address`)),`                            |\n| `,mdx(\"inlineCode\",{parentName:\"p\"},`statsite_addr`),`                                        | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-statsite_address\"},mdx(\"inlineCode\",{parentName:\"a\"},`telemetry.statsite_address`)),`                        |\n| `,mdx(\"inlineCode\",{parentName:\"p\"},`statsite_prefix`),`                                      | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-metrics_prefix\"},mdx(\"inlineCode\",{parentName:\"a\"},`telemetry.metrics_prefix`)),`                                                                                             |\n| `,mdx(\"inlineCode\",{parentName:\"p\"},`telemetry.statsite_prefix`),`                            | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-metrics_prefix\"},mdx(\"inlineCode\",{parentName:\"a\"},`telemetry.metrics_prefix`)),`                                                                                             |\n| (service definitions) `,mdx(\"inlineCode\",{parentName:\"p\"},`serviceid`),`                      | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/agent/service#id\"},mdx(\"inlineCode\",{parentName:\"a\"},`id`)),`                                                                                                                                   |\n| (service definitions) `,mdx(\"inlineCode\",{parentName:\"p\"},`dockercontainerid`),`              | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/agent/check#dockercontainerid\"},mdx(\"inlineCode\",{parentName:\"a\"},`docker_container_id`)),`                                                                                                                          |\n| (service definitions) `,mdx(\"inlineCode\",{parentName:\"p\"},`tlsskipverify`),`                  | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/agent/check#tlsskipverify\"},mdx(\"inlineCode\",{parentName:\"a\"},`tls_skip_verify`)),`                                                                                                                              |\n| (service definitions) `,mdx(\"inlineCode\",{parentName:\"p\"},`deregistercriticalserviceafter`),` | `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/agent/check#deregistercriticalserviceafter\"},mdx(\"inlineCode\",{parentName:\"a\"},`deregister_critical_service_after`)),`                                                                                                            |`),mdx(\"h4\",{\"id\":\"statsite_prefix-renamed-to-metrics_prefix\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#statsite_prefix-renamed-to-metrics_prefix\",\"aria-label\":\"statsite_prefix renamed to metrics_prefix permalink\"},`\\xbb`),mdx(\"inlineCode\",{parentName:\"h4\"},`statsite_prefix`),` Renamed to `,mdx(\"inlineCode\",{parentName:\"h4\"},`metrics_prefix`)),mdx(\"p\",null,`Since the `,mdx(\"inlineCode\",{parentName:\"p\"},`statsite_prefix`),` configuration option applied to all telemetry\nproviders, `,mdx(\"inlineCode\",{parentName:\"p\"},`statsite_prefix`),` was renamed to\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#telemetry-metrics_prefix\"},mdx(\"inlineCode\",{parentName:\"a\"},`metrics_prefix`)),`.\nConfiguration files will need to be updated when upgrading to this version of\nConsul.`),mdx(\"h4\",{\"id\":\"advertise_addrs-removed\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#advertise_addrs-removed\",\"aria-label\":\"advertise_addrs removed permalink\"},`\\xbb`),mdx(\"inlineCode\",{parentName:\"h4\"},`advertise_addrs`),` Removed`),mdx(\"p\",null,`This configuration option was removed since it was redundant with\n`,mdx(\"inlineCode\",{parentName:\"p\"},`advertise_addr`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`advertise_addr_wan`),` in combination with `,mdx(\"inlineCode\",{parentName:\"p\"},`ports`),` and also\nwrongly stated that you could configure both host and port.`),mdx(\"h4\",{\"id\":\"escaping-behavior-changed-for-go-discover-configs\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#escaping-behavior-changed-for-go-discover-configs\",\"aria-label\":\"escaping behavior changed for go discover configs permalink\"},`\\xbb`),`Escaping Behavior Changed for go-discover Configs`),mdx(\"p\",null,`The format for `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#retry-join\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join`)),` and\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#retry-join-wan\"},mdx(\"inlineCode\",{parentName:\"a\"},`-retry-join-wan`)),` values that use\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/go-discover\"},`go-discover`),` cloud auto joining has\nchanged. Values in `,mdx(\"inlineCode\",{parentName:\"p\"},`key=val`),` sequences must no longer be URL encoded and can be\nprovided as literals as long as they do not contain spaces, backslashes `,mdx(\"inlineCode\",{parentName:\"p\"},`\\\\`),` or\ndouble quotes `,mdx(\"inlineCode\",{parentName:\"p\"},`\"`),`. If values contain these characters then use double quotes as\nin `,mdx(\"inlineCode\",{parentName:\"p\"},`\"some key\"=\"some value\"`),`. Special characters within a double quoted string\ncan be escaped with a backslash `,mdx(\"inlineCode\",{parentName:\"p\"},`\\\\`),`.`),mdx(\"h4\",{\"id\":\"http-verbs-are-enforced-in-many-http-apis\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#http-verbs-are-enforced-in-many-http-apis\",\"aria-label\":\"http verbs are enforced in many http apis permalink\"},`\\xbb`),`HTTP Verbs are Enforced in Many HTTP APIs`),mdx(\"p\",null,`Many endpoints in the HTTP API that previously took any HTTP verb now check for\nspecific HTTP verbs and enforce them. This may break clients relying on the old\nbehavior. Here's the complete list of updated endpoints and required HTTP\nverbs:`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",{parentName:\"tr\",\"align\":null},`Endpoint`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Required HTTP Verb`))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/acl/info`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/acl/list`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/acl/replication`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/check/deregister`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/check/fail`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/check/pass`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/check/register`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/check/warn`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/checks`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/force-leave`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/join`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/members`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/metrics`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/self`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/service/register`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/service/deregister`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/agent/services`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/catalog/datacenters`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/catalog/deregister`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/catalog/node`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/catalog/nodes`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/catalog/register`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/catalog/service`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/catalog/services`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/coordinate/datacenters`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/coordinate/nodes`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/health/checks`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/health/node`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/health/service`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/health/state`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/internal/ui/node`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/internal/ui/nodes`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/internal/ui/services`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/session/info`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/session/list`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/session/node`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/status/leader`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/status/peers`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/operator/area/:uuid/members`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`GET`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`/v1/operator/area/:uuid/join`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`PUT`)))),mdx(\"h4\",{\"id\":\"unauthorized-kv-requests-return-403\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#unauthorized-kv-requests-return-403\",\"aria-label\":\"unauthorized kv requests return 403 permalink\"},`\\xbb`),`Unauthorized KV Requests Return 403`),mdx(\"p\",null,`When ACLs are enabled, reading a key with an unauthorized token returns a 403.\nThis previously returned a 404 response.`),mdx(\"h4\",{\"id\":\"config-section-of-agent-self-endpoint-has-changed\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#config-section-of-agent-self-endpoint-has-changed\",\"aria-label\":\"config section of agent self endpoint has changed permalink\"},`\\xbb`),`Config Section of Agent Self Endpoint has Changed`),mdx(\"p\",null,`The /v1/agent/self endpoint's `,mdx(\"inlineCode\",{parentName:\"p\"},`Config`),` section has often been in flux as it was\ndirectly returning one of Consul's internal data structures. This configuration\nstructure has been moved under `,mdx(\"inlineCode\",{parentName:\"p\"},`DebugConfig`),`, and is documents as for debugging\nuse and subject to change, and a small set of elements of `,mdx(\"inlineCode\",{parentName:\"p\"},`Config`),` have been\nmaintained and documented. See `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/agent#read-configuration\"},`Read\nConfiguration`),` endpoint documentation for\ndetails.`),mdx(\"h4\",{\"id\":\"deprecated-configtest-command-removed\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#deprecated-configtest-command-removed\",\"aria-label\":\"deprecated configtest command removed permalink\"},`\\xbb`),`Deprecated `,mdx(\"inlineCode\",{parentName:\"h4\"},`configtest`),` Command Removed`),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`configtest`),` command was deprecated and has been superseded by the\n`,mdx(\"inlineCode\",{parentName:\"p\"},`validate`),` command.`),mdx(\"h4\",{\"id\":\"undocumented-flags-in-validate-command-removed\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#undocumented-flags-in-validate-command-removed\",\"aria-label\":\"undocumented flags in validate command removed permalink\"},`\\xbb`),`Undocumented Flags in `,mdx(\"inlineCode\",{parentName:\"h4\"},`validate`),` Command Removed`),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`validate`),` command supported the `,mdx(\"inlineCode\",{parentName:\"p\"},`-config-file`),` and `,mdx(\"inlineCode\",{parentName:\"p\"},`-config-dir`),` command\nline flags but did not document them. This support has been removed since the\nflags are not required.`),mdx(\"h4\",{\"id\":\"metric-names-updated\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#metric-names-updated\",\"aria-label\":\"metric names updated permalink\"},`\\xbb`),`Metric Names Updated`),mdx(\"p\",null,`Metric names no longer start with `,mdx(\"inlineCode\",{parentName:\"p\"},`consul.consul`),`. To help with transitioning\ndashboards and other metric consumers, the field `,mdx(\"inlineCode\",{parentName:\"p\"},`enable_deprecated_names`),` has\nbeen added to the telemetry section of the config, which will enable metrics\nwith the old naming scheme to be sent alongside the new ones. The following\nprefixes were affected:`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",{parentName:\"tr\",\"align\":null},`Prefix`))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.acl`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.autopilot`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.catalog`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.fsm`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.health`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.http`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.kvs`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.leader`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.prepared-query`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.rpc`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.session`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.session_ttl`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`consul.consul.txn`)))),mdx(\"h4\",{\"id\":\"checks-validated-on-agent-startup\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#checks-validated-on-agent-startup\",\"aria-label\":\"checks validated on agent startup permalink\"},`\\xbb`),`Checks Validated On Agent Startup`),mdx(\"p\",null,`Consul agents now validate health check definitions in their configuration and\nwill fail at startup if any checks are invalid. In previous versions of Consul,\ninvalid health checks would get skipped.`),mdx(\"h2\",{\"id\":\"consul-0-9-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-9-0\",\"aria-label\":\"consul 0 9 0 permalink\"},`\\xbb`),`Consul 0.9.0`),mdx(\"h4\",{\"id\":\"script-checks-are-now-opt-in\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#script-checks-are-now-opt-in\",\"aria-label\":\"script checks are now opt in permalink\"},`\\xbb`),`Script Checks Are Now Opt-In`),mdx(\"p\",null,`A new `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#_enable_script_checks\"},mdx(\"inlineCode\",{parentName:\"a\"},`enable_script_checks`)),`\nconfiguration option was added, and defaults to `,mdx(\"inlineCode\",{parentName:\"p\"},`false`),`, meaning that in order\nto allow an agent to run health checks that execute scripts, this will need to\nbe configured and set to `,mdx(\"inlineCode\",{parentName:\"p\"},`true`),`. This provides a safer out-of-the-box\nconfiguration for Consul where operators must opt-in to allow script-based\nhealth checks.`),mdx(\"p\",null,`If your cluster uses script health checks please be sure to set this to `,mdx(\"inlineCode\",{parentName:\"p\"},`true`),`\nas part of upgrading agents. If this is set to `,mdx(\"inlineCode\",{parentName:\"p\"},`true`),`, you should also enable\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/security/access-control-setup-production\"},`ACLs`),`\nto provide control over which users are allowed to register health checks that\ncould potentially execute scripts on the agent machines.`),mdx(\"div\",{\"className\":\"alert alert-danger g-type-body\"},mdx(\"p\",{parentName:\"div\"},``,mdx(\"strong\",{parentName:\"p\"},`Security Warning:`),` Using `,mdx(\"inlineCode\",{parentName:\"p\"},`enable_script_checks`),` without ACLs and without\n`,mdx(\"inlineCode\",{parentName:\"p\"},`allow_write_http_from`),` is `,mdx(\"em\",{parentName:\"p\"},`DANGEROUS`),`. Use the `,mdx(\"inlineCode\",{parentName:\"p\"},`enable_local_script_checks`),` setting\nintroduced in v0.9.4 instead. See `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://www.hashicorp.com/blog/protecting-consul-from-rce-risk-in-specific-configurations/\"},`this article`),`\nfor more information.`)),mdx(\"h4\",{\"id\":\"web-ui-is-no-longer-released-separately\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#web-ui-is-no-longer-released-separately\",\"aria-label\":\"web ui is no longer released separately permalink\"},`\\xbb`),`Web UI Is No Longer Released Separately`),mdx(\"p\",null,`Consul releases will no longer include a `,mdx(\"inlineCode\",{parentName:\"p\"},`web_ui.zip`),` file with the compiled\nweb assets. These have been built in to the Consul binary since the 0.7.x\nseries and can be enabled with the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#_ui\"},mdx(\"inlineCode\",{parentName:\"a\"},`-ui`)),`\nconfiguration option. These built-in web assets have always been identical to\nthe contents of the `,mdx(\"inlineCode\",{parentName:\"p\"},`web_ui.zip`),` file for each release. The\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#_ui_dir\"},mdx(\"inlineCode\",{parentName:\"a\"},`-ui-dir`)),` option is still available for\nhosting customized versions of the web assets, but the vast majority of Consul\nusers can just use the built in web assets.`),mdx(\"h2\",{\"id\":\"consul-0-8-0\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-8-0\",\"aria-label\":\"consul 0 8 0 permalink\"},`\\xbb`),`Consul 0.8.0`),mdx(\"h4\",{\"id\":\"upgrade-current-cluster-leader-last\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#upgrade-current-cluster-leader-last\",\"aria-label\":\"upgrade current cluster leader last permalink\"},`\\xbb`),`Upgrade Current Cluster Leader Last`),mdx(\"p\",null,`We identified a potential issue with Consul 0.8 that requires the current\ncluster leader to be upgraded last when updating multiple servers. Please see\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul/issues/2889\"},`this issue`),` for more details.`),mdx(\"h4\",{\"id\":\"command-line-interface-rpc-deprecation\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#command-line-interface-rpc-deprecation\",\"aria-label\":\"command line interface rpc deprecation permalink\"},`\\xbb`),`Command-Line Interface RPC Deprecation`),mdx(\"p\",null,`The RPC client interface has been removed. All CLI commands that used RPC and\nthe `,mdx(\"inlineCode\",{parentName:\"p\"},`-rpc-addr`),` flag to communicate with Consul have been converted to use the\nHTTP API and the appropriate flags for it, and the `,mdx(\"inlineCode\",{parentName:\"p\"},`rpc`),` field has been removed\nfrom the port and address binding configs. You will need to remove these fields\nfrom your config files and update any scripts that passed a custom `,mdx(\"inlineCode\",{parentName:\"p\"},`-rpc-addr`),`\nto the following commands:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"force-leave\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#force-leave\",\"aria-label\":\"force leave permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`force-leave`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"info\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#info\",\"aria-label\":\"info permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`info`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"join\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#join\",\"aria-label\":\"join permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`join`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"keyring\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#keyring\",\"aria-label\":\"keyring permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`keyring`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"leave\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#leave\",\"aria-label\":\"leave permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`leave`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"members\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#members\",\"aria-label\":\"members permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`members`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"monitor\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#monitor\",\"aria-label\":\"monitor permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`monitor`))),mdx(\"li\",{parentName:\"ul\"},mdx(\"a\",{parentName:\"li\",\"id\":\"reload\",\"className\":\"__target-lic\",\"aria-hidden\":\"true\"}),mdx(\"a\",{parentName:\"li\",\"href\":\"#reload\",\"aria-label\":\"reload permalink\",\"className\":\"__permalink-lic\"},mdx(\"inlineCode\",{parentName:\"a\"},`reload`)))),mdx(\"h4\",{\"id\":\"version-8-acls-are-now-opt-out\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#version-8-acls-are-now-opt-out\",\"aria-label\":\"version 8 acls are now opt out permalink\"},`\\xbb`),`Version 8 ACLs Are Now Opt-Out`),mdx(\"p\",null,`The `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#acl_enforce_version_8\"},mdx(\"inlineCode\",{parentName:\"a\"},`acl_enforce_version_8`)),`\nconfiguration now defaults to `,mdx(\"inlineCode\",{parentName:\"p\"},`true`),` to enable full version 8 ACL support by\ndefault. If you are upgrading an existing cluster with ACLs enabled, you will\nneed to set this to `,mdx(\"inlineCode\",{parentName:\"p\"},`false`),` during the upgrade on `,mdx(\"strong\",{parentName:\"p\"},`both Consul agents and\nConsul servers`),`. Version 8 ACLs were also changed so that\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#acl_datacenter\"},mdx(\"inlineCode\",{parentName:\"a\"},`acl_datacenter`)),` must be set on\nagents in order to enable the agent-side enforcement of ACLs. This makes for a\nsmoother experience in clusters where ACLs aren't enabled at all, but where the\nagents would have to wait to contact a Consul server before learning that.`),mdx(\"h4\",{\"id\":\"remote-exec-is-now-opt-in\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#remote-exec-is-now-opt-in\",\"aria-label\":\"remote exec is now opt in permalink\"},`\\xbb`),`Remote Exec Is Now Opt-In`),mdx(\"p\",null,`The default for\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#disable_remote_exec\"},mdx(\"inlineCode\",{parentName:\"a\"},`disable_remote_exec`)),` was\nchanged to \"true\", so now operators need to opt-in to having agents support\nrunning commands remotely via `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/commands/exec\"},mdx(\"inlineCode\",{parentName:\"a\"},`consul exec`)),`.`),mdx(\"h4\",{\"id\":\"raft-protocol-version-compatibility\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#raft-protocol-version-compatibility\",\"aria-label\":\"raft protocol version compatibility permalink\"},`\\xbb`),`Raft Protocol Version Compatibility`),mdx(\"p\",null,`When upgrading to Consul 0.8.0 from a version lower than 0.7.0, users will need\nto set the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/cli-flags#_raft_protocol\"},mdx(\"inlineCode\",{parentName:\"a\"},`-raft-protocol`)),` option\nto 1 in order to maintain backwards compatibility with the old servers during\nthe upgrade. After the servers have been migrated to version 0.8.0,\n`,mdx(\"inlineCode\",{parentName:\"p\"},`-raft-protocol`),` can be moved up to 2 and the servers restarted to match the\ndefault.`),mdx(\"p\",null,`The Raft protocol must be stepped up in this way; only adjacent version numbers\nare compatible (for example, version 1 cannot talk to version 3). Here is a\ntable of the Raft Protocol versions supported by each Consul version:`),mdx(\"table\",null,mdx(\"thead\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"thead\"},mdx(\"th\",{parentName:\"tr\",\"align\":null},`Version`),mdx(\"th\",{parentName:\"tr\",\"align\":null},`Supported Raft Protocols`))),mdx(\"tbody\",{parentName:\"table\"},mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`0.6 and earlier`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`0`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`0.7`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1`)),mdx(\"tr\",{parentName:\"tbody\"},mdx(\"td\",{parentName:\"tr\",\"align\":null},`0.8`),mdx(\"td\",{parentName:\"tr\",\"align\":null},`1, 2, 3`)))),mdx(\"p\",null,`In order to enable all\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/datacenter-operations/autopilot-datacenter-operations\"},`Autopilot`),`\nfeatures, all servers in a Consul datacenter must be running with Raft protocol\nversion 3 or later.`),mdx(\"h2\",{\"id\":\"consul-0-7-1\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-7-1\",\"aria-label\":\"consul 0 7 1 permalink\"},`\\xbb`),`Consul 0.7.1`),mdx(\"h4\",{\"id\":\"child-process-reaping\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#child-process-reaping\",\"aria-label\":\"child process reaping permalink\"},`\\xbb`),`Child Process Reaping`),mdx(\"p\",null,`Child process reaping support has been removed, along with the `,mdx(\"inlineCode\",{parentName:\"p\"},`reap`),`\nconfiguration option. Reaping is also done via\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/Yelp/dumb-init\"},`dumb-init`),` in the `,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/docker-consul\"},`Consul Docker\nimage`),`, so removing it from Consul\nitself simplifies the code and eases future maintenance for Consul. If you are\nrunning Consul as PID 1 in a container you will need to arrange for a wrapper\nprocess to reap child processes.`),mdx(\"h4\",{\"id\":\"dns-resiliency-defaults\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#dns-resiliency-defaults\",\"aria-label\":\"dns resiliency defaults permalink\"},`\\xbb`),`DNS Resiliency Defaults`),mdx(\"p\",null,`The default for `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#max_stale\"},mdx(\"inlineCode\",{parentName:\"a\"},`max_stale`)),` has been\nincreased from 5 seconds to a near-indefinite threshold (10 years) to allow DNS\nqueries to continue to be served in the event of a long outage with no leader.\nA new telemetry counter was added at `,mdx(\"inlineCode\",{parentName:\"p\"},`consul.dns.stale_queries`),` to track when\nagents serve DNS queries that are stale by more than 5 seconds.`),mdx(\"h2\",{\"id\":\"consul-0-7\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-7\",\"aria-label\":\"consul 0 7 permalink\"},`\\xbb`),`Consul 0.7`),mdx(\"p\",null,`Consul version 0.7 is a very large release with many important changes. Changes\nto be aware of during an upgrade are categorized below.`),mdx(\"h4\",{\"id\":\"performance-timing-defaults-and-tuning\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#performance-timing-defaults-and-tuning\",\"aria-label\":\"performance timing defaults and tuning permalink\"},`\\xbb`),`Performance Timing Defaults and Tuning`),mdx(\"p\",null,`Consul 0.7 now defaults the DNS configuration to allow for stale queries by\ndefaulting `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#allow_stale\"},mdx(\"inlineCode\",{parentName:\"a\"},`allow_stale`)),` to true for\nbetter utilization of available servers. If you want to retain the previous\nbehavior, set the following configuration:`),mdx(\"pre\",{\"className\":\"language-json\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-json\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"dns_config\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"allow_stale\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token boolean\"},`false`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`)),mdx(\"p\",null,`Consul also 0.7 introduced support for tuning Raft performance using a new\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#performance\"},`performance configuration block`),`. Also,\nthe default Raft timing is set to a lower-performance mode suitable for\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/install/performance#minimum\"},`minimal Consul servers`),`.`),mdx(\"p\",null,`To continue to use the high-performance settings that were the default prior to\nConsul 0.7 (recommended for production servers), add the following\nconfiguration to all Consul servers when upgrading:`),mdx(\"pre\",{\"className\":\"language-json\"},mdx(\"code\",{parentName:\"pre\",\"className\":\"language-json\"},mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"performance\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`{`),`\n`,`    `,mdx(\"span\",{parentName:\"code\",\"className\":\"token property\"},`\"raft_multiplier\"`),mdx(\"span\",{parentName:\"code\",\"className\":\"token operator\"},`:`),` `,mdx(\"span\",{parentName:\"code\",\"className\":\"token number\"},`1`),`\n`,`  `,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`,mdx(\"span\",{parentName:\"code\",\"className\":\"token punctuation\"},`}`),`\n`)),mdx(\"p\",null,`See the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/install/performance\"},`Server Performance`),` guide for more details.`),mdx(\"h4\",{\"id\":\"leave-related-configuration-defaults\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#leave-related-configuration-defaults\",\"aria-label\":\"leave related configuration defaults permalink\"},`\\xbb`),`Leave-Related Configuration Defaults`),mdx(\"p\",null,`The default behavior of `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#leave_on_terminate\"},mdx(\"inlineCode\",{parentName:\"a\"},`leave_on_terminate`)),`\nand `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#skip_leave_on_interrupt\"},mdx(\"inlineCode\",{parentName:\"a\"},`skip_leave_on_interrupt`)),`\nare now dependent on whether or not the agent is acting as a server or client:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},`For servers, `,mdx(\"inlineCode\",{parentName:\"p\"},`leave_on_terminate`),` defaults to \"false\" and `,mdx(\"inlineCode\",{parentName:\"p\"},`skip_leave_on_interrupt`),`\ndefaults to \"true\".`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},`For clients, `,mdx(\"inlineCode\",{parentName:\"p\"},`leave_on_terminate`),` defaults to \"true\" and `,mdx(\"inlineCode\",{parentName:\"p\"},`skip_leave_on_interrupt`),`\ndefaults to \"false\".`))),mdx(\"p\",null,`These defaults are designed to be safer for servers so that you must explicitly\nconfigure them to leave the cluster. This also results in a better experience for\nclients, especially in cloud environments where they may be created and destroyed\noften and users prefer not to wait for the 72 hour reap time for cleanup.`),mdx(\"h4\",{\"id\":\"dropped-support-for-protocol-version-1\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#dropped-support-for-protocol-version-1\",\"aria-label\":\"dropped support for protocol version 1 permalink\"},`\\xbb`),`Dropped Support for Protocol Version 1`),mdx(\"p\",null,`Consul version 0.7 dropped support for protocol version 1, which means it\nis no longer compatible with versions of Consul prior to 0.3. You will need\nto upgrade all agents to a newer version of Consul before upgrading to Consul\n0.7.`),mdx(\"h4\",{\"id\":\"prepared-query-changes\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#prepared-query-changes\",\"aria-label\":\"prepared query changes permalink\"},`\\xbb`),`Prepared Query Changes`),mdx(\"p\",null,`Consul version 0.7 adds a feature which allows prepared queries to store a\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/query#near\"},mdx(\"inlineCode\",{parentName:\"a\"},`Near`),` parameter`),` in the query definition\nitself. This feature enables using the distance sorting features of prepared\nqueries without explicitly providing the node to sort near in requests, but\nrequires the agent servicing a request to send additional information about\nitself to the Consul servers when executing the prepared query. Agents prior\nto 0.7 do not send this information, which means they are unable to properly\nexecute prepared queries configured with a `,mdx(\"inlineCode\",{parentName:\"p\"},`Near`),` parameter. Similarly, any\nserver nodes prior to version 0.7 are unable to store the `,mdx(\"inlineCode\",{parentName:\"p\"},`Near`),` parameter,\nmaking them unable to properly serve requests for prepared queries using the\nfeature. It is recommended that all agents be running version 0.7 prior to\nusing this feature.`),mdx(\"h4\",{\"id\":\"wan-address-translation-in-http-endpoints\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#wan-address-translation-in-http-endpoints\",\"aria-label\":\"wan address translation in http endpoints permalink\"},`\\xbb`),`WAN Address Translation in HTTP Endpoints`),mdx(\"p\",null,`Consul version 0.7 added support for translating WAN addresses in certain\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#translate_wan_addrs\"},`HTTP endpoints`),`. The servers\nand the agents need to be running version 0.7 or later in order to use this\nfeature.`),mdx(\"p\",null,`These translated addresses could break HTTP endpoint consumers that are\nexpecting local addresses, so a new `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/api-docs/api-structure#translated-addresses\"},mdx(\"inlineCode\",{parentName:\"a\"},`X-Consul-Translate-Addresses`)),`\nheader was added to allow clients to detect if translation is enabled for HTTP\nresponses. A \"lan\" tag was added to `,mdx(\"inlineCode\",{parentName:\"p\"},`TaggedAddresses`),` for clients that need\nthe local address regardless of translation.`),mdx(\"h4\",{\"id\":\"outage-recovery-and-peers-json-changes\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#outage-recovery-and-peers-json-changes\",\"aria-label\":\"outage recovery and peers json changes permalink\"},`\\xbb`),`Outage Recovery and `,mdx(\"inlineCode\",{parentName:\"h4\"},`peers.json`),` Changes`),mdx(\"p\",null,`The `,mdx(\"inlineCode\",{parentName:\"p\"},`peers.json`),` file is no longer present by default and is only used when\nperforming recovery. This file will be deleted after Consul starts and ingests\nthe file. Consul 0.7 also uses a new, automatically-created raft/peers.info file\nto avoid ingesting the `,mdx(\"inlineCode\",{parentName:\"p\"},`peers.json`),` file on the first start after upgrading (the\n`,mdx(\"inlineCode\",{parentName:\"p\"},`peers.json`),` file is simply deleted on the first start after upgrading).`),mdx(\"p\",null,`Please be sure to review the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/tutorials/datacenter-operations/recovery-outage\"},`Disaster recovery for Consul clusters tutorial`),`\nbefore upgrading for more details.`),mdx(\"h2\",{\"id\":\"consul-0-6-4\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-6-4\",\"aria-label\":\"consul 0 6 4 permalink\"},`\\xbb`),`Consul 0.6.4`),mdx(\"p\",null,`Consul 0.6.4 made some substantial changes to how ACLs work with prepared\nqueries. Existing queries will execute with no changes, but there are important\ndifferences to understand about how prepared queries are managed before you\nupgrade. In particular, prepared queries with no `,mdx(\"inlineCode\",{parentName:\"p\"},`Name`),` defined will no longer\nrequire any ACL to manage them, and prepared queries with a `,mdx(\"inlineCode\",{parentName:\"p\"},`Name`),` defined are\nnow governed by a new `,mdx(\"inlineCode\",{parentName:\"p\"},`query`),` ACL policy that will need to be configured\nafter the upgrade.`),mdx(\"p\",null,`See the `,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/security/acl/acl-rules#prepared-query-rules\"},`ACL rules documentation`),` for more details\nabout the new behavior and how it compares to previous versions of Consul.`),mdx(\"h2\",{\"id\":\"consul-0-6\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-6\",\"aria-label\":\"consul 0 6 permalink\"},`\\xbb`),`Consul 0.6`),mdx(\"p\",null,`Consul version 0.6 is a very large release with many enhancements and\noptimizations. Changes to be aware of during an upgrade are categorized below.`),mdx(\"h4\",{\"id\":\"data-store-changes\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#data-store-changes\",\"aria-label\":\"data store changes permalink\"},`\\xbb`),`Data Store Changes`),mdx(\"p\",null,`Consul changed the format used to store data on the server nodes in version 0.5\n(see 0.5.1 notes below for details). Previously, Consul would automatically\ndetect data directories using the old LMDB format, and convert them to the newer\nBoltDB format. This automatic upgrade has been removed for Consul 0.6, and\ninstead a safeguard has been put in place which will prevent Consul from booting\nif the old directory format is detected.`),mdx(\"p\",null,`It is still possible to migrate from a 0.5.x version of Consul to 0.6+ using the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul-migrate\"},`consul-migrate`),` CLI utility. This\nis the same tool that was previously embedded into Consul. See the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"https://github.com/hashicorp/consul-migrate/releases\"},`releases`),` page for\ndownloadable versions of the tool.`),mdx(\"p\",null,`Also, in this release Consul switched from LMDB to a fully in-memory database for\nthe state store. Because LMDB is a disk-based backing store, it was able to store\nmore data than could fit in RAM in some cases (though this is not a recommended\nconfiguration for Consul). If you have an extremely large data set that won't fit\ninto RAM, you may encounter issues upgrading to Consul 0.6.0 and later. Consul\nshould be provisioned with physical memory approximately 2X the data set size to\nallow for bursty allocations and subsequent garbage collection.`),mdx(\"h4\",{\"id\":\"acl-enhancements\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#acl-enhancements\",\"aria-label\":\"acl enhancements permalink\"},`\\xbb`),`ACL Enhancements`),mdx(\"p\",null,`Consul 0.6 introduces enhancements to the ACL system which may require special\nhandling:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`Service ACLs are enforced during service discovery (REST + DNS)`)),mdx(\"p\",null,`Previously, service discovery was wide open, and any client could query\ninformation about any service without providing a token. Consul now requires\nread-level access at a minimum when ACLs are enabled to return service\ninformation over the REST or DNS interfaces. If clients depend on an open\nservice discovery system, then the following should be added to all ACL tokens\nwhich require it:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},`# Enable discovery of all services`,`\n`,`service \"\" {`,`\n`,`    policy = \"read\"`,`\n`,`}`,`\n`)),mdx(\"p\",null,`When the DNS interface is queried, the agent's\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/agent/config/config-files#acl_token\"},mdx(\"inlineCode\",{parentName:\"a\"},`acl_token`)),` is used, so be sure\nthat token has sufficient privileges to return the DNS records you\nexpect to retrieve from it.`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`Event and keyring ACLs`)),mdx(\"p\",null,`Similar to service discovery, the new event and keyring ACLs will block access\nto these operations if the `,mdx(\"inlineCode\",{parentName:\"p\"},`acl_default_policy`),` is set to `,mdx(\"inlineCode\",{parentName:\"p\"},`deny`),`. If clients depend\non open access to these, then the following should be added to all ACL tokens which\nrequire them:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},`event \"\" {`,`\n`,`  policy = \"write\"`,`\n`,`}`,`\n`,`\n`,`keyring = \"write\"`,`\n`)),mdx(\"p\",null,`Unfortunately, these are new ACLs for Consul 0.6, so they must be added after the\nupgrade is complete.`),mdx(\"h4\",{\"id\":\"prepared-queries\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#prepared-queries\",\"aria-label\":\"prepared queries permalink\"},`\\xbb`),`Prepared Queries`),mdx(\"p\",null,`Prepared queries introduce a new Raft log entry type that isn't supported on older\nversions of Consul. It's important to not use the prepared query features of Consul\nuntil all servers in a cluster have been upgraded to version 0.6.0.`),mdx(\"h4\",{\"id\":\"single-private-ip-enforcement\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#single-private-ip-enforcement\",\"aria-label\":\"single private ip enforcement permalink\"},`\\xbb`),`Single Private IP Enforcement`),mdx(\"p\",null,`Consul will refuse to start if there are multiple private IPs available, so\nif this is the case you will need to configure Consul's advertise or bind addresses\nbefore upgrading.`),mdx(\"h4\",{\"id\":\"new-web-ui-file-layout\"},mdx(\"a\",{parentName:\"h4\",\"className\":\"__permalink-h\",\"href\":\"#new-web-ui-file-layout\",\"aria-label\":\"new web ui file layout permalink\"},`\\xbb`),`New Web UI File Layout`),mdx(\"p\",null,`The release .zip file for Consul's web UI no longer contains a `,mdx(\"inlineCode\",{parentName:\"p\"},`dist`),` sub-folder;\neverything has been moved up one level. If you have any automated scripts that\nexpect the old layout you may need to update them.`),mdx(\"h2\",{\"id\":\"consul-0-5-1\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-5-1\",\"aria-label\":\"consul 0 5 1 permalink\"},`\\xbb`),`Consul 0.5.1`),mdx(\"p\",null,`Consul version 0.5.1 uses a different backend store for persisting the Raft\nlog. Because of this change, a data migration is necessary to move the log\nentries out of LMDB and into the newer backend, BoltDB.`),mdx(\"p\",null,`Consul version 0.5.1+ makes this transition seamless and easy. As a user, there\nare no special steps you need to take. When Consul starts, it checks\nfor presence of the legacy LMDB data files, and migrates them automatically\nif any are found. You will see a log emitted when Raft data is migrated, like\nthis:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},`==\u003e Successfully migrated raft data in 5.839642ms`,`\n`)),mdx(\"p\",null,`This automatic upgrade will only exist in Consul 0.5.1+ and it will\nbe removed starting with Consul 0.6.0+. It will still be possible to upgrade directly\nfrom pre-0.5.1 versions by using the consul-migrate utility, which is available on the\n`,mdx(\"a\",{parentName:\"p\",\"href\":\"/consul/docs/integrate/download-tools\"},`Consul Tools page`),`.`),mdx(\"h2\",{\"id\":\"consul-0-5\"},mdx(\"a\",{parentName:\"h2\",\"className\":\"__permalink-h\",\"href\":\"#consul-0-5\",\"aria-label\":\"consul 0 5 permalink\"},`\\xbb`),`Consul 0.5`),mdx(\"p\",null,`Consul version 0.5 adds two features that complicate the upgrade process:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},`ACL system includes service discovery and registration`),mdx(\"li\",{parentName:\"ul\"},`Internal use of tombstones to fix behavior of blocking queries\nin certain edge cases.`)),mdx(\"p\",null,`Users of the ACL system need to be aware that deploying Consul 0.5 will\ncause service registration to be enforced. This means if an agent\nattempts to register a service without proper privileges it will be denied.\nIf the `,mdx(\"inlineCode\",{parentName:\"p\"},`acl_default_policy`),` is \"allow\" then clients will continue to\nwork without an updated policy. If the policy is \"deny\", then all clients\nwill begin to have their registration rejected causing issues.`),mdx(\"p\",null,`To avoid this situation, all the ACL policies should be updated to\nadd something like this:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},`# Enable all services to be registered`,`\n`,`service \"\" {`,`\n`,`    policy = \"write\"`,`\n`,`}`,`\n`)),mdx(\"p\",null,`This will set the service policy to `,mdx(\"inlineCode\",{parentName:\"p\"},`write`),` level for all services.\nThe blank service name is the catch-all value. A more specific service\ncan also be specified:`),mdx(\"pre\",null,mdx(\"code\",{parentName:\"pre\"},`# Enable only the API service to be registered`,`\n`,`service \"api\" {`,`\n`,`    policy = \"write\"`,`\n`,`}`,`\n`)),mdx(\"p\",null,`The ACL policy can be updated while running 0.4, and enforcement will\nbeing with the upgrade to 0.5. The policy updates will ensure the\navailability of the cluster.`),mdx(\"p\",null,`The second major change is the new internal command used for tombstones.\nThe details of the change are not important, however to function the leader\nnode will replicate a new command to its followers. Consul is designed\ndefensively, and when a command that is not recognized is received, the\nserver will panic. This is a purposeful design decision to avoid the possibility\nof data loss, inconsistencies, or security issues caused by future incompatibility.`),mdx(\"p\",null,`In practice, this means if a Consul 0.5 node is the leader, all of its\nfollowers must also be running 0.5. There are a number of ways to do this\nto ensure cluster availability:`),mdx(\"ul\",null,mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},`Add new 0.5 nodes, then remove the old servers. This will add the new\nnodes as followers, and once the old servers are removed, one of the\n0.5 nodes will become leader.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},`Upgrade the followers first, then the leader last. Using `,mdx(\"inlineCode\",{parentName:\"p\"},`consul info`),`,\nyou can determine which nodes are followers. Do an in-place upgrade\non them first, and finally upgrade the leader last.`)),mdx(\"li\",{parentName:\"ul\"},mdx(\"p\",{parentName:\"li\"},`Upgrade them in any order, but ensure all are done within 15 minutes.\nEven if the leader is upgraded to 0.5 first, as long as all of the followers\nare running 0.5 within 15 minutes there will be no issues.`))),mdx(\"p\",null,`Finally, even if any of the methods above are not possible or the process\nfails for some reason, it is not fatal. The older version of the server\nwill simply panic and stop. At that point, you can upgrade to the new version\nand restart the agent. There will be no data loss and the cluster will\nresume operations.`))};MDXContent.isMDXComponent=true;","scope":{"version":"latest"}},"product":{"name":"Consul","slug":"consul","algoliaConfig":{"indexName":"product_CONSUL","searchOnlyApiKey":"fbd5dc1f0078d41509fcc560386fd534"},"analyticsConfig":{"includedDomains":"consul.io www.consul.io","segmentWriteKey":"IyzLrqXkox5KJ8XL4fo8vTYNGfiKlTCm"},"datoToken":"88b4984480dad56295a8aadae6caad","metadata":{"title":"Consul by HashiCorp","description":"Consul is a service networking solution to automate network configurations, discover services, and enable secure connectivity across any cloud or runtime.","image":"https://www.consulproject.io/consul-public/img/og-image.png","icon":[{"href":"/consul-public/_favicon.ico"}]},"alertBannerActive":true,"alertBanner":{"tag":"HashiDays","url":"https://hashicorp.com/conferences/hashidays","text":"One conference. Three cities.","linkText":"Find a city near you","expirationDate":"2024-06-14T00:00:00-08:00"},"version":"1.11.3","subnavItems":[],"basePaths":["docs","api-docs","commands","downloads"],"rootDocsPaths":[{"iconName":"docs","name":"Documentation","path":"docs"},{"iconName":"api","name":"API","path":"api-docs"},{"iconName":"terminal-screen","name":"CLI","path":"commands"}],"currentRootDocsPath":{"iconName":"docs","name":"Documentation","path":"docs"}},"projectName":null,"versions":null},"__N_SSG":true},"page":"/consul/docs/[...page]","query":{"page":["upgrading","upgrade-specific"]},"buildId":"C_aCbyHEz7wf5PZ-lSB3G","isFallback":false,"gsp":true,"scriptLoader":[]}</script><script nomodule="">window.MSInputMethodContext && document.documentMode && document.write('<script src="/ie-warning.js"><\x2fscript>');</script></body></html>